{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.DataProducer = void 0;\nconst Logger_1 = require(\"./Logger\");\nconst enhancedEvents_1 = require(\"./enhancedEvents\");\nconst errors_1 = require(\"./errors\");\nconst logger = new Logger_1.Logger('DataProducer');\nclass DataProducer extends enhancedEvents_1.EnhancedEventEmitter {\n  // Id.\n  _id;\n  // The underlying RTCDataChannel instance.\n  _dataChannel;\n  // Closed flag.\n  _closed = false;\n  // SCTP stream parameters.\n  _sctpStreamParameters;\n  // App custom data.\n  _appData;\n  // Observer instance.\n  _observer = new enhancedEvents_1.EnhancedEventEmitter();\n  constructor({\n    id,\n    dataChannel,\n    sctpStreamParameters,\n    appData\n  }) {\n    super();\n    logger.debug('constructor()');\n    this._id = id;\n    this._dataChannel = dataChannel;\n    this._sctpStreamParameters = sctpStreamParameters;\n    this._appData = appData ?? {};\n    this.handleDataChannel();\n  }\n  /**\r\n   * DataProducer id.\r\n   */\n  get id() {\n    return this._id;\n  }\n  /**\r\n   * Whether the DataProducer is closed.\r\n   */\n  get closed() {\n    return this._closed;\n  }\n  /**\r\n   * SCTP stream parameters.\r\n   */\n  get sctpStreamParameters() {\n    return this._sctpStreamParameters;\n  }\n  /**\r\n   * DataChannel readyState.\r\n   */\n  get readyState() {\n    return this._dataChannel.readyState;\n  }\n  /**\r\n   * DataChannel label.\r\n   */\n  get label() {\n    return this._dataChannel.label;\n  }\n  /**\r\n   * DataChannel protocol.\r\n   */\n  get protocol() {\n    return this._dataChannel.protocol;\n  }\n  /**\r\n   * DataChannel bufferedAmount.\r\n   */\n  get bufferedAmount() {\n    return this._dataChannel.bufferedAmount;\n  }\n  /**\r\n   * DataChannel bufferedAmountLowThreshold.\r\n   */\n  get bufferedAmountLowThreshold() {\n    return this._dataChannel.bufferedAmountLowThreshold;\n  }\n  /**\r\n   * Set DataChannel bufferedAmountLowThreshold.\r\n   */\n  set bufferedAmountLowThreshold(bufferedAmountLowThreshold) {\n    this._dataChannel.bufferedAmountLowThreshold = bufferedAmountLowThreshold;\n  }\n  /**\r\n   * App custom data.\r\n   */\n  get appData() {\n    return this._appData;\n  }\n  /**\r\n   * App custom data setter.\r\n   */\n  set appData(appData) {\n    this._appData = appData;\n  }\n  get observer() {\n    return this._observer;\n  }\n  /**\r\n   * Closes the DataProducer.\r\n   */\n  close() {\n    if (this._closed) {\n      return;\n    }\n    logger.debug('close()');\n    this._closed = true;\n    this._dataChannel.close();\n    this.emit('@close');\n    // Emit observer event.\n    this._observer.safeEmit('close');\n  }\n  /**\r\n   * Transport was closed.\r\n   */\n  transportClosed() {\n    if (this._closed) {\n      return;\n    }\n    logger.debug('transportClosed()');\n    this._closed = true;\n    this._dataChannel.close();\n    this.safeEmit('transportclose');\n    // Emit observer event.\n    this._observer.safeEmit('close');\n  }\n  /**\r\n   * Send a message.\r\n   *\r\n   * @param {String|Blob|ArrayBuffer|ArrayBufferView} data.\r\n   */\n  send(data) {\n    logger.debug('send()');\n    if (this._closed) {\n      throw new errors_1.InvalidStateError('closed');\n    }\n    this._dataChannel.send(data);\n  }\n  handleDataChannel() {\n    this._dataChannel.addEventListener('open', () => {\n      if (this._closed) {\n        return;\n      }\n      logger.debug('DataChannel \"open\" event');\n      this.safeEmit('open');\n    });\n    this._dataChannel.addEventListener('error', event => {\n      if (this._closed) {\n        return;\n      }\n      let {\n        error\n      } = event;\n      if (!error) {\n        error = new Error('unknown DataChannel error');\n      }\n      if (error.errorDetail === 'sctp-failure') {\n        logger.error('DataChannel SCTP error [sctpCauseCode:%s]: %s', error.sctpCauseCode, error.message);\n      } else {\n        logger.error('DataChannel \"error\" event: %o', error);\n      }\n      this.safeEmit('error', error);\n    });\n    this._dataChannel.addEventListener('close', () => {\n      if (this._closed) {\n        return;\n      }\n      logger.warn('DataChannel \"close\" event');\n      this._closed = true;\n      this.emit('@close');\n      this.safeEmit('close');\n      // Emit observer event.\n      this._observer.safeEmit('close');\n    });\n    this._dataChannel.addEventListener('message', () => {\n      if (this._closed) {\n        return;\n      }\n      logger.warn('DataChannel \"message\" event in a DataProducer, message discarded');\n    });\n    this._dataChannel.addEventListener('bufferedamountlow', () => {\n      if (this._closed) {\n        return;\n      }\n      this.safeEmit('bufferedamountlow');\n    });\n  }\n}\nexports.DataProducer = DataProducer;","map":{"version":3,"names":["Object","defineProperty","exports","value","DataProducer","Logger_1","require","enhancedEvents_1","errors_1","logger","Logger","EnhancedEventEmitter","_id","_dataChannel","_closed","_sctpStreamParameters","_appData","_observer","constructor","id","dataChannel","sctpStreamParameters","appData","debug","handleDataChannel","closed","readyState","label","protocol","bufferedAmount","bufferedAmountLowThreshold","observer","close","emit","safeEmit","transportClosed","send","data","InvalidStateError","addEventListener","event","error","Error","errorDetail","sctpCauseCode","message","warn"],"sources":["D:/LECHUAN/NT114/DACN_2/DACN-FE/node_modules/mediasoup-client/lib/DataProducer.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.DataProducer = void 0;\r\nconst Logger_1 = require(\"./Logger\");\r\nconst enhancedEvents_1 = require(\"./enhancedEvents\");\r\nconst errors_1 = require(\"./errors\");\r\nconst logger = new Logger_1.Logger('DataProducer');\r\nclass DataProducer extends enhancedEvents_1.EnhancedEventEmitter {\r\n    // Id.\r\n    _id;\r\n    // The underlying RTCDataChannel instance.\r\n    _dataChannel;\r\n    // Closed flag.\r\n    _closed = false;\r\n    // SCTP stream parameters.\r\n    _sctpStreamParameters;\r\n    // App custom data.\r\n    _appData;\r\n    // Observer instance.\r\n    _observer = new enhancedEvents_1.EnhancedEventEmitter();\r\n    constructor({ id, dataChannel, sctpStreamParameters, appData, }) {\r\n        super();\r\n        logger.debug('constructor()');\r\n        this._id = id;\r\n        this._dataChannel = dataChannel;\r\n        this._sctpStreamParameters = sctpStreamParameters;\r\n        this._appData = appData ?? {};\r\n        this.handleDataChannel();\r\n    }\r\n    /**\r\n     * DataProducer id.\r\n     */\r\n    get id() {\r\n        return this._id;\r\n    }\r\n    /**\r\n     * Whether the DataProducer is closed.\r\n     */\r\n    get closed() {\r\n        return this._closed;\r\n    }\r\n    /**\r\n     * SCTP stream parameters.\r\n     */\r\n    get sctpStreamParameters() {\r\n        return this._sctpStreamParameters;\r\n    }\r\n    /**\r\n     * DataChannel readyState.\r\n     */\r\n    get readyState() {\r\n        return this._dataChannel.readyState;\r\n    }\r\n    /**\r\n     * DataChannel label.\r\n     */\r\n    get label() {\r\n        return this._dataChannel.label;\r\n    }\r\n    /**\r\n     * DataChannel protocol.\r\n     */\r\n    get protocol() {\r\n        return this._dataChannel.protocol;\r\n    }\r\n    /**\r\n     * DataChannel bufferedAmount.\r\n     */\r\n    get bufferedAmount() {\r\n        return this._dataChannel.bufferedAmount;\r\n    }\r\n    /**\r\n     * DataChannel bufferedAmountLowThreshold.\r\n     */\r\n    get bufferedAmountLowThreshold() {\r\n        return this._dataChannel.bufferedAmountLowThreshold;\r\n    }\r\n    /**\r\n     * Set DataChannel bufferedAmountLowThreshold.\r\n     */\r\n    set bufferedAmountLowThreshold(bufferedAmountLowThreshold) {\r\n        this._dataChannel.bufferedAmountLowThreshold = bufferedAmountLowThreshold;\r\n    }\r\n    /**\r\n     * App custom data.\r\n     */\r\n    get appData() {\r\n        return this._appData;\r\n    }\r\n    /**\r\n     * App custom data setter.\r\n     */\r\n    set appData(appData) {\r\n        this._appData = appData;\r\n    }\r\n    get observer() {\r\n        return this._observer;\r\n    }\r\n    /**\r\n     * Closes the DataProducer.\r\n     */\r\n    close() {\r\n        if (this._closed) {\r\n            return;\r\n        }\r\n        logger.debug('close()');\r\n        this._closed = true;\r\n        this._dataChannel.close();\r\n        this.emit('@close');\r\n        // Emit observer event.\r\n        this._observer.safeEmit('close');\r\n    }\r\n    /**\r\n     * Transport was closed.\r\n     */\r\n    transportClosed() {\r\n        if (this._closed) {\r\n            return;\r\n        }\r\n        logger.debug('transportClosed()');\r\n        this._closed = true;\r\n        this._dataChannel.close();\r\n        this.safeEmit('transportclose');\r\n        // Emit observer event.\r\n        this._observer.safeEmit('close');\r\n    }\r\n    /**\r\n     * Send a message.\r\n     *\r\n     * @param {String|Blob|ArrayBuffer|ArrayBufferView} data.\r\n     */\r\n    send(data) {\r\n        logger.debug('send()');\r\n        if (this._closed) {\r\n            throw new errors_1.InvalidStateError('closed');\r\n        }\r\n        this._dataChannel.send(data);\r\n    }\r\n    handleDataChannel() {\r\n        this._dataChannel.addEventListener('open', () => {\r\n            if (this._closed) {\r\n                return;\r\n            }\r\n            logger.debug('DataChannel \"open\" event');\r\n            this.safeEmit('open');\r\n        });\r\n        this._dataChannel.addEventListener('error', (event) => {\r\n            if (this._closed) {\r\n                return;\r\n            }\r\n            let { error } = event;\r\n            if (!error) {\r\n                error = new Error('unknown DataChannel error');\r\n            }\r\n            if (error.errorDetail === 'sctp-failure') {\r\n                logger.error('DataChannel SCTP error [sctpCauseCode:%s]: %s', error.sctpCauseCode, error.message);\r\n            }\r\n            else {\r\n                logger.error('DataChannel \"error\" event: %o', error);\r\n            }\r\n            this.safeEmit('error', error);\r\n        });\r\n        this._dataChannel.addEventListener('close', () => {\r\n            if (this._closed) {\r\n                return;\r\n            }\r\n            logger.warn('DataChannel \"close\" event');\r\n            this._closed = true;\r\n            this.emit('@close');\r\n            this.safeEmit('close');\r\n            // Emit observer event.\r\n            this._observer.safeEmit('close');\r\n        });\r\n        this._dataChannel.addEventListener('message', () => {\r\n            if (this._closed) {\r\n                return;\r\n            }\r\n            logger.warn('DataChannel \"message\" event in a DataProducer, message discarded');\r\n        });\r\n        this._dataChannel.addEventListener('bufferedamountlow', () => {\r\n            if (this._closed) {\r\n                return;\r\n            }\r\n            this.safeEmit('bufferedamountlow');\r\n        });\r\n    }\r\n}\r\nexports.DataProducer = DataProducer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}