(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))i(w);new MutationObserver(w=>{for(const m of w)if(m.type==="childList")for(const u of m.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function s(w){const m={};return w.integrity&&(m.integrity=w.integrity),w.referrerPolicy&&(m.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?m.credentials="include":w.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function i(w){if(w.ep)return;w.ep=!0;const m=s(w);fetch(w.href,m)}})();var Nr={},zt={exports:{}},jr,ks;function Xn(){if(ks)return jr;ks=1;var n=1e3,e=n*60,s=e*60,i=s*24,w=i*7,m=i*365.25;jr=function(v,l){l=l||{};var y=typeof v;if(y==="string"&&v.length>0)return u(v);if(y==="number"&&isFinite(v))return l.long?C(v):b(v);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(v))};function u(v){if(v=String(v),!(v.length>100)){var l=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(v);if(l){var y=parseFloat(l[1]),S=(l[2]||"ms").toLowerCase();switch(S){case"years":case"year":case"yrs":case"yr":case"y":return y*m;case"weeks":case"week":case"w":return y*w;case"days":case"day":case"d":return y*i;case"hours":case"hour":case"hrs":case"hr":case"h":return y*s;case"minutes":case"minute":case"mins":case"min":case"m":return y*e;case"seconds":case"second":case"secs":case"sec":case"s":return y*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return y;default:return}}}}function b(v){var l=Math.abs(v);return l>=i?Math.round(v/i)+"d":l>=s?Math.round(v/s)+"h":l>=e?Math.round(v/e)+"m":l>=n?Math.round(v/n)+"s":v+"ms"}function C(v){var l=Math.abs(v);return l>=i?T(v,l,i,"day"):l>=s?T(v,l,s,"hour"):l>=e?T(v,l,e,"minute"):l>=n?T(v,l,n,"second"):v+" ms"}function T(v,l,y,S){var p=l>=y*1.5;return Math.round(v/y)+" "+S+(p?"s":"")}return jr}var Fr,xs;function Jn(){if(xs)return Fr;xs=1;function n(e){i.debug=i,i.default=i,i.coerce=T,i.disable=b,i.enable=m,i.enabled=C,i.humanize=Xn(),i.destroy=v,Object.keys(e).forEach(l=>{i[l]=e[l]}),i.names=[],i.skips=[],i.formatters={};function s(l){let y=0;for(let S=0;S<l.length;S++)y=(y<<5)-y+l.charCodeAt(S),y|=0;return i.colors[Math.abs(y)%i.colors.length]}i.selectColor=s;function i(l){let y,S=null,p,o;function t(...r){if(!t.enabled)return;const c=t,a=Number(new Date),d=a-(y||a);c.diff=d,c.prev=y,c.curr=a,y=a,r[0]=i.coerce(r[0]),typeof r[0]!="string"&&r.unshift("%O");let h=0;r[0]=r[0].replace(/%([a-zA-Z%])/g,(_,R)=>{if(_==="%%")return"%";h++;const f=i.formatters[R];if(typeof f=="function"){const E=r[h];_=f.call(c,E),r.splice(h,1),h--}return _}),i.formatArgs.call(c,r),(c.log||i.log).apply(c,r)}return t.namespace=l,t.useColors=i.useColors(),t.color=i.selectColor(l),t.extend=w,t.destroy=i.destroy,Object.defineProperty(t,"enabled",{enumerable:!0,configurable:!1,get:()=>S!==null?S:(p!==i.namespaces&&(p=i.namespaces,o=i.enabled(l)),o),set:r=>{S=r}}),typeof i.init=="function"&&i.init(t),t}function w(l,y){const S=i(this.namespace+(typeof y>"u"?":":y)+l);return S.log=this.log,S}function m(l){i.save(l),i.namespaces=l,i.names=[],i.skips=[];const y=(typeof l=="string"?l:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const S of y)S[0]==="-"?i.skips.push(S.slice(1)):i.names.push(S)}function u(l,y){let S=0,p=0,o=-1,t=0;for(;S<l.length;)if(p<y.length&&(y[p]===l[S]||y[p]==="*"))y[p]==="*"?(o=p,t=S,p++):(S++,p++);else if(o!==-1)p=o+1,t++,S=t;else return!1;for(;p<y.length&&y[p]==="*";)p++;return p===y.length}function b(){const l=[...i.names,...i.skips.map(y=>"-"+y)].join(",");return i.enable(""),l}function C(l){for(const y of i.skips)if(u(l,y))return!1;for(const y of i.names)if(u(l,y))return!0;return!1}function T(l){return l instanceof Error?l.stack||l.message:l}function v(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return i.enable(i.load()),i}return Fr=n,Fr}var Ls;function mr(){return Ls||(Ls=1,function(n,e){var s={};e.formatArgs=w,e.save=m,e.load=u,e.useColors=i,e.storage=b(),e.destroy=(()=>{let T=!1;return()=>{T||(T=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function i(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let T;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(T=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(T[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function w(T){if(T[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+T[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const v="color: "+this.color;T.splice(1,0,v,"color: inherit");let l=0,y=0;T[0].replace(/%[a-zA-Z%]/g,S=>{S!=="%%"&&(l++,S==="%c"&&(y=l))}),T.splice(y,0,v)}e.log=console.debug||console.log||(()=>{});function m(T){try{T?e.storage.setItem("debug",T):e.storage.removeItem("debug")}catch{}}function u(){let T;try{T=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!T&&typeof process<"u"&&"env"in process&&(T=s.DEBUG),T}function b(){try{return localStorage}catch{}}n.exports=Jn()(e);const{formatters:C}=n.exports;C.j=function(T){try{return JSON.stringify(T)}catch(v){return"[UnexpectedJSONParseError]: "+v.message}}}(zt,zt.exports)),zt.exports}var Le={},Ie={},Ot={exports:{}},Zn=Ot.exports,Is;function ea(){return Is||(Is=1,function(n,e){(function(s,i){var w="2.0.3",m=500,u="user-agent",b="",C="?",T="function",v="undefined",l="object",y="string",S="browser",p="cpu",o="device",t="engine",r="os",c="result",a="name",d="type",h="vendor",g="version",_="architecture",R="major",f="model",E="console",P="mobile",x="tablet",D="smarttv",k="wearable",I="xr",L="embedded",O="inapp",F="brands",q="formFactors",V="fullVersionList",ee="platform",ke="platformVersion",ye="bitness",oe="sec-ch-ua",Fe=oe+"-full-version-list",qn=oe+"-arch",Un=oe+"-"+ye,$n=oe+"-form-factors",zn=oe+"-"+P,Hn=oe+"-"+f,ps=oe+"-"+ee,Vn=ps+"-version",ls=[F,V,P,f,ee,ke,_,q,ye],Nt="Amazon",Be="Apple",hs="ASUS",us="BlackBerry",xe="Google",fs="Huawei",ms="Lenovo",gs="Honor",jt="LG",Sr="Microsoft",Rr="Motorola",Cr="Nvidia",_s="OnePlus",Tr="OPPO",We="Samsung",ws="Sharp",Ye="Sony",Dr="Xiaomi",Er="Zebra",vs="Chrome",ys="Chromium",be="Chromecast",Kn="Edge",Xe="Firefox",Je="Opera",Pr="Facebook",bs="Sogou",qe="Mobile ",Ze=" Browser",kr="Windows",Ss=typeof s!==v,re=Ss&&s.navigator?s.navigator:i,Se=re&&re.userAgentData?re.userAgentData:i,Gn=function(M,A){var N={},z=A;if(!Bt(A)){z={};for(var B in A)for(var K in A[B])z[K]=A[B][K].concat(z[K]?z[K]:[])}for(var j in M)N[j]=z[j]&&z[j].length%2===0?z[j].concat(M[j]):M[j];return N},Ft=function(M){for(var A={},N=0;N<M.length;N++)A[M[N].toUpperCase()]=M[N];return A},xr=function(M,A){if(typeof M===l&&M.length>0){for(var N in M)if(ge(M[N])==ge(A))return!0;return!1}return Ue(M)?ge(A).indexOf(ge(M))!==-1:!1},Bt=function(M,A){for(var N in M)return/^(browser|cpu|device|engine|os)$/.test(N)||(A?Bt(M[N]):!1)},Ue=function(M){return typeof M===y},Lr=function(M){if(!M)return i;for(var A=[],N=$e(/\\?\"/g,M).split(","),z=0;z<N.length;z++)if(N[z].indexOf(";")>-1){var B=tt(N[z]).split(";v=");A[z]={brand:B[0],version:B[1]}}else A[z]=tt(N[z]);return A},ge=function(M){return Ue(M)?M.toLowerCase():M},Ir=function(M){return Ue(M)?$e(/[^\d\.]/g,M).split(".")[0]:i},_e=function(M){for(var A in M){var N=M[A];typeof N==l&&N.length==2?this[N[0]]=N[1]:this[N]=i}return this},$e=function(M,A){return Ue(A)?A.replace(M,b):A},et=function(M){return $e(/\\?\"/g,M)},tt=function(M,A){if(Ue(M))return M=$e(/^\s\s*/,M),typeof A===v?M:M.substring(0,m)},Mr=function(M,A){if(!(!M||!A))for(var N=0,z,B,K,j,H,U;N<A.length&&!H;){var G=A[N],we=A[N+1];for(z=B=0;z<G.length&&!H&&G[z];)if(H=G[z++].exec(M),H)for(K=0;K<we.length;K++)U=H[++B],j=we[K],typeof j===l&&j.length>0?j.length===2?typeof j[1]==T?this[j[0]]=j[1].call(this,U):this[j[0]]=j[1]:j.length===3?typeof j[1]===T&&!(j[1].exec&&j[1].test)?this[j[0]]=U?j[1].call(this,U,j[2]):i:this[j[0]]=U?U.replace(j[1],j[2]):i:j.length===4&&(this[j[0]]=U?j[3].call(this,U.replace(j[1],j[2])):i):this[j]=U||i;N+=2}},Re=function(M,A){for(var N in A)if(typeof A[N]===l&&A[N].length>0){for(var z=0;z<A[N].length;z++)if(xr(A[N][z],M))return N===C?i:N}else if(xr(A[N],M))return N===C?i:N;return A.hasOwnProperty("*")?A["*"]:M},Rs={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Cs={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":i},Ts={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[a,qe+"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[a,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[a,g],[/opios[\/ ]+([\w\.]+)/i],[g,[a,Je+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[g,[a,Je+" GX"]],[/\bopr\/([\w\.]+)/i],[g,[a,Je]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[g,[a,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[g,[a,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon|otter|dooble|(?:lg |qute)browser)\/([-\w\.]+)/i,/(heytap|ovi|115|surf)browser\/([\d\.]+)/i,/(ecosia|weibo)(?:__| \w+@)([\d\.]+)/i],[a,g],[/quark(?:pc)?\/([-\w\.]+)/i],[g,[a,"Quark"]],[/\bddg\/([\w\.]+)/i],[g,[a,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[a,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[g,[a,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[a,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[a,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[g,[a,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[g,[a,"Smart "+ms+Ze]],[/(avast|avg)\/([\w\.]+)/i],[[a,/(.+)/,"$1 Secure"+Ze],g],[/\bfocus\/([\w\.]+)/i],[g,[a,Xe+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[a,Je+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[a,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[a,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[a,Je+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[a,"MIUI"+Ze]],[/fxios\/([\w\.-]+)/i],[g,[a,qe+Xe]],[/\bqihoobrowser\/?([\w\.]*)/i],[g,[a,"360"]],[/\b(qq)\/([\w\.]+)/i],[[a,/(.+)/,"$1Browser"],g],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[a,/(.+)/,"$1"+Ze],g],[/samsungbrowser\/([\w\.]+)/i],[g,[a,We+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[g,[a,bs+" Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[a,bs+" Mobile"],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[a,g],[/(lbbrowser|rekonq)/i],[a],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[g,a],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[a,Pr],g,[d,O]],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(instagram|snapchat)[\/ ]([-\w\.]+)/i],[a,g,[d,O]],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[a,"GSA"],[d,O]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[g,[a,"TikTok"],[d,O]],[/\[(linkedin)app\]/i],[a,[d,O]],[/(chromium)[\/ ]([-\w\.]+)/i],[a,g],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[a,vs+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[a,vs+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[a,"Android"+Ze]],[/chrome\/([\w\.]+) mobile/i],[g,[a,qe+"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[a,g],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[g,[a,qe+"Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[a,qe+"Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[g,a],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[a,[g,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[a,g],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[a,qe+Xe],g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[a,"Netscape"],g],[/(wolvic|librewolf)\/([\w\.]+)/i],[a,g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[a,Xe+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[a,[g,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[a,[g,/[^\d\.]+./,b]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[_,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[_,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[_,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[_,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[_,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[_,/ower/,b,ge]],[/ sun4\w[;\)]/i],[[_,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[_,ge]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[f,[h,We],[d,x]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[f,[h,We],[d,P]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[f,[h,Be],[d,P]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[f,[h,Be],[d,x]],[/(macintosh);/i],[f,[h,Be]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[f,[h,ws],[d,P]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[f,[h,gs],[d,x]],[/honor([-\w ]+)[;\)]/i],[f,[h,gs],[d,P]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[f,[h,fs],[d,x]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[f,[h,fs],[d,P]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[f,/_/g," "],[h,Dr],[d,x]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[f,/_/g," "],[h,Dr],[d,P]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[f,[h,Tr],[d,P]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[f,[h,Re,{OnePlus:["304","403","203"],"*":Tr}],[d,x]],[/(vivo (5r?|6|8l?|go|one|s|x[il]?[2-4]?)[\w\+ ]*)(?: bui|\))/i],[f,[h,"BLU"],[d,P]],[/; vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[f,[h,"Vivo"],[d,P]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[f,[h,"Realme"],[d,P]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[f,[h,Rr],[d,P]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[f,[h,Rr],[d,x]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[f,[h,jt],[d,x]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+(?!.*(?:browser|netcast|android tv|watch))(\w+)/i,/\blg-?([\d\w]+) bui/i],[f,[h,jt],[d,P]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[f,[h,ms],[d,x]],[/(nokia) (t[12][01])/i],[h,f,[d,x]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[f,/_/g," "],[d,P],[h,"Nokia"]],[/(pixel (c|tablet))\b/i],[f,[h,xe],[d,x]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[f,[h,xe],[d,P]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[f,[h,Ye],[d,P]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[f,"Xperia Tablet"],[h,Ye],[d,x]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[f,[h,_s],[d,P]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[f,[h,Nt],[d,x]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[f,/(.+)/g,"Fire Phone $1"],[h,Nt],[d,P]],[/(playbook);[-\w\),; ]+(rim)/i],[f,h,[d,x]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[f,[h,us],[d,P]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[f,[h,hs],[d,x]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[f,[h,hs],[d,P]],[/(nexus 9)/i],[f,[h,"HTC"],[d,x]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[f,/_/g," "],[d,P]],[/tcl (xess p17aa)/i,/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])(_\w(\w|\w\w))?(\)| bui)/i],[f,[h,"TCL"],[d,x]],[/droid [\w\.]+; (418(?:7d|8v)|5087z|5102l|61(?:02[dh]|25[adfh]|27[ai]|56[dh]|59k|65[ah])|a509dl|t(?:43(?:0w|1[adepqu])|50(?:6d|7[adju])|6(?:09dl|10k|12b|71[efho]|76[hjk])|7(?:66[ahju]|67[hw]|7[045][bh]|71[hk]|73o|76[ho]|79w|81[hks]?|82h|90[bhsy]|99b)|810[hs]))(_\w(\w|\w\w))?(\)| bui)/i],[f,[h,"TCL"],[d,P]],[/(itel) ((\w+))/i],[[h,ge],f,[d,Re,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[f,[h,"Acer"],[d,x]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[f,[h,"Meizu"],[d,P]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[f,[h,"Ulefone"],[d,P]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[f,[h,"Energizer"],[d,P]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[f,[h,"Cat"],[d,P]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[f,[h,"Smartfren"],[d,P]],[/droid.+; (a(?:015|06[35]|142p?))/i],[f,[h,"Nothing"],[d,P]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[f,[h,"Archos"],[d,x]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[f,[h,"Archos"],[d,P]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[h,f,[d,x]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (blu|hmd|imo|tcl)[_ ]([\w\+ ]+?)(?: bui|\)|; r)/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[h,f,[d,P]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[h,f,[d,x]],[/(surface duo)/i],[f,[h,Sr],[d,x]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[f,[h,"Fairphone"],[d,P]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[f,[h,Cr],[d,x]],[/(sprint) (\w+)/i],[h,f,[d,P]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[h,Sr],[d,P]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[f,[h,Er],[d,x]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[f,[h,Er],[d,P]],[/smart-tv.+(samsung)/i],[h,[d,D]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[h,We],[d,D]],[/tcast.+(lg)e?. ([-\w]+)/i],[h,f,[d,D]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,jt],[d,D]],[/(apple) ?tv/i],[h,[f,Be+" TV"],[d,D]],[/crkey.*devicetype\/chromecast/i],[[f,be+" Third Generation"],[h,xe],[d,D]],[/crkey.*devicetype\/([^/]*)/i],[[f,/^/,"Chromecast "],[h,xe],[d,D]],[/fuchsia.*crkey/i],[[f,be+" Nest Hub"],[h,xe],[d,D]],[/crkey/i],[[f,be],[h,xe],[d,D]],[/(portaltv)/i],[f,[h,Pr],[d,D]],[/droid.+aft(\w+)( bui|\))/i],[f,[h,Nt],[d,D]],[/(shield \w+ tv)/i],[f,[h,Cr],[d,D]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[f,[h,ws],[d,D]],[/(bravia[\w ]+)( bui|\))/i],[f,[h,Ye],[d,D]],[/(mi(tv|box)-?\w+) bui/i],[f,[h,Dr],[d,D]],[/Hbbtv.*(technisat) (.*);/i],[h,f,[d,D]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,tt],[f,tt],[d,D]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[f,[d,D]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,D]],[/(ouya)/i,/(nintendo) (\w+)/i],[h,f,[d,E]],[/droid.+; (shield)( bui|\))/i],[f,[h,Cr],[d,E]],[/(playstation \w+)/i],[f,[h,Ye],[d,E]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[f,[h,Sr],[d,E]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[f,[h,We],[d,k]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[h,f,[d,k]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[f,[h,Tr],[d,k]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[f,[h,Be],[d,k]],[/(opwwe\d{3})/i],[f,[h,_s],[d,k]],[/(moto 360)/i],[f,[h,Rr],[d,k]],[/(smartwatch 3)/i],[f,[h,Ye],[d,k]],[/(g watch r)/i],[f,[h,jt],[d,k]],[/droid.+; (wt63?0{2,3})\)/i],[f,[h,Er],[d,k]],[/droid.+; (glass) \d/i],[f,[h,xe],[d,I]],[/(pico) (4|neo3(?: link|pro)?)/i],[h,f,[d,I]],[/(quest( \d| pro)?s?).+vr/i],[f,[h,Pr],[d,I]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[d,L]],[/(aeobc)\b/i],[f,[h,Nt],[d,L]],[/(homepod).+mac os/i],[f,[h,Be],[d,L]],[/windows iot/i],[[d,L]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+?(mobile|vr|\d) safari/i],[f,[d,Re,{mobile:"Mobile",xr:"VR","*":x}]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,x]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,P]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[f,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[a,Kn+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[a,g],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[a,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[a,g],[/ladybird\//i],[[a,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,a]],os:[[/microsoft (windows) (vista|xp)/i],[a,g],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[a,[g,Re,Rs]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[g,Re,Rs],[a,kr]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[a,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[a,"macOS"],[g,/_/g,"."]],[/android ([\d\.]+).*crkey/i],[g,[a,be+" Android"]],[/fuchsia.*crkey\/([\d\.]+)/i],[g,[a,be+" Fuchsia"]],[/crkey\/([\d\.]+).*devicetype\/smartspeaker/i],[g,[a,be+" SmartSpeaker"]],[/linux.*crkey\/([\d\.]+)/i],[g,[a,be+" Linux"]],[/crkey\/([\d\.]+)/i],[g,[a,be]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,a],[/(ubuntu) ([\w\.]+) like android/i],[[a,/(.+)/,"$1 Touch"],g],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/\.; ]?([\d\.]*)/i],[a,g],[/\(bb(10);/i],[g,[a,us]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[g,[a,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[a,Xe+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[a,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[a,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[a,"Chrome OS"],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/(pico) .+os([\w\.]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[a,g],[/(sunos) ?([\w\.\d]*)/i],[[a,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[a,g]]},qt=function(){var M={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}};return _e.call(M.init,[[S,[a,g,R,d]],[p,[_]],[o,[d,f,h]],[t,[a,g]],[r,[a,g]]]),_e.call(M.isIgnore,[[S,[g,R]],[t,[g]],[r,[g]]]),_e.call(M.isIgnoreRgx,[[S,/ ?browser$/i],[r,/ ?os$/i]]),_e.call(M.toString,[[S,[a,g]],[p,[_]],[o,[h,f]],[t,[a,g]],[r,[a,g]]]),M}(),Qn=function(M,A){var N=qt.init[A],z=qt.isIgnore[A]||0,B=qt.isIgnoreRgx[A]||0,K=qt.toString[A]||0;function j(){_e.call(this,N)}return j.prototype.getItem=function(){return M},j.prototype.withClientHints=function(){return Se?Se.getHighEntropyValues(ls).then(function(H){return M.setCH(new Ds(H,!1)).parseCH().get()}):M.parseCH().get()},j.prototype.withFeatureCheck=function(){return M.detectFeature().get()},A!=c&&(j.prototype.is=function(H){var U=!1;for(var G in this)if(this.hasOwnProperty(G)&&!xr(z,G)&&ge(B?$e(B,this[G]):this[G])==ge(B?$e(B,H):H)){if(U=!0,H!=v)break}else if(H==v&&U){U=!U;break}return U},j.prototype.toString=function(){var H=b;for(var U in K)typeof this[K[U]]!==v&&(H+=(H?" ":b)+this[K[U]]);return H||v}),Se||(j.prototype.then=function(H){var U=this,G=function(){for(var Ce in U)U.hasOwnProperty(Ce)&&(this[Ce]=U[Ce])};G.prototype={is:j.prototype.is,toString:j.prototype.toString};var we=new G;return H(we),we}),new j};function Ds(M,A){if(M=M||{},_e.call(this,ls),A)_e.call(this,[[F,Lr(M[oe])],[V,Lr(M[Fe])],[P,/\?1/.test(M[zn])],[f,et(M[Hn])],[ee,et(M[ps])],[ke,et(M[Vn])],[_,et(M[qn])],[q,Lr(M[$n])],[ye,et(M[Un])]]);else for(var N in M)this.hasOwnProperty(N)&&typeof M[N]!==v&&(this[N]=M[N])}function Es(M,A,N,z){return this.get=function(B){return B?this.data.hasOwnProperty(B)?this.data[B]:i:this.data},this.set=function(B,K){return this.data[B]=K,this},this.setCH=function(B){return this.uaCH=B,this},this.detectFeature=function(){if(re&&re.userAgent==this.ua)switch(this.itemType){case S:re.brave&&typeof re.brave.isBrave==T&&this.set(a,"Brave");break;case o:!this.get(d)&&Se&&Se[P]&&this.set(d,P),this.get(f)=="Macintosh"&&re&&typeof re.standalone!==v&&re.maxTouchPoints&&re.maxTouchPoints>2&&this.set(f,"iPad").set(d,x);break;case r:!this.get(a)&&Se&&Se[ee]&&this.set(a,Se[ee]);break;case c:var B=this.data,K=function(j){return B[j].getItem().detectFeature().get()};this.set(S,K(S)).set(p,K(p)).set(o,K(o)).set(t,K(t)).set(r,K(r))}return this},this.parseUA=function(){return this.itemType!=c&&Mr.call(this.data,this.ua,this.rgxMap),this.itemType==S&&this.set(R,Ir(this.get(g))),this},this.parseCH=function(){var B=this.uaCH,K=this.rgxMap;switch(this.itemType){case S:case t:var j=B[V]||B[F],H;if(j)for(var U in j){var G=j[U].brand||j[U],we=j[U].version;this.itemType==S&&!/not.a.brand/i.test(G)&&(!H||/chrom/i.test(H)&&G!=ys)&&(G=Re(G,{Chrome:"Google Chrome",Edge:"Microsoft Edge","Chrome WebView":"Android WebView","Chrome Headless":"HeadlessChrome","Huawei Browser":"HuaweiBrowser","MIUI Browser":"Miui Browser","Opera Mobi":"OperaMobile",Yandex:"YaBrowser"}),this.set(a,G).set(g,we).set(R,Ir(we)),H=G),this.itemType==t&&G==ys&&this.set(g,we)}break;case p:var Ce=B[_];Ce&&(Ce&&B[ye]=="64"&&(Ce+="64"),Mr.call(this.data,Ce+";",K));break;case o:if(B[P]&&this.set(d,P),B[f]&&(this.set(f,B[f]),!this.get(d)||!this.get(h))){var rt={};Mr.call(rt,"droid 9; "+B[f]+")",K),!this.get(d)&&rt.type&&this.set(d,rt.type),!this.get(h)&&rt.vendor&&this.set(h,rt.vendor)}if(B[q]){var $t;if(typeof B[q]!="string")for(var Ps=0;!$t&&Ps<B[q].length;)$t=Re(B[q][Ps++],Cs);else $t=Re(B[q],Cs);this.set(d,$t)}break;case r:var Or=B[ee];if(Or){var Ar=B[ke];Or==kr&&(Ar=parseInt(Ir(Ar),10)>=13?"11":"10"),this.set(a,Or).set(g,Ar)}this.get(a)==kr&&B[f]=="Xbox"&&this.set(a,"Xbox").set(g,i);break;case c:var Wn=this.data,st=function(Yn){return Wn[Yn].getItem().setCH(B).parseCH().get()};this.set(S,st(S)).set(p,st(p)).set(o,st(o)).set(t,st(t)).set(r,st(r))}return this},_e.call(this,[["itemType",M],["ua",A],["uaCH",z],["rgxMap",N],["data",Qn(this,M)]]),this}function ce(M,A,N){if(typeof M===l?(Bt(M,!0)?(typeof A===l&&(N=A),A=M):(N=M,A=i),M=i):typeof M===y&&!Bt(A,!0)&&(N=A,A=i),N&&typeof N.append===T){var z={};N.forEach(function(U,G){z[G]=U}),N=z}if(!(this instanceof ce))return new ce(M,A,N).getResult();var B=typeof M===y?M:N&&N[u]?N[u]:re&&re.userAgent?re.userAgent:b,K=new Ds(N,!0),j=A?Gn(Ts,A):Ts,H=function(U){return U==c?function(){return new Es(U,B,j,K).set("ua",B).set(S,this.getBrowser()).set(p,this.getCPU()).set(o,this.getDevice()).set(t,this.getEngine()).set(r,this.getOS()).get()}:function(){return new Es(U,B,j[U],K).parseUA().get()}};return _e.call(this,[["getBrowser",H(S)],["getCPU",H(p)],["getDevice",H(o)],["getEngine",H(t)],["getOS",H(r)],["getResult",H(c)],["getUA",function(){return B}],["setUA",function(U){return Ue(U)&&(B=U.length>m?tt(U,m):U),this}]]).setUA(B),this}ce.VERSION=w,ce.BROWSER=Ft([a,g,R,d]),ce.CPU=Ft([_]),ce.DEVICE=Ft([f,h,d,E,P,D,x,k,L]),ce.ENGINE=ce.OS=Ft([a,g]),n.exports&&(e=n.exports=ce),e.UAParser=ce;var ze=Ss&&(s.jQuery||s.Zepto);if(ze&&!ze.ua){var Ut=new ce;ze.ua=Ut.getResult(),ze.ua.get=function(){return Ut.getUA()},ze.ua.set=function(M){Ut.setUA(M);var A=Ut.getResult();for(var N in A)ze.ua[N]=A[N]}}})(typeof window=="object"?window:Zn)}(Ot,Ot.exports)),Ot.exports}var it={},Ms;function Q(){if(Ms)return it;Ms=1,Object.defineProperty(it,"__esModule",{value:!0}),it.Logger=void 0;const n=mr(),e="mediasoup-client";class s{_debug;_warn;_error;constructor(w){w?(this._debug=(0,n.default)(`${e}:${w}`),this._warn=(0,n.default)(`${e}:WARN:${w}`),this._error=(0,n.default)(`${e}:ERROR:${w}`)):(this._debug=(0,n.default)(e),this._warn=(0,n.default)(`${e}:WARN`),this._error=(0,n.default)(`${e}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}return it.Logger=s,it}var nt={},Ht={exports:{}},Os;function ta(){if(Os)return Ht.exports;Os=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(h,g,_){return Function.prototype.apply.call(h,g,_)},s;n&&typeof n.ownKeys=="function"?s=n.ownKeys:Object.getOwnPropertySymbols?s=function(h){return Object.getOwnPropertyNames(h).concat(Object.getOwnPropertySymbols(h))}:s=function(h){return Object.getOwnPropertyNames(h)};function i(d){console&&console.warn&&console.warn(d)}var w=Number.isNaN||function(h){return h!==h};function m(){m.init.call(this)}Ht.exports=m,Ht.exports.once=r,m.EventEmitter=m,m.prototype._events=void 0,m.prototype._eventsCount=0,m.prototype._maxListeners=void 0;var u=10;function b(d){if(typeof d!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof d)}Object.defineProperty(m,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(d){if(typeof d!="number"||d<0||w(d))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+d+".");u=d}}),m.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},m.prototype.setMaxListeners=function(h){if(typeof h!="number"||h<0||w(h))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+h+".");return this._maxListeners=h,this};function C(d){return d._maxListeners===void 0?m.defaultMaxListeners:d._maxListeners}m.prototype.getMaxListeners=function(){return C(this)},m.prototype.emit=function(h){for(var g=[],_=1;_<arguments.length;_++)g.push(arguments[_]);var R=h==="error",f=this._events;if(f!==void 0)R=R&&f.error===void 0;else if(!R)return!1;if(R){var E;if(g.length>0&&(E=g[0]),E instanceof Error)throw E;var P=new Error("Unhandled error."+(E?" ("+E.message+")":""));throw P.context=E,P}var x=f[h];if(x===void 0)return!1;if(typeof x=="function")e(x,this,g);else for(var D=x.length,k=p(x,D),_=0;_<D;++_)e(k[_],this,g);return!0};function T(d,h,g,_){var R,f,E;if(b(g),f=d._events,f===void 0?(f=d._events=Object.create(null),d._eventsCount=0):(f.newListener!==void 0&&(d.emit("newListener",h,g.listener?g.listener:g),f=d._events),E=f[h]),E===void 0)E=f[h]=g,++d._eventsCount;else if(typeof E=="function"?E=f[h]=_?[g,E]:[E,g]:_?E.unshift(g):E.push(g),R=C(d),R>0&&E.length>R&&!E.warned){E.warned=!0;var P=new Error("Possible EventEmitter memory leak detected. "+E.length+" "+String(h)+" listeners added. Use emitter.setMaxListeners() to increase limit");P.name="MaxListenersExceededWarning",P.emitter=d,P.type=h,P.count=E.length,i(P)}return d}m.prototype.addListener=function(h,g){return T(this,h,g,!1)},m.prototype.on=m.prototype.addListener,m.prototype.prependListener=function(h,g){return T(this,h,g,!0)};function v(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(d,h,g){var _={fired:!1,wrapFn:void 0,target:d,type:h,listener:g},R=v.bind(_);return R.listener=g,_.wrapFn=R,R}m.prototype.once=function(h,g){return b(g),this.on(h,l(this,h,g)),this},m.prototype.prependOnceListener=function(h,g){return b(g),this.prependListener(h,l(this,h,g)),this},m.prototype.removeListener=function(h,g){var _,R,f,E,P;if(b(g),R=this._events,R===void 0)return this;if(_=R[h],_===void 0)return this;if(_===g||_.listener===g)--this._eventsCount===0?this._events=Object.create(null):(delete R[h],R.removeListener&&this.emit("removeListener",h,_.listener||g));else if(typeof _!="function"){for(f=-1,E=_.length-1;E>=0;E--)if(_[E]===g||_[E].listener===g){P=_[E].listener,f=E;break}if(f<0)return this;f===0?_.shift():o(_,f),_.length===1&&(R[h]=_[0]),R.removeListener!==void 0&&this.emit("removeListener",h,P||g)}return this},m.prototype.off=m.prototype.removeListener,m.prototype.removeAllListeners=function(h){var g,_,R;if(_=this._events,_===void 0)return this;if(_.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):_[h]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete _[h]),this;if(arguments.length===0){var f=Object.keys(_),E;for(R=0;R<f.length;++R)E=f[R],E!=="removeListener"&&this.removeAllListeners(E);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(g=_[h],typeof g=="function")this.removeListener(h,g);else if(g!==void 0)for(R=g.length-1;R>=0;R--)this.removeListener(h,g[R]);return this};function y(d,h,g){var _=d._events;if(_===void 0)return[];var R=_[h];return R===void 0?[]:typeof R=="function"?g?[R.listener||R]:[R]:g?t(R):p(R,R.length)}m.prototype.listeners=function(h){return y(this,h,!0)},m.prototype.rawListeners=function(h){return y(this,h,!1)},m.listenerCount=function(d,h){return typeof d.listenerCount=="function"?d.listenerCount(h):S.call(d,h)},m.prototype.listenerCount=S;function S(d){var h=this._events;if(h!==void 0){var g=h[d];if(typeof g=="function")return 1;if(g!==void 0)return g.length}return 0}m.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]};function p(d,h){for(var g=new Array(h),_=0;_<h;++_)g[_]=d[_];return g}function o(d,h){for(;h+1<d.length;h++)d[h]=d[h+1];d.pop()}function t(d){for(var h=new Array(d.length),g=0;g<h.length;++g)h[g]=d[g].listener||d[g];return h}function r(d,h){return new Promise(function(g,_){function R(E){d.removeListener(h,f),_(E)}function f(){typeof d.removeListener=="function"&&d.removeListener("error",R),g([].slice.call(arguments))}a(d,h,f,{once:!0}),h!=="error"&&c(d,R,{once:!0})})}function c(d,h,g){typeof d.on=="function"&&a(d,"error",h,g)}function a(d,h,g,_){if(typeof d.on=="function")_.once?d.once(h,g):d.on(h,g);else if(typeof d.addEventListener=="function")d.addEventListener(h,function R(f){_.once&&d.removeEventListener(h,R),g(f)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof d)}return Ht.exports}var As;function De(){if(As)return nt;As=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.EnhancedEventEmitter=void 0;const n=ta(),e=Q(),s=new e.Logger("EnhancedEventEmitter");class i extends n.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(m,...u){return super.emit(m,...u)}safeEmit(m,...u){try{return super.emit(m,...u)}catch(b){s.error("safeEmit() | event listener threw an error [eventName:%s]:%o",m,b);try{super.emit("listenererror",m,b)}catch{}return!!super.listenerCount(m)}}on(m,u){return super.on(m,u),this}off(m,u){return super.off(m,u),this}addListener(m,u){return super.on(m,u),this}prependListener(m,u){return super.prependListener(m,u),this}once(m,u){return super.once(m,u),this}prependOnceListener(m,u){return super.prependOnceListener(m,u),this}removeListener(m,u){return super.off(m,u),this}removeAllListeners(m){return super.removeAllListeners(m),this}listenerCount(m){return super.listenerCount(m)}listeners(m){return super.listeners(m)}rawListeners(m){return super.rawListeners(m)}}return nt.EnhancedEventEmitter=i,nt}var Me={},Ns;function J(){if(Ns)return Me;Ns=1,Object.defineProperty(Me,"__esModule",{value:!0}),Me.InvalidStateError=Me.UnsupportedError=void 0;class n extends Error{constructor(i){super(i),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,n):this.stack=new Error(i).stack}}Me.UnsupportedError=n;class e extends Error{constructor(i){super(i),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,e):this.stack=new Error(i).stack}}return Me.InvalidStateError=e,Me}var He={},js;function Y(){if(js)return He;js=1,Object.defineProperty(He,"__esModule",{value:!0}),He.clone=n,He.generateRandomNumber=e,He.deepFreeze=s;function n(i){if(i!==void 0)return Number.isNaN(i)?NaN:typeof structuredClone=="function"?structuredClone(i):JSON.parse(JSON.stringify(i))}function e(){return Math.round(Math.random()*1e7)}function s(i){const w=Reflect.ownKeys(i);for(const m of w){const u=i[m];(u&&typeof u=="object"||typeof u=="function")&&s(u)}return Object.freeze(i)}return He}var te={},X={},Oe={},Fs;function ra(){if(Fs)return Oe;Fs=1;var n=Oe&&Oe.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.Logger=void 0;const e=n(mr()),s="h264-profile-level-id";class i{constructor(m){m?(this._debug=(0,e.default)(`${s}:${m}`),this._warn=(0,e.default)(`${s}:WARN:${m}`),this._error=(0,e.default)(`${s}:ERROR:${m}`)):(this._debug=(0,e.default)(s),this._warn=(0,e.default)(`${s}:WARN`),this._error=(0,e.default)(`${s}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}return Oe.Logger=i,Oe}var Bs;function sa(){if(Bs)return X;Bs=1,Object.defineProperty(X,"__esModule",{value:!0}),X.ProfileLevelId=X.Level=X.Profile=void 0,X.parseProfileLevelId=v,X.profileLevelIdToString=l,X.profileToString=y,X.levelToString=S,X.parseSdpProfileLevelId=p,X.isSameProfile=o,X.isSameProfileAndLevel=t,X.generateProfileLevelIdStringForAnswer=r,X.supportedLevel=c;const n=ra(),e=new n.Logger;var s;(function(_){_[_.ConstrainedBaseline=1]="ConstrainedBaseline",_[_.Baseline=2]="Baseline",_[_.Main=3]="Main",_[_.ConstrainedHigh=4]="ConstrainedHigh",_[_.High=5]="High",_[_.PredictiveHigh444=6]="PredictiveHigh444"})(s||(X.Profile=s={}));var i;(function(_){_[_.L1_b=0]="L1_b",_[_.L1=10]="L1",_[_.L1_1=11]="L1_1",_[_.L1_2=12]="L1_2",_[_.L1_3=13]="L1_3",_[_.L2=20]="L2",_[_.L2_1=21]="L2_1",_[_.L2_2=22]="L2_2",_[_.L3=30]="L3",_[_.L3_1=31]="L3_1",_[_.L3_2=32]="L3_2",_[_.L4=40]="L4",_[_.L4_1=41]="L4_1",_[_.L4_2=42]="L4_2",_[_.L5=50]="L5",_[_.L5_1=51]="L5_1",_[_.L5_2=52]="L5_2"})(i||(X.Level=i={}));class w{constructor(R,f){this.profile=R,this.level=f}}X.ProfileLevelId=w;const m=new w(s.ConstrainedBaseline,i.L3_1);class u{constructor(R){this.mask=~a("x",R),this.masked_value=a("1",R)}isMatch(R){return this.masked_value===(R&this.mask)}}class b{constructor(R,f,E){this.profile_idc=R,this.profile_iop=f,this.profile=E}}const C=[new b(66,new u("x1xx0000"),s.ConstrainedBaseline),new b(77,new u("1xxx0000"),s.ConstrainedBaseline),new b(88,new u("11xx0000"),s.ConstrainedBaseline),new b(66,new u("x0xx0000"),s.Baseline),new b(88,new u("10xx0000"),s.Baseline),new b(77,new u("0x0x0000"),s.Main),new b(100,new u("00000000"),s.High),new b(100,new u("00001100"),s.ConstrainedHigh),new b(244,new u("00000000"),s.PredictiveHigh444)],T=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:i.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:i.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:i.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:i.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:i.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:i.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:i.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:i.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:i.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:i.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:i.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:i.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:i.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:i.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:i.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:i.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:i.L5_2}];function v(_){if(typeof _!="string"||_.length!==6)return;const f=parseInt(_,16);if(f===0)return;const E=f&255,P=f>>8&255,x=f>>16&255;let D;switch(E){case i.L1_1:{D=(P&16)!==0?i.L1_b:i.L1_1;break}case i.L1:case i.L1_2:case i.L1_3:case i.L2:case i.L2_1:case i.L2_2:case i.L3:case i.L3_1:case i.L3_2:case i.L4:case i.L4_1:case i.L4_2:case i.L5:case i.L5_1:case i.L5_2:{D=E;break}default:{e.warn(`parseProfileLevelId() | unrecognized level_idc [str:${_}, level_idc:${E}]`);return}}for(const k of C)if(x===k.profile_idc&&k.profile_iop.isMatch(P))return e.debug(`parseProfileLevelId() | result [str:${_}, profile:${k.profile}, level:${D}]`),new w(k.profile,D);e.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${_}, profile_idc:${x}, profile_iop:${P}]`)}function l(_){if(_.level==i.L1_b)switch(_.profile){case s.ConstrainedBaseline:return"42f00b";case s.Baseline:return"42100b";case s.Main:return"4d100b";default:{e.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${_.profile}`);return}}let R;switch(_.profile){case s.ConstrainedBaseline:{R="42e0";break}case s.Baseline:{R="4200";break}case s.Main:{R="4d00";break}case s.ConstrainedHigh:{R="640c";break}case s.High:{R="6400";break}case s.PredictiveHigh444:{R="f400";break}default:{e.warn(`profileLevelIdToString() | unrecognized profile ${_.profile}`);return}}let f=_.level.toString(16);return f.length===1&&(f=`0${f}`),`${R}${f}`}function y(_){switch(_){case s.ConstrainedBaseline:return"ConstrainedBaseline";case s.Baseline:return"Baseline";case s.Main:return"Main";case s.ConstrainedHigh:return"ConstrainedHigh";case s.High:return"High";case s.PredictiveHigh444:return"PredictiveHigh444";default:{e.warn(`profileToString() | unrecognized profile ${_}`);return}}}function S(_){switch(_){case i.L1_b:return"1b";case i.L1:return"1";case i.L1_1:return"1.1";case i.L1_2:return"1.2";case i.L1_3:return"1.3";case i.L2:return"2";case i.L2_1:return"2.1";case i.L2_2:return"2.2";case i.L3:return"3";case i.L3_1:return"3.1";case i.L3_2:return"3.2";case i.L4:return"4";case i.L4_1:return"4.1";case i.L4_2:return"4.2";case i.L5:return"5";case i.L5_1:return"5.1";case i.L5_2:return"5.2";default:{e.warn(`levelToString() | unrecognized level ${_}`);return}}}function p(_={}){const R=_["profile-level-id"];return R?v(R):m}function o(_={},R={}){const f=p(_),E=p(R);return!!(f&&E&&f.profile===E.profile)}function t(_={},R={}){const f=p(_),E=p(R);return!!(f&&E&&f.profile===E.profile&&f.level==E.level)}function r(_={},R={}){if(!_["profile-level-id"]&&!R["profile-level-id"]){e.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");return}const f=p(_),E=p(R);if(!f)throw new TypeError("invalid local_profile_level_id");if(!E)throw new TypeError("invalid remote_profile_level_id");if(f.profile!==E.profile)throw new TypeError("H264 Profile mismatch");const P=g(_)&&g(R),x=f.level,D=E.level,k=h(x,D),I=P?x:k;return e.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${f.profile}, level:${I}]`),l(new w(f.profile,I))}function c(_,R){for(let E=T.length-1;E>=0;--E){const P=T[E];if(P.max_macroblock_frame_size*256<=_&&P.max_macroblocks_per_second<=R*P.max_macroblock_frame_size)return e.debug(`supportedLevel() | result [max_frame_pixel_count:${_}, max_fps:${R}, level:${P.level}]`),P.level}e.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${_}, max_fps:${R}]`)}function a(_,R){return+(R[0]===_)<<7|+(R[1]===_)<<6|+(R[2]===_)<<5|+(R[3]===_)<<4|+(R[4]===_)<<3|+(R[5]===_)<<2|+(R[6]===_)<<1|+(R[7]===_)<<0}function d(_,R){return _===i.L1_b?R!==i.L1&&R!==i.L1_b:R===i.L1_b?_!==i.L1:_<R}function h(_,R){return d(_,R)?_:R}function g(_={}){const R=_["level-asymmetry-allowed"];return R===!0||R===1||R==="1"}return X}var qs;function Z(){if(qs)return te;qs=1,Object.defineProperty(te,"__esModule",{value:!0}),te.validateRtpCapabilities=m,te.validateRtpParameters=u,te.validateSctpStreamParameters=b,te.validateSctpCapabilities=C,te.getExtendedRtpCapabilities=T,te.getRecvRtpCapabilities=v,te.getSendingRtpParameters=l,te.getSendingRemoteRtpParameters=y,te.reduceCodecs=S,te.generateProbatorRtpParameters=p,te.canSend=o,te.canReceive=t;const n=sa(),e=Y(),s="probator",i=1234,w=127;function m(D){if(typeof D!="object")throw new TypeError("caps is not an object");if(D.codecs&&!Array.isArray(D.codecs))throw new TypeError("caps.codecs is not an array");D.codecs||(D.codecs=[]);for(const k of D.codecs)r(k);if(D.headerExtensions&&!Array.isArray(D.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");D.headerExtensions||(D.headerExtensions=[]);for(const k of D.headerExtensions)a(k)}function u(D){if(typeof D!="object")throw new TypeError("params is not an object");if(D.mid&&typeof D.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(D.codecs))throw new TypeError("missing params.codecs");for(const k of D.codecs)d(k);if(D.headerExtensions&&!Array.isArray(D.headerExtensions))throw new TypeError("params.headerExtensions is not an array");D.headerExtensions||(D.headerExtensions=[]);for(const k of D.headerExtensions)h(k);if(D.encodings&&!Array.isArray(D.encodings))throw new TypeError("params.encodings is not an array");D.encodings||(D.encodings=[]);for(const k of D.encodings)g(k);if(D.rtcp&&typeof D.rtcp!="object")throw new TypeError("params.rtcp is not an object");D.rtcp||(D.rtcp={}),_(D.rtcp)}function b(D){if(typeof D!="object")throw new TypeError("params is not an object");if(typeof D.streamId!="number")throw new TypeError("missing params.streamId");let k=!1;if(typeof D.ordered=="boolean"?k=!0:D.ordered=!0,D.maxPacketLifeTime&&typeof D.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(D.maxRetransmits&&typeof D.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(D.maxPacketLifeTime&&D.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(k&&D.ordered&&(D.maxPacketLifeTime||D.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!k&&(D.maxPacketLifeTime||D.maxRetransmits)&&(D.ordered=!1),D.label&&typeof D.label!="string")throw new TypeError("invalid params.label");if(D.protocol&&typeof D.protocol!="string")throw new TypeError("invalid params.protocol")}function C(D){if(typeof D!="object")throw new TypeError("caps is not an object");if(!D.numStreams||typeof D.numStreams!="object")throw new TypeError("missing caps.numStreams");R(D.numStreams)}function T(D,k,I){const L={codecs:[],headerExtensions:[]};if(I)for(const O of D.codecs??[]){if(f(O))continue;const F=(k.codecs??[]).find(V=>E(V,O,{strict:!0,modify:!0}));if(!F)continue;const q={mimeType:O.mimeType,kind:O.kind,clockRate:O.clockRate,channels:O.channels,localPayloadType:O.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:F.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:O.parameters,remoteParameters:F.parameters,rtcpFeedback:x(O,F)};L.codecs.push(q)}else for(const O of k.codecs??[]){if(f(O))continue;const F=(D.codecs??[]).find(V=>E(V,O,{strict:!0,modify:!0}));if(!F)continue;const q={mimeType:F.mimeType,kind:F.kind,clockRate:F.clockRate,channels:F.channels,localPayloadType:F.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:O.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:F.parameters,remoteParameters:O.parameters,rtcpFeedback:x(F,O)};L.codecs.push(q)}for(const O of L.codecs){const F=D.codecs.find(V=>f(V)&&V.parameters.apt===O.localPayloadType),q=k.codecs.find(V=>f(V)&&V.parameters.apt===O.remotePayloadType);F&&q&&(O.localRtxPayloadType=F.preferredPayloadType,O.remoteRtxPayloadType=q.preferredPayloadType)}for(const O of k.headerExtensions){const F=D.headerExtensions.find(V=>P(V,O));if(!F)continue;const q={kind:O.kind,uri:O.uri,sendId:F.preferredId,recvId:O.preferredId,encrypt:F.preferredEncrypt,direction:"sendrecv"};switch(O.direction){case"sendrecv":{q.direction="sendrecv";break}case"recvonly":{q.direction="sendonly";break}case"sendonly":{q.direction="recvonly";break}case"inactive":{q.direction="inactive";break}}L.headerExtensions.push(q)}return L}function v(D){const k={codecs:[],headerExtensions:[]};for(const I of D.codecs){const L={mimeType:I.mimeType,kind:I.kind,preferredPayloadType:I.remotePayloadType,clockRate:I.clockRate,channels:I.channels,parameters:I.localParameters,rtcpFeedback:I.rtcpFeedback};if(k.codecs.push(L),!I.remoteRtxPayloadType)continue;const O={mimeType:`${I.kind}/rtx`,kind:I.kind,preferredPayloadType:I.remoteRtxPayloadType,clockRate:I.clockRate,parameters:{apt:I.remotePayloadType},rtcpFeedback:[]};k.codecs.push(O)}for(const I of D.headerExtensions){if(I.direction!=="sendrecv"&&I.direction!=="recvonly")continue;const L={kind:I.kind,uri:I.uri,preferredId:I.recvId,preferredEncrypt:I.encrypt,direction:I.direction};k.headerExtensions.push(L)}return k}function l(D,k){const I={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const L of k.codecs){if(L.kind!==D)continue;const O={mimeType:L.mimeType,payloadType:L.localPayloadType,clockRate:L.clockRate,channels:L.channels,parameters:L.localParameters,rtcpFeedback:L.rtcpFeedback};if(I.codecs.push(O),L.localRtxPayloadType){const F={mimeType:`${L.kind}/rtx`,payloadType:L.localRtxPayloadType,clockRate:L.clockRate,parameters:{apt:L.localPayloadType},rtcpFeedback:[]};I.codecs.push(F)}}for(const L of k.headerExtensions){if(L.kind&&L.kind!==D||L.direction!=="sendrecv"&&L.direction!=="sendonly")continue;const O={uri:L.uri,id:L.sendId,encrypt:L.encrypt,parameters:{}};I.headerExtensions.push(O)}return I}function y(D,k){const I={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const L of k.codecs){if(L.kind!==D)continue;const O={mimeType:L.mimeType,payloadType:L.localPayloadType,clockRate:L.clockRate,channels:L.channels,parameters:L.remoteParameters,rtcpFeedback:L.rtcpFeedback};if(I.codecs.push(O),L.localRtxPayloadType){const F={mimeType:`${L.kind}/rtx`,payloadType:L.localRtxPayloadType,clockRate:L.clockRate,parameters:{apt:L.localPayloadType},rtcpFeedback:[]};I.codecs.push(F)}}for(const L of k.headerExtensions){if(L.kind&&L.kind!==D||L.direction!=="sendrecv"&&L.direction!=="sendonly")continue;const O={uri:L.uri,id:L.sendId,encrypt:L.encrypt,parameters:{}};I.headerExtensions.push(O)}if(I.headerExtensions.some(L=>L.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const L of I.codecs)L.rtcpFeedback=(L.rtcpFeedback??[]).filter(O=>O.type!=="goog-remb");else if(I.headerExtensions.some(L=>L.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const L of I.codecs)L.rtcpFeedback=(L.rtcpFeedback??[]).filter(O=>O.type!=="transport-cc");else for(const L of I.codecs)L.rtcpFeedback=(L.rtcpFeedback??[]).filter(O=>O.type!=="transport-cc"&&O.type!=="goog-remb");return I}function S(D,k){const I=[];if(!k)I.push(D[0]),f(D[1])&&I.push(D[1]);else{for(let L=0;L<D.length;++L)if(E(D[L],k,{strict:!0})){I.push(D[L]),f(D[L+1])&&I.push(D[L+1]);break}if(I.length===0)throw new TypeError("no matching codec found")}return I}function p(D){D=e.clone(D),u(D);const k={mid:s,codecs:[],headerExtensions:[],encodings:[{ssrc:i}],rtcp:{cname:"probator"}};return k.codecs.push(D.codecs[0]),k.codecs[0].payloadType=w,k.headerExtensions=D.headerExtensions,k}function o(D,k){return k.codecs.some(I=>I.kind===D)}function t(D,k){if(u(D),D.codecs.length===0)return!1;const I=D.codecs[0];return k.codecs.some(L=>L.remotePayloadType===I.payloadType)}function r(D){const k=new RegExp("^(audio|video)/(.+)","i");if(typeof D!="object")throw new TypeError("codec is not an object");if(!D.mimeType||typeof D.mimeType!="string")throw new TypeError("missing codec.mimeType");const I=k.exec(D.mimeType);if(!I)throw new TypeError("invalid codec.mimeType");if(D.kind=I[1].toLowerCase(),D.preferredPayloadType&&typeof D.preferredPayloadType!="number")throw new TypeError("invalid codec.preferredPayloadType");if(typeof D.clockRate!="number")throw new TypeError("missing codec.clockRate");D.kind==="audio"?typeof D.channels!="number"&&(D.channels=1):delete D.channels,(!D.parameters||typeof D.parameters!="object")&&(D.parameters={});for(const L of Object.keys(D.parameters)){let O=D.parameters[L];if(O===void 0&&(D.parameters[L]="",O=""),typeof O!="string"&&typeof O!="number")throw new TypeError(`invalid codec parameter [key:${L}s, value:${O}]`);if(L==="apt"&&typeof O!="number")throw new TypeError("invalid codec apt parameter")}(!D.rtcpFeedback||!Array.isArray(D.rtcpFeedback))&&(D.rtcpFeedback=[]);for(const L of D.rtcpFeedback)c(L)}function c(D){if(typeof D!="object")throw new TypeError("fb is not an object");if(!D.type||typeof D.type!="string")throw new TypeError("missing fb.type");(!D.parameter||typeof D.parameter!="string")&&(D.parameter="")}function a(D){if(typeof D!="object")throw new TypeError("ext is not an object");if(D.kind!=="audio"&&D.kind!=="video")throw new TypeError("invalid ext.kind");if(!D.uri||typeof D.uri!="string")throw new TypeError("missing ext.uri");if(typeof D.preferredId!="number")throw new TypeError("missing ext.preferredId");if(D.preferredEncrypt&&typeof D.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(D.preferredEncrypt||(D.preferredEncrypt=!1),D.direction&&typeof D.direction!="string")throw new TypeError("invalid ext.direction");D.direction||(D.direction="sendrecv")}function d(D){const k=new RegExp("^(audio|video)/(.+)","i");if(typeof D!="object")throw new TypeError("codec is not an object");if(!D.mimeType||typeof D.mimeType!="string")throw new TypeError("missing codec.mimeType");const I=k.exec(D.mimeType);if(!I)throw new TypeError("invalid codec.mimeType");if(typeof D.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof D.clockRate!="number")throw new TypeError("missing codec.clockRate");I[1].toLowerCase()==="audio"?typeof D.channels!="number"&&(D.channels=1):delete D.channels,(!D.parameters||typeof D.parameters!="object")&&(D.parameters={});for(const O of Object.keys(D.parameters)){let F=D.parameters[O];if(F===void 0&&(D.parameters[O]="",F=""),typeof F!="string"&&typeof F!="number")throw new TypeError(`invalid codec parameter [key:${O}s, value:${F}]`);if(O==="apt"&&typeof F!="number")throw new TypeError("invalid codec apt parameter")}(!D.rtcpFeedback||!Array.isArray(D.rtcpFeedback))&&(D.rtcpFeedback=[]);for(const O of D.rtcpFeedback)c(O)}function h(D){if(typeof D!="object")throw new TypeError("ext is not an object");if(!D.uri||typeof D.uri!="string")throw new TypeError("missing ext.uri");if(typeof D.id!="number")throw new TypeError("missing ext.id");if(D.encrypt&&typeof D.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");D.encrypt||(D.encrypt=!1),(!D.parameters||typeof D.parameters!="object")&&(D.parameters={});for(const k of Object.keys(D.parameters)){let I=D.parameters[k];if(I===void 0&&(D.parameters[k]="",I=""),typeof I!="string"&&typeof I!="number")throw new TypeError("invalid header extension parameter")}}function g(D){if(typeof D!="object")throw new TypeError("encoding is not an object");if(D.ssrc&&typeof D.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(D.rid&&typeof D.rid!="string")throw new TypeError("invalid encoding.rid");if(D.rtx&&typeof D.rtx!="object")throw new TypeError("invalid encoding.rtx");if(D.rtx&&typeof D.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!D.dtx||typeof D.dtx!="boolean")&&(D.dtx=!1),D.scalabilityMode&&typeof D.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function _(D){if(typeof D!="object")throw new TypeError("rtcp is not an object");if(D.cname&&typeof D.cname!="string")throw new TypeError("invalid rtcp.cname");(!D.reducedSize||typeof D.reducedSize!="boolean")&&(D.reducedSize=!0)}function R(D){if(typeof D!="object")throw new TypeError("numStreams is not an object");if(typeof D.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof D.MIS!="number")throw new TypeError("missing numStreams.MIS")}function f(D){return D?/.+\/rtx$/i.test(D.mimeType):!1}function E(D,k,{strict:I=!1,modify:L=!1}={}){const O=D.mimeType.toLowerCase(),F=k.mimeType.toLowerCase();if(O!==F||D.clockRate!==k.clockRate||D.channels!==k.channels)return!1;switch(O){case"video/h264":{if(I){const q=D.parameters["packetization-mode"]??0,V=k.parameters["packetization-mode"]??0;if(q!==V||!n.isSameProfile(D.parameters,k.parameters))return!1;let ee;try{ee=n.generateProfileLevelIdStringForAnswer(D.parameters,k.parameters)}catch{return!1}L&&(ee?(D.parameters["profile-level-id"]=ee,k.parameters["profile-level-id"]=ee):(delete D.parameters["profile-level-id"],delete k.parameters["profile-level-id"]))}break}case"video/vp9":{if(I){const q=D.parameters["profile-id"]??0,V=k.parameters["profile-id"]??0;if(q!==V)return!1}break}}return!0}function P(D,k){return!(D.kind&&k.kind&&D.kind!==k.kind||D.uri!==k.uri)}function x(D,k){const I=[];for(const L of D.rtcpFeedback??[]){const O=(k.rtcpFeedback??[]).find(F=>F.type===L.type&&(F.parameter===L.parameter||!F.parameter&&!L.parameter));O&&I.push(O)}return I}return te}var at={},Br={},ot={},ct={},Us;function ia(){if(Us)return ct;Us=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.Logger=void 0;const n=mr(),e="awaitqueue";let s=class{_debug;_warn;_error;constructor(w){w?(this._debug=n(`${e}:${w}`),this._warn=n(`${e}:WARN:${w}`),this._error=n(`${e}:ERROR:${w}`)):(this._debug=n(e),this._warn=n(`${e}:WARN`),this._error=n(`${e}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};return ct.Logger=s,ct}var Ae={},$s;function sn(){if($s)return Ae;$s=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.AwaitQueueRemovedTaskError=Ae.AwaitQueueStoppedError=void 0;class n extends Error{constructor(i){super(i??"queue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,n)}}Ae.AwaitQueueStoppedError=n;class e extends Error{constructor(i){super(i??"queue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,e)}}return Ae.AwaitQueueRemovedTaskError=e,Ae}var zs;function na(){if(zs)return ot;zs=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.AwaitQueue=void 0;const n=ia(),e=sn(),s=new n.Logger("AwaitQueue");let i=class{pendingTasks=new Map;nextTaskId=0;stopping=!1;constructor(){s.debug("constructor()")}get size(){return this.pendingTasks.size}async push(m,u){if(u=u??m.name,s.debug(`push() [name:${u}]`),typeof m!="function")throw new TypeError("given task is not a function");if(u)try{Object.defineProperty(m,"name",{value:u})}catch{}return new Promise((b,C)=>{const T={id:this.nextTaskId++,task:m,name:u,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:v=>{if(T.completed)return;T.completed=!0,this.pendingTasks.delete(T.id),s.debug(`resolving task [name:${T.name}]`),b(v);const[l]=this.pendingTasks.values();l&&!l.executedAt&&this.execute(l)},reject:v=>{if(!T.completed&&(T.completed=!0,this.pendingTasks.delete(T.id),s.debug(`rejecting task [name:${T.name}]: %s`,String(v)),C(v),!this.stopping)){const[l]=this.pendingTasks.values();l&&!l.executedAt&&this.execute(l)}}};this.pendingTasks.set(T.id,T),this.pendingTasks.size===1&&this.execute(T)})}stop(){s.debug("stop()"),this.stopping=!0;for(const m of this.pendingTasks.values())s.debug(`stop() | stopping task [name:${m.name}]`),m.reject(new e.AwaitQueueStoppedError);this.stopping=!1}remove(m){s.debug(`remove() [taskIdx:${m}]`);const u=Array.from(this.pendingTasks.values())[m];if(!u){s.debug(`stop() | no task with given idx [taskIdx:${m}]`);return}u.reject(new e.AwaitQueueRemovedTaskError)}dump(){const m=Date.now();let u=0;return Array.from(this.pendingTasks.values()).map(b=>({idx:u++,task:b.task,name:b.name,enqueuedTime:b.executedAt?b.executedAt-b.enqueuedAt:m-b.enqueuedAt,executionTime:b.executedAt?m-b.executedAt:0}))}async execute(m){if(s.debug(`execute() [name:${m.name}]`),m.executedAt)throw new Error("task already being executed");m.executedAt=Date.now();try{const u=await m.task();m.resolve(u)}catch(u){m.reject(u)}}};return ot.AwaitQueue=i,ot}var Hs;function aa(){return Hs||(Hs=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.AwaitQueueRemovedTaskError=n.AwaitQueueStoppedError=n.AwaitQueue=void 0;var e=na();Object.defineProperty(n,"AwaitQueue",{enumerable:!0,get:function(){return e.AwaitQueue}});var s=sn();Object.defineProperty(n,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return s.AwaitQueueStoppedError}}),Object.defineProperty(n,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return s.AwaitQueueRemovedTaskError}})}(Br)),Br}var dt={},Vs;function nn(){if(Vs)return dt;Vs=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.Producer=void 0;const n=Q(),e=De(),s=J(),i=new n.Logger("Producer");let w=class extends e.EnhancedEventEmitter{_id;_localId;_closed=!1;_rtpSender;_track;_kind;_rtpParameters;_paused;_maxSpatialLayer;_stopTracks;_disableTrackOnPause;_zeroRtpOnPause;_appData;_observer=new e.EnhancedEventEmitter;constructor({id:u,localId:b,rtpSender:C,track:T,rtpParameters:v,stopTracks:l,disableTrackOnPause:y,zeroRtpOnPause:S,appData:p}){super(),i.debug("constructor()"),this._id=u,this._localId=b,this._rtpSender=C,this._track=T,this._kind=T.kind,this._rtpParameters=v,this._paused=y?!T.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=l,this._disableTrackOnPause=y,this._zeroRtpOnPause=S,this._appData=p??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(u){this._appData=u}get observer(){return this._observer}close(){this._closed||(i.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(i.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new s.InvalidStateError("closed");return new Promise((u,b)=>{this.safeEmit("@getstats",u,b)})}pause(){if(i.debug("pause()"),this._closed){i.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((u,b)=>{this.safeEmit("@pause",u,b)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(i.debug("resume()"),this._closed){i.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((u,b)=>{this.safeEmit("@resume",u,b)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:u}){if(i.debug("replaceTrack() [track:%o]",u),this._closed){if(u&&this._stopTracks)try{u.stop()}catch{}throw new s.InvalidStateError("closed")}else if(u&&u.readyState==="ended")throw new s.InvalidStateError("track ended");if(u===this._track){i.debug("replaceTrack() | same track, ignored");return}await new Promise((b,C)=>{this.safeEmit("@replacetrack",u,b,C)}),this.destroyTrack(),this._track=u,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(u){if(this._closed)throw new s.InvalidStateError("closed");if(this._kind!=="video")throw new s.UnsupportedError("not a video Producer");if(typeof u!="number")throw new TypeError("invalid spatialLayer");u!==this._maxSpatialLayer&&(await new Promise((b,C)=>{this.safeEmit("@setmaxspatiallayer",u,b,C)}).catch(()=>{}),this._maxSpatialLayer=u)}async setRtpEncodingParameters(u){if(this._closed)throw new s.InvalidStateError("closed");if(typeof u!="object")throw new TypeError("invalid params");await new Promise((b,C)=>{this.safeEmit("@setrtpencodingparameters",u,b,C)})}onTrackEnded(){i.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}};return dt.Producer=w,dt}var pt={},Ks;function an(){if(Ks)return pt;Ks=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.Consumer=void 0;const n=Q(),e=De(),s=J(),i=new n.Logger("Consumer");let w=class extends e.EnhancedEventEmitter{_id;_localId;_producerId;_closed=!1;_rtpReceiver;_track;_rtpParameters;_paused;_appData;_observer=new e.EnhancedEventEmitter;constructor({id:u,localId:b,producerId:C,rtpReceiver:T,track:v,rtpParameters:l,appData:y}){super(),i.debug("constructor()"),this._id=u,this._localId=b,this._producerId=C,this._rtpReceiver=T,this._track=v,this._rtpParameters=l,this._paused=!v.enabled,this._appData=y??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(u){this._appData=u}get observer(){return this._observer}close(){this._closed||(i.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(i.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new s.InvalidStateError("closed");return new Promise((u,b)=>{this.safeEmit("@getstats",u,b)})}pause(){if(i.debug("pause()"),this._closed){i.error("pause() | Consumer closed");return}if(this._paused){i.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(i.debug("resume()"),this._closed){i.error("resume() | Consumer closed");return}if(!this._paused){i.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){i.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}};return pt.Consumer=w,pt}var lt={},Gs;function on(){if(Gs)return lt;Gs=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.DataProducer=void 0;const n=Q(),e=De(),s=J(),i=new n.Logger("DataProducer");let w=class extends e.EnhancedEventEmitter{_id;_dataChannel;_closed=!1;_sctpStreamParameters;_appData;_observer=new e.EnhancedEventEmitter;constructor({id:u,dataChannel:b,sctpStreamParameters:C,appData:T}){super(),i.debug("constructor()"),this._id=u,this._dataChannel=b,this._sctpStreamParameters=C,this._appData=T??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(u){this._dataChannel.bufferedAmountLowThreshold=u}get appData(){return this._appData}set appData(u){this._appData=u}get observer(){return this._observer}close(){this._closed||(i.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(i.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(u){if(i.debug("send()"),this._closed)throw new s.InvalidStateError("closed");this._dataChannel.send(u)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(i.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",u=>{if(this._closed)return;let{error:b}=u;b||(b=new Error("unknown DataChannel error")),b.errorDetail==="sctp-failure"?i.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",b.sctpCauseCode,b.message):i.error('DataChannel "error" event: %o',b),this.safeEmit("error",b)}),this._dataChannel.addEventListener("close",()=>{this._closed||(i.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||i.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}};return lt.DataProducer=w,lt}var ht={},Qs;function cn(){if(Qs)return ht;Qs=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.DataConsumer=void 0;const n=Q(),e=De(),s=new n.Logger("DataConsumer");let i=class extends e.EnhancedEventEmitter{_id;_dataProducerId;_dataChannel;_closed=!1;_sctpStreamParameters;_appData;_observer=new e.EnhancedEventEmitter;constructor({id:m,dataProducerId:u,dataChannel:b,sctpStreamParameters:C,appData:T}){super(),s.debug("constructor()"),this._id=m,this._dataProducerId=u,this._dataChannel=b,this._sctpStreamParameters=C,this._appData=T??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(m){this._dataChannel.binaryType=m}get appData(){return this._appData}set appData(m){this._appData=m}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(s.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",m=>{if(this._closed)return;let{error:u}=m;u||(u=new Error("unknown DataChannel error")),u.errorDetail==="sctp-failure"?s.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",u.sctpCauseCode,u.message):s.error('DataChannel "error" event: %o',u),this.safeEmit("error",u)}),this._dataChannel.addEventListener("close",()=>{this._closed||(s.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",m=>{this._closed||this.safeEmit("message",m.data)})}};return ht.DataConsumer=i,ht}var Ws;function dn(){if(Ws)return at;Ws=1,Object.defineProperty(at,"__esModule",{value:!0}),at.Transport=void 0;const n=aa(),e=Q(),s=De(),i=J(),w=Y(),m=Z(),u=nn(),b=an(),C=on(),T=cn(),v=new e.Logger("Transport");class l{consumerOptions;promise;resolve;reject;constructor(p){this.consumerOptions=p,this.promise=new Promise((o,t)=>{this.resolve=o,this.reject=t})}}class y extends s.EnhancedEventEmitter{_id;_closed=!1;_direction;_extendedRtpCapabilities;_canProduceByKind;_maxSctpMessageSize;_handler;_iceGatheringState="new";_connectionState="new";_appData;_producers=new Map;_consumers=new Map;_dataProducers=new Map;_dataConsumers=new Map;_probatorConsumerCreated=!1;_awaitQueue=new n.AwaitQueue;_pendingConsumerTasks=[];_consumerCreationInProgress=!1;_pendingPauseConsumers=new Map;_consumerPauseInProgress=!1;_pendingResumeConsumers=new Map;_consumerResumeInProgress=!1;_pendingCloseConsumers=new Map;_consumerCloseInProgress=!1;_observer=new s.EnhancedEventEmitter;constructor({direction:p,id:o,iceParameters:t,iceCandidates:r,dtlsParameters:c,sctpParameters:a,iceServers:d,iceTransportPolicy:h,additionalSettings:g,proprietaryConstraints:_,appData:R,handlerFactory:f,extendedRtpCapabilities:E,canProduceByKind:P}){super(),v.debug("constructor() [id:%s, direction:%s]",o,p),this._id=o,this._direction=p,this._extendedRtpCapabilities=E,this._canProduceByKind=P,this._maxSctpMessageSize=a?a.maxMessageSize:null;const x=w.clone(g)??{};delete x.iceServers,delete x.iceTransportPolicy,delete x.bundlePolicy,delete x.rtcpMuxPolicy,delete x.sdpSemantics,this._handler=f(),this._handler.run({direction:p,iceParameters:t,iceCandidates:r,dtlsParameters:c,sctpParameters:a,iceServers:d,iceTransportPolicy:h,additionalSettings:x,proprietaryConstraints:_,extendedRtpCapabilities:E}),this._appData=R??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(p){this._appData=p}get observer(){return this._observer}close(){if(!this._closed){v.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const p of this._producers.values())p.transportClosed();this._producers.clear();for(const p of this._consumers.values())p.transportClosed();this._consumers.clear();for(const p of this._dataProducers.values())p.transportClosed();this._dataProducers.clear();for(const p of this._dataConsumers.values())p.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new i.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:p}){if(v.debug("restartIce()"),this._closed)throw new i.InvalidStateError("closed");if(!p)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(p),"transport.restartIce()")}async updateIceServers({iceServers:p}={}){if(v.debug("updateIceServers()"),this._closed)throw new i.InvalidStateError("closed");if(!Array.isArray(p))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(p),"transport.updateIceServers()")}async produce({track:p,encodings:o,codecOptions:t,codec:r,stopTracks:c=!0,disableTrackOnPause:a=!0,zeroRtpOnPause:d=!1,onRtpSender:h,appData:g={}}={}){if(v.debug("produce() [track:%o]",p),this._closed)throw new i.InvalidStateError("closed");if(p){if(this._direction!=="send")throw new i.UnsupportedError("not a sending Transport");if(this._canProduceByKind[p.kind]){if(p.readyState==="ended")throw new i.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(g&&typeof g!="object")throw new TypeError("if given, appData must be an object")}else throw new i.UnsupportedError(`cannot produce ${p.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let _;if(o&&!Array.isArray(o))throw TypeError("encodings must be an array");o&&o.length===0?_=void 0:o&&(_=o.map(P=>{const x={active:!0};return P.active===!1&&(x.active=!1),typeof P.dtx=="boolean"&&(x.dtx=P.dtx),typeof P.scalabilityMode=="string"&&(x.scalabilityMode=P.scalabilityMode),typeof P.scaleResolutionDownBy=="number"&&(x.scaleResolutionDownBy=P.scaleResolutionDownBy),typeof P.maxBitrate=="number"&&(x.maxBitrate=P.maxBitrate),typeof P.maxFramerate=="number"&&(x.maxFramerate=P.maxFramerate),typeof P.adaptivePtime=="boolean"&&(x.adaptivePtime=P.adaptivePtime),typeof P.priority=="string"&&(x.priority=P.priority),typeof P.networkPriority=="string"&&(x.networkPriority=P.networkPriority),x}));const{localId:R,rtpParameters:f,rtpSender:E}=await this._handler.send({track:p,encodings:_,codecOptions:t,codec:r,onRtpSender:h});try{m.validateRtpParameters(f);const{id:P}=await new Promise((D,k)=>{this.safeEmit("produce",{kind:p.kind,rtpParameters:f,appData:g},D,k)}),x=new u.Producer({id:P,localId:R,rtpSender:E,track:p,rtpParameters:f,stopTracks:c,disableTrackOnPause:a,zeroRtpOnPause:d,appData:g});return this._producers.set(x.id,x),this.handleProducer(x),this._observer.safeEmit("newproducer",x),x}catch(P){throw this._handler.stopSending(R).catch(()=>{}),P}},"transport.produce()").catch(_=>{if(c)try{p.stop()}catch{}throw _})}async consume({id:p,producerId:o,kind:t,rtpParameters:r,streamId:c,onRtpReceiver:a,appData:d={}}){if(v.debug("consume()"),this._closed)throw new i.InvalidStateError("closed");if(this._direction!=="recv")throw new i.UnsupportedError("not a receiving Transport");if(typeof p!="string")throw new TypeError("missing id");if(typeof o!="string")throw new TypeError("missing producerId");if(t!=="audio"&&t!=="video")throw new TypeError(`invalid kind '${t}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(d&&typeof d!="object")throw new TypeError("if given, appData must be an object");const h=w.clone(r);if(!m.canReceive(h,this._extendedRtpCapabilities))throw new i.UnsupportedError("cannot consume this Producer");const _=new l({id:p,producerId:o,kind:t,rtpParameters:h,streamId:c,onRtpReceiver:a,appData:d});return this._pendingConsumerTasks.push(_),queueMicrotask(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),_.promise}async produceData({ordered:p=!0,maxPacketLifeTime:o,maxRetransmits:t,label:r="",protocol:c="",appData:a={}}={}){if(v.debug("produceData()"),this._closed)throw new i.InvalidStateError("closed");if(this._direction!=="send")throw new i.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(a&&typeof a!="object")throw new TypeError("if given, appData must be an object")}else throw new i.UnsupportedError("SCTP not enabled by remote Transport");return(o||t)&&(p=!1),this._awaitQueue.push(async()=>{const{dataChannel:d,sctpStreamParameters:h}=await this._handler.sendDataChannel({ordered:p,maxPacketLifeTime:o,maxRetransmits:t,label:r,protocol:c});m.validateSctpStreamParameters(h);const{id:g}=await new Promise((R,f)=>{this.safeEmit("producedata",{sctpStreamParameters:h,label:r,protocol:c,appData:a},R,f)}),_=new C.DataProducer({id:g,dataChannel:d,sctpStreamParameters:h,appData:a});return this._dataProducers.set(_.id,_),this.handleDataProducer(_),this._observer.safeEmit("newdataproducer",_),_},"transport.produceData()")}async consumeData({id:p,dataProducerId:o,sctpStreamParameters:t,label:r="",protocol:c="",appData:a={}}){if(v.debug("consumeData()"),this._closed)throw new i.InvalidStateError("closed");if(this._direction!=="recv")throw new i.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof p!="string")throw new TypeError("missing id");if(typeof o!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(a&&typeof a!="object")throw new TypeError("if given, appData must be an object")}else throw new i.UnsupportedError("SCTP not enabled by remote Transport");const d=w.clone(t);return m.validateSctpStreamParameters(d),this._awaitQueue.push(async()=>{const{dataChannel:h}=await this._handler.receiveDataChannel({sctpStreamParameters:d,label:r,protocol:c}),g=new T.DataConsumer({id:p,dataProducerId:o,dataChannel:h,sctpStreamParameters:d,appData:a});return this._dataConsumers.set(g.id,g),this.handleDataConsumer(g),this._observer.safeEmit("newdataconsumer",g),g},"transport.consumeData()")}createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0){v.debug("createPendingConsumers() | there is no Consumer to be created");return}const p=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let o;const t=[];for(const r of p){const{id:c,kind:a,rtpParameters:d,streamId:h,onRtpReceiver:g}=r.consumerOptions;t.push({trackId:c,kind:a,rtpParameters:d,streamId:h,onRtpReceiver:g})}try{const r=await this._handler.receive(t);for(let c=0;c<r.length;++c){const a=p[c],d=r[c],{id:h,producerId:g,kind:_,rtpParameters:R,appData:f}=a.consumerOptions,{localId:E,rtpReceiver:P,track:x}=d,D=new b.Consumer({id:h,localId:E,producerId:g,rtpReceiver:P,track:x,rtpParameters:R,appData:f});this._consumers.set(D.id,D),this.handleConsumer(D),!this._probatorConsumerCreated&&!o&&_==="video"&&(o=D),this._observer.safeEmit("newconsumer",D),a.resolve(D)}}catch(r){for(const c of p)c.reject(r)}if(o)try{const r=m.generateProbatorRtpParameters(o.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:r}]),v.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(r){v.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",r)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0){v.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const p=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const o=p.map(t=>t.localId);await this._handler.pauseReceiving(o)}catch(o){v.error("pausePendingConsumers() | failed to pause Consumers:",o)}},"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0){v.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const p=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const o=p.map(t=>t.localId);await this._handler.resumeReceiving(o)}catch(o){v.error("resumePendingConsumers() | failed to resume Consumers:",o)}},"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0){v.debug("closePendingConsumers() | there is no Consumer to be closed");return}const p=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(p.map(o=>o.localId))}catch(o){v.error("closePendingConsumers() | failed to close Consumers:",o)}},"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const p=this._handler;p.on("@connect",({dtlsParameters:o},t,r)=>{if(this._closed){r(new i.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:o},t,r)}),p.on("@icegatheringstatechange",o=>{o!==this._iceGatheringState&&(v.debug("ICE gathering state changed to %s",o),this._iceGatheringState=o,this._closed||this.safeEmit("icegatheringstatechange",o))}),p.on("@icecandidateerror",o=>{v.warn(`ICE candidate error [url:${o.url}, localAddress:${o.address}, localPort:${o.port}]: ${o.errorCode} "${o.errorText}"`),this.safeEmit("icecandidateerror",o)}),p.on("@connectionstatechange",o=>{o!==this._connectionState&&(v.debug("connection state changed to %s",o),this._connectionState=o,this._closed||this.safeEmit("connectionstatechange",o))})}handleProducer(p){p.on("@close",()=>{this._producers.delete(p.id),!this._closed&&this._awaitQueue.push(async()=>await this._handler.stopSending(p.localId),"producer @close event").catch(o=>v.warn("producer.close() failed:%o",o))}),p.on("@pause",(o,t)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(p.localId),"producer @pause event").then(o).catch(t)}),p.on("@resume",(o,t)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(p.localId),"producer @resume event").then(o).catch(t)}),p.on("@replacetrack",(o,t,r)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(p.localId,o),"producer @replacetrack event").then(t).catch(r)}),p.on("@setmaxspatiallayer",(o,t,r)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(p.localId,o),"producer @setmaxspatiallayer event").then(t).catch(r)}),p.on("@setrtpencodingparameters",(o,t,r)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(p.localId,o),"producer @setrtpencodingparameters event").then(t).catch(r)}),p.on("@getstats",(o,t)=>{if(this._closed)return t(new i.InvalidStateError("closed"));this._handler.getSenderStats(p.localId).then(o).catch(t)})}handleConsumer(p){p.on("@close",()=>{this._consumers.delete(p.id),this._pendingPauseConsumers.delete(p.id),this._pendingResumeConsumers.delete(p.id),!this._closed&&(this._pendingCloseConsumers.set(p.id,p),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),p.on("@pause",()=>{this._pendingResumeConsumers.has(p.id)&&this._pendingResumeConsumers.delete(p.id),this._pendingPauseConsumers.set(p.id,p),queueMicrotask(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),p.on("@resume",()=>{this._pendingPauseConsumers.has(p.id)&&this._pendingPauseConsumers.delete(p.id),this._pendingResumeConsumers.set(p.id,p),queueMicrotask(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),p.on("@getstats",(o,t)=>{if(this._closed)return t(new i.InvalidStateError("closed"));this._handler.getReceiverStats(p.localId).then(o).catch(t)})}handleDataProducer(p){p.on("@close",()=>{this._dataProducers.delete(p.id)})}handleDataConsumer(p){p.on("@close",()=>{this._dataConsumers.delete(p.id)})}}return at.Transport=y,at}var ut={},de={},qr={},Ur={exports:{}},Ys;function ss(){if(Ys)return Ur.exports;Ys=1;var n=Ur.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var s="candidate:%s %d %s %d %s %d typ %s";return s+=e.raddr!=null?" raddr %s rport %d":"%v%v",s+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(s+=" generation %d"),s+=e["network-id"]!=null?" network-id %d":"%v",s+=e["network-cost"]!=null?" network-cost %d":"%v",s}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var s="ssrc:%d";return e.attribute!=null&&(s+=" %s",e.value!=null&&(s+=":%s")),s}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var s="mediaclk:";return s+=e.id!=null?"id=%s %s":"%v%s",s+=e.mediaClockValue!=null?"=%s":"",s+=e.rateNumerator!=null?" rate=%s":"",s+=e.rateDenominator!=null?"/%s":"",s}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(n).forEach(function(e){var s=n[e];s.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),Ur.exports}var Xs;function oa(){return Xs||(Xs=1,function(n){var e=function(b){return String(Number(b))===b?Number(b):b},s=function(b,C,T,v){if(v&&!T)C[v]=e(b[1]);else for(var l=0;l<T.length;l+=1)b[l+1]!=null&&(C[T[l]]=e(b[l+1]))},i=function(b,C,T){var v=b.name&&b.names;b.push&&!C[b.push]?C[b.push]=[]:v&&!C[b.name]&&(C[b.name]={});var l=b.push?{}:v?C[b.name]:C;s(T.match(b.reg),l,b.names,b.name),b.push&&C[b.push].push(l)},w=ss(),m=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(b){var C={},T=[],v=C;return b.split(/(\r\n|\r|\n)/).filter(m).forEach(function(l){var y=l[0],S=l.slice(2);y==="m"&&(T.push({rtp:[],fmtp:[]}),v=T[T.length-1]);for(var p=0;p<(w[y]||[]).length;p+=1){var o=w[y][p];if(o.reg.test(S))return i(o,v,S)}}),C.media=T,C};var u=function(b,C){var T=C.split(/=(.+)/,2);return T.length===2?b[T[0]]=e(T[1]):T.length===1&&C.length>1&&(b[T[0]]=void 0),b};n.parseParams=function(b){return b.split(/;\s?/).reduce(u,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(b){return b.toString().split(" ").map(Number)},n.parseRemoteCandidates=function(b){for(var C=[],T=b.split(" ").map(e),v=0;v<T.length;v+=3)C.push({component:T[v],ip:T[v+1],port:T[v+2]});return C},n.parseImageAttributes=function(b){return b.split(" ").map(function(C){return C.substring(1,C.length-1).split(",").reduce(u,{})})},n.parseSimulcastStreamList=function(b){return b.split(";").map(function(C){return C.split(",").map(function(T){var v,l=!1;return T[0]!=="~"?v=e(T):(v=e(T.substring(1,T.length)),l=!0),{scid:v,paused:l}})})}}(qr)),qr}var $r,Js;function ca(){if(Js)return $r;Js=1;var n=ss(),e=/%[sdv%]/g,s=function(u){var b=1,C=arguments,T=C.length;return u.replace(e,function(v){if(b>=T)return v;var l=C[b];switch(b+=1,v){case"%%":return"%";case"%s":return String(l);case"%d":return Number(l);case"%v":return""}})},i=function(u,b,C){var T=b.format instanceof Function?b.format(b.push?C:C[b.name]):b.format,v=[u+"="+T];if(b.names)for(var l=0;l<b.names.length;l+=1){var y=b.names[l];b.name?v.push(C[b.name][y]):v.push(C[b.names[l]])}else v.push(C[b.name]);return s.apply(null,v)},w=["v","o","s","i","u","e","p","c","b","t","r","z","a"],m=["i","c","b","a"];return $r=function(u,b){b=b||{},u.version==null&&(u.version=0),u.name==null&&(u.name=" "),u.media.forEach(function(l){l.payloads==null&&(l.payloads="")});var C=b.outerOrder||w,T=b.innerOrder||m,v=[];return C.forEach(function(l){n[l].forEach(function(y){y.name in u&&u[y.name]!=null?v.push(i(l,y,u)):y.push in u&&u[y.push]!=null&&u[y.push].forEach(function(S){v.push(i(l,y,S))})})}),u.media.forEach(function(l){v.push(i("m",n.m[0],l)),T.forEach(function(y){n[y].forEach(function(S){S.name in l&&l[S.name]!=null?v.push(i(y,S,l)):S.push in l&&l[S.push]!=null&&l[S.push].forEach(function(p){v.push(i(y,S,p))})})})}),v.join(`\r
`)+`\r
`},$r}var Zs;function se(){if(Zs)return de;Zs=1;var n=oa(),e=ca(),s=ss();return de.grammar=s,de.write=e,de.parse=n.parse,de.parseParams=n.parseParams,de.parseFmtpConfig=n.parseFmtpConfig,de.parsePayloads=n.parsePayloads,de.parseRemoteCandidates=n.parseRemoteCandidates,de.parseImageAttributes=n.parseImageAttributes,de.parseSimulcastStreamList=n.parseSimulcastStreamList,de}var Ne={},ei;function le(){if(ei)return Ne;ei=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.extractRtpCapabilities=e,Ne.extractDtlsParameters=s,Ne.getCname=i,Ne.applyCodecParameters=w;const n=se();function e({sdpObject:m}){const u=new Map,b=[];let C=!1,T=!1;for(const l of m.media){const y=l.type;switch(y){case"audio":{if(C)continue;C=!0;break}case"video":{if(T)continue;T=!0;break}default:continue}for(const S of l.rtp){const p={kind:y,mimeType:`${y}/${S.codec}`,preferredPayloadType:S.payload,clockRate:S.rate,channels:S.encoding,parameters:{},rtcpFeedback:[]};u.set(p.preferredPayloadType,p)}for(const S of l.fmtp??[]){const p=n.parseParams(S.config),o=u.get(S.payload);o&&(p?.hasOwnProperty("profile-level-id")&&(p["profile-level-id"]=String(p["profile-level-id"])),o.parameters=p)}for(const S of l.rtcpFb??[]){const p={type:S.type,parameter:S.subtype};if(p.parameter||delete p.parameter,S.payload!=="*"){const o=u.get(S.payload);if(!o)continue;o.rtcpFeedback.push(p)}else for(const o of u.values())o.kind===y&&!/.+\/rtx$/i.test(o.mimeType)&&o.rtcpFeedback.push(p)}for(const S of l.ext??[]){if(S["encrypt-uri"])continue;const p={kind:y,uri:S.uri,preferredId:S.value};b.push(p)}}return{codecs:Array.from(u.values()),headerExtensions:b}}function s({sdpObject:m}){let u=m.setup,b=m.fingerprint;if(!u||!b){const v=(m.media??[]).find(l=>l.port!==0);v&&(u??=v.setup,b??=v.fingerprint)}if(u){if(!b)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let C;switch(u){case"active":{C="client";break}case"passive":{C="server";break}case"actpass":{C="auto";break}}return{role:C,fingerprints:[{algorithm:b.type,value:b.hash}]}}function i({offerMediaObject:m}){const u=(m.ssrcs??[]).find(b=>b.attribute==="cname");return u?u.value:""}function w({offerRtpParameters:m,answerMediaObject:u}){for(const b of m.codecs){const C=b.mimeType.toLowerCase();if(C!=="audio/opus"||!(u.rtp??[]).find(y=>y.payload===b.payloadType))continue;u.fmtp=u.fmtp??[];let v=u.fmtp.find(y=>y.payload===b.payloadType);v||(v={payload:b.payloadType,config:""},u.fmtp.push(v));const l=n.parseParams(v.config);switch(C){case"audio/opus":{const y=b.parameters["sprop-stereo"];y!==void 0&&(l.stereo=Number(y)?1:0);break}}v.config="";for(const y of Object.keys(l))v.config&&(v.config+=";"),v.config+=`${y}=${l[y]}`}}return Ne}var ft={},ti;function je(){if(ti)return ft;ti=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.getRtpEncodings=n,ft.addLegacySimulcast=e;function n({offerMediaObject:s}){const i=new Set;for(const u of s.ssrcs??[]){const b=u.id;i.add(b)}if(i.size===0)throw new Error("no a=ssrc lines found");const w=new Map;for(const u of s.ssrcGroups??[]){if(u.semantics!=="FID")continue;let[b,C]=u.ssrcs.split(/\s+/);b=Number(b),C=Number(C),i.has(b)&&(i.delete(b),i.delete(C),w.set(b,C))}for(const u of i)w.set(u,null);const m=[];for(const[u,b]of w){const C={ssrc:u};b&&(C.rtx={ssrc:b}),m.push(C)}return m}function e({offerMediaObject:s,numStreams:i}){if(i<=1)throw new TypeError("numStreams must be greater than 1");const w=(s.ssrcs??[]).find(S=>S.attribute==="msid");if(!w)throw new Error("a=ssrc line with msid information not found");const[m,u]=w.value.split(" "),b=Number(w.id);let C;(s.ssrcGroups??[]).some(S=>{if(S.semantics!=="FID")return!1;const p=S.ssrcs.split(/\s+/);return Number(p[0])===b?(C=Number(p[1]),!0):!1});const T=s.ssrcs.find(S=>S.attribute==="cname");if(!T)throw new Error("a=ssrc line with cname information not found");const v=T.value,l=[],y=[];for(let S=0;S<i;++S)l.push(b+S),C&&y.push(C+S);s.ssrcGroups=[],s.ssrcs=[],s.ssrcGroups.push({semantics:"SIM",ssrcs:l.join(" ")});for(const S of l)s.ssrcs.push({id:S,attribute:"cname",value:v}),s.ssrcs.push({id:S,attribute:"msid",value:`${m} ${u}`});for(let S=0;S<y.length;++S){const p=l[S],o=y[S];s.ssrcs.push({id:o,attribute:"cname",value:v}),s.ssrcs.push({id:o,attribute:"msid",value:`${m} ${u}`}),s.ssrcGroups.push({semantics:"FID",ssrcs:`${p} ${o}`})}}return ft}var Vt={},ri;function gr(){if(ri)return Vt;ri=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.addNackSupportForOpus=n;function n(e){for(const s of e.codecs??[])(s.mimeType.toLowerCase()==="audio/opus"||s.mimeType.toLowerCase()==="audio/multiopus")&&!s.rtcpFeedback?.some(i=>i.type==="nack"&&!i.parameter)&&(s.rtcpFeedback||(s.rtcpFeedback=[]),s.rtcpFeedback.push({type:"nack"}))}return Vt}var mt={},si;function ie(){if(si)return mt;si=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.HandlerInterface=void 0;const n=De();let e=class extends n.EnhancedEventEmitter{constructor(){super()}};return mt.HandlerInterface=e,mt}var gt={},ve={},ii;function da(){if(ii)return ve;ii=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.OfferMediaSection=ve.AnswerMediaSection=ve.MediaSection=void 0;const n=se(),e=Y();let s=class{_mediaObject;_planB;constructor({iceParameters:b,iceCandidates:C,dtlsParameters:T,planB:v=!1}){if(this._mediaObject={},this._planB=v,b&&this.setIceParameters(b),C){this._mediaObject.candidates=[];for(const l of C){const y={};y.component=1,y.foundation=l.foundation,y.ip=l.address??l.ip,y.port=l.port,y.priority=l.priority,y.transport=l.protocol,y.type=l.type,l.tcpType&&(y.tcptype=l.tcpType),this._mediaObject.candidates.push(y)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}T&&this.setDtlsRole(T.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(b){this._mediaObject.iceUfrag=b.usernameFragment,this._mediaObject.icePwd=b.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}};ve.MediaSection=s;class i extends s{constructor({iceParameters:b,iceCandidates:C,dtlsParameters:T,sctpParameters:v,plainRtpParameters:l,planB:y=!1,offerMediaObject:S,offerRtpParameters:p,answerRtpParameters:o,codecOptions:t}){switch(super({iceParameters:b,iceCandidates:C,dtlsParameters:T,planB:y}),this._mediaObject.mid=String(S.mid),this._mediaObject.type=S.type,this._mediaObject.protocol=S.protocol,l?(this._mediaObject.connection={ip:l.ip,version:l.ipVersion},this._mediaObject.port=l.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),S.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const r of o.codecs){const c={payload:r.payloadType,codec:m(r),rate:r.clockRate};r.channels>1&&(c.encoding=r.channels),this._mediaObject.rtp.push(c);const a=e.clone(r.parameters)??{};let d=e.clone(r.rtcpFeedback)??[];if(t){const{opusStereo:g,opusFec:_,opusDtx:R,opusMaxPlaybackRate:f,opusMaxAverageBitrate:E,opusPtime:P,opusNack:x,videoGoogleStartBitrate:D,videoGoogleMaxBitrate:k,videoGoogleMinBitrate:I}=t,L=p.codecs.find(O=>O.payloadType===r.payloadType);switch(r.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{g!==void 0&&(L.parameters["sprop-stereo"]=g?1:0,a.stereo=g?1:0),_!==void 0&&(L.parameters.useinbandfec=_?1:0,a.useinbandfec=_?1:0),R!==void 0&&(L.parameters.usedtx=R?1:0,a.usedtx=R?1:0),f!==void 0&&(a.maxplaybackrate=f),E!==void 0&&(a.maxaveragebitrate=E),P!==void 0&&(L.parameters.ptime=P,a.ptime=P),x||(L.rtcpFeedback=L.rtcpFeedback.filter(O=>O.type!=="nack"||O.parameter),d=d.filter(O=>O.type!=="nack"||O.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":{D!==void 0&&(a["x-google-start-bitrate"]=D),k!==void 0&&(a["x-google-max-bitrate"]=k),I!==void 0&&(a["x-google-min-bitrate"]=I);break}}}const h={payload:r.payloadType,config:""};for(const g of Object.keys(a))h.config&&(h.config+=";"),h.config+=`${g}=${a[g]}`;h.config&&this._mediaObject.fmtp.push(h);for(const g of d)this._mediaObject.rtcpFb.push({payload:r.payloadType,type:g.type,subtype:g.parameter})}this._mediaObject.payloads=o.codecs.map(r=>r.payloadType).join(" "),this._mediaObject.ext=[];for(const r of o.headerExtensions)(S.ext??[]).some(a=>a.uri===r.uri)&&this._mediaObject.ext.push({uri:r.uri,value:r.id});if(S.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),S.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:S.simulcast.list1},this._mediaObject.rids=[];for(const r of S.rids??[])r.direction==="send"&&this._mediaObject.rids.push({id:r.id,direction:"recv"})}else if(S.simulcast_03){this._mediaObject.simulcast_03={value:S.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const r of S.rids??[])r.direction==="send"&&this._mediaObject.rids.push({id:r.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&this._mediaObject.type==="video"&&(this._mediaObject.xGoogleFlag="conference");break}case"application":{typeof S.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=v.port,this._mediaObject.maxMessageSize=v.maxMessageSize):S.sctpmap&&(this._mediaObject.payloads=v.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:v.port,maxMessageSize:v.maxMessageSize});break}}}setDtlsRole(b){switch(b){case"client":{this._mediaObject.setup="active";break}case"server":{this._mediaObject.setup="passive";break}case"auto":{this._mediaObject.setup="actpass";break}}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(b){if(!this._mediaObject.simulcast?.list1)return;const C={};for(const l of b)l.rid&&(C[l.rid]=l);const T=this._mediaObject.simulcast.list1,v=n.parseSimulcastStreamList(T);for(const l of v)for(const y of l)y.paused=!C[y.scid]?.active;this._mediaObject.simulcast.list1=v.map(l=>l.map(y=>`${y.paused?"~":""}${y.scid}`).join(",")).join(";")}}ve.AnswerMediaSection=i;class w extends s{constructor({iceParameters:b,iceCandidates:C,dtlsParameters:T,sctpParameters:v,plainRtpParameters:l,planB:y=!1,mid:S,kind:p,offerRtpParameters:o,streamId:t,trackId:r,oldDataChannelSpec:c=!1}){switch(super({iceParameters:b,iceCandidates:C,dtlsParameters:T,planB:y}),this._mediaObject.mid=String(S),this._mediaObject.type=p,l?(this._mediaObject.connection={ip:l.ip,version:l.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=l.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},v?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),this._mediaObject.extmapAllowMixed="extmap-allow-mixed",p){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${t??"-"} ${r}`);for(const g of o.codecs){const _={payload:g.payloadType,codec:m(g),rate:g.clockRate};g.channels>1&&(_.encoding=g.channels),this._mediaObject.rtp.push(_);const R={payload:g.payloadType,config:""};for(const f of Object.keys(g.parameters))R.config&&(R.config+=";"),R.config+=`${f}=${g.parameters[f]}`;R.config&&this._mediaObject.fmtp.push(R);for(const f of g.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:g.payloadType,type:f.type,subtype:f.parameter})}this._mediaObject.payloads=o.codecs.map(g=>g.payloadType).join(" "),this._mediaObject.ext=[];for(const g of o.headerExtensions)this._mediaObject.ext.push({uri:g.uri,value:g.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const a=o.encodings[0],d=a.ssrc,h=a.rtx?.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],o.rtcp.cname&&this._mediaObject.ssrcs.push({id:d,attribute:"cname",value:o.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:d,attribute:"msid",value:`${t??"-"} ${r}`}),h&&(o.rtcp.cname&&this._mediaObject.ssrcs.push({id:h,attribute:"cname",value:o.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:h,attribute:"msid",value:`${t??"-"} ${r}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${d} ${h}`}));break}case"application":{c?(this._mediaObject.payloads=v.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:v.port,maxMessageSize:v.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=v.port,this._mediaObject.maxMessageSize=v.maxMessageSize);break}}}setDtlsRole(b){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:b,streamId:C,trackId:T}){const v=b.encodings[0],l=v.ssrc,y=v.rtx?.ssrc,S=this._mediaObject.payloads.split(" ");for(const p of b.codecs){if(S.includes(String(p.payloadType)))continue;const o={payload:p.payloadType,codec:m(p),rate:p.clockRate};p.channels>1&&(o.encoding=p.channels),this._mediaObject.rtp.push(o);const t={payload:p.payloadType,config:""};for(const r of Object.keys(p.parameters))t.config&&(t.config+=";"),t.config+=`${r}=${p.parameters[r]}`;t.config&&this._mediaObject.fmtp.push(t);for(const r of p.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:p.payloadType,type:r.type,subtype:r.parameter})}this._mediaObject.payloads+=` ${b.codecs.filter(p=>!this._mediaObject.payloads.includes(p.payloadType)).map(p=>p.payloadType).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),b.rtcp.cname&&this._mediaObject.ssrcs.push({id:l,attribute:"cname",value:b.rtcp.cname}),this._mediaObject.ssrcs.push({id:l,attribute:"msid",value:`${C??"-"} ${T}`}),y&&(b.rtcp.cname&&this._mediaObject.ssrcs.push({id:y,attribute:"cname",value:b.rtcp.cname}),this._mediaObject.ssrcs.push({id:y,attribute:"msid",value:`${C??"-"} ${T}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${l} ${y}`}))}planBStopReceiving({offerRtpParameters:b}){const C=b.encodings[0],T=C.ssrc,v=C.rtx?.ssrc;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(l=>l.id!==T&&l.id!==v),v&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(l=>l.ssrcs!==`${T} ${v}`))}}ve.OfferMediaSection=w;function m(u){const C=new RegExp("^(audio|video)/(.+)","i").exec(u.mimeType);if(!C)throw new TypeError("invalid codec.mimeType");return C[2]}return ve}var ni;function he(){if(ni)return gt;ni=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.RemoteSdp=void 0;const n=se(),e=Q(),s=da(),i=new e.Logger("RemoteSdp");let w=class{_iceParameters;_iceCandidates;_dtlsParameters;_sctpParameters;_plainRtpParameters;_planB;_mediaSections=[];_midToIndex=new Map;_firstMid;_sdpObject;constructor({iceParameters:u,iceCandidates:b,dtlsParameters:C,sctpParameters:T,plainRtpParameters:v,planB:l=!1}){if(this._iceParameters=u,this._iceCandidates=b,this._dtlsParameters=C,this._sctpParameters=T,this._plainRtpParameters=v,this._planB=l,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},u?.iceLite&&(this._sdpObject.icelite="ice-lite"),C){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const y=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:C.fingerprints[y-1].algorithm,hash:C.fingerprints[y-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}v&&(this._sdpObject.origin.address=v.ip,this._sdpObject.origin.ipVer=v.ipVersion)}updateIceParameters(u){i.debug("updateIceParameters() [iceParameters:%o]",u),this._iceParameters=u,this._sdpObject.icelite=u.iceLite?"ice-lite":void 0;for(const b of this._mediaSections)b.setIceParameters(u)}updateDtlsRole(u){i.debug("updateDtlsRole() [role:%s]",u),this._dtlsParameters.role=u;for(const b of this._mediaSections)b.setDtlsRole(u)}setSessionExtmapAllowMixed(){i.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let u=0;u<this._mediaSections.length;++u){const b=this._mediaSections[u];if(b.closed)return{idx:u,reuseMid:b.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:u,reuseMid:b,offerRtpParameters:C,answerRtpParameters:T,codecOptions:v}){const l=new s.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:u,offerRtpParameters:C,answerRtpParameters:T,codecOptions:v});b?this._replaceMediaSection(l,b):this._midToIndex.has(l.mid)?this._replaceMediaSection(l):this._addMediaSection(l)}receive({mid:u,kind:b,offerRtpParameters:C,streamId:T,trackId:v}){const l=this._midToIndex.get(u);let y;if(l!==void 0&&(y=this._mediaSections[l]),this.setSessionExtmapAllowMixed(),y)y.planBReceive({offerRtpParameters:C,streamId:T,trackId:v}),this._replaceMediaSection(y);else{y=new s.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:u,kind:b,offerRtpParameters:C,streamId:T,trackId:v});const S=this._mediaSections.find(p=>p.closed);S?this._replaceMediaSection(y,S.mid):this._addMediaSection(y)}}pauseMediaSection(u){this._findMediaSection(u).pause()}resumeSendingMediaSection(u){this._findMediaSection(u).resume()}resumeReceivingMediaSection(u){this._findMediaSection(u).resume()}disableMediaSection(u){this._findMediaSection(u).disable()}closeMediaSection(u){const b=this._findMediaSection(u);return u===this._firstMid?(i.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",u),this.disableMediaSection(u),!1):(b.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(u,b){const C=this._findMediaSection(u);C.muxSimulcastStreams(b),this._replaceMediaSection(C)}planBStopReceiving({mid:u,offerRtpParameters:b}){const C=this._findMediaSection(u);C.planBStopReceiving({offerRtpParameters:b}),this._replaceMediaSection(C)}sendSctpAssociation({offerMediaObject:u}){const b=new s.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:u});this._addMediaSection(b)}receiveSctpAssociation({oldDataChannelSpec:u=!1}={}){const b=new s.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:u});this._addMediaSection(b)}getSdp(){return this._sdpObject.origin.sessionVersion++,n.write(this._sdpObject)}_addMediaSection(u){this._firstMid||(this._firstMid=u.mid),this._mediaSections.push(u),this._midToIndex.set(u.mid,this._mediaSections.length-1),this._sdpObject.media.push(u.getObject()),this._regenerateBundleMids()}_replaceMediaSection(u,b){if(typeof b=="string"){const C=this._midToIndex.get(b);if(C===void 0)throw new Error(`no media section found for reuseMid '${b}'`);const T=this._mediaSections[C];this._mediaSections[C]=u,this._midToIndex.delete(T.mid),this._midToIndex.set(u.mid,C),this._sdpObject.media[C]=u.getObject(),this._regenerateBundleMids()}else{const C=this._midToIndex.get(u.mid);if(C===void 0)throw new Error(`no media section found with mid '${u.mid}'`);this._mediaSections[C]=u,this._sdpObject.media[C]=u.getObject()}}_findMediaSection(u){const b=this._midToIndex.get(u);if(b===void 0)throw new Error(`no media section found with mid '${u}'`);return this._mediaSections[b]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(u=>!u.closed).map(u=>u.mid).join(" "))}};return gt.RemoteSdp=w,gt}var Kt={},ai;function Ee(){if(ai)return Kt;ai=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.parse=e;const n=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function e(s){const i=n.exec(s??"");return i?{spatialLayers:Number(i[1]),temporalLayers:Number(i[2])}:{spatialLayers:1,temporalLayers:1}}return Kt}var oi;function pa(){if(oi)return ut;oi=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.Chrome111=void 0;const n=se(),e=Q(),s=Y(),i=Z(),w=le(),m=je(),u=gr(),b=J(),C=ie(),T=he(),v=Ee(),l=new e.Logger("Chrome111"),y="Chrome111",S={OS:1024,MIS:1024};let p=class pn extends C.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new pn}constructor(){super()}get name(){return y}close(){if(l.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");const r=await t.createOffer();try{t.close()}catch{}const c=n.parse(r.sdp),a=w.extractRtpCapabilities({sdpObject:c});return u.addNackSupportForOpus(a),a}catch(r){try{t.close()}catch{}throw r}}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:S}}run({direction:t,iceParameters:r,iceCandidates:c,dtlsParameters:a,sctpParameters:d,iceServers:h,iceTransportPolicy:g,additionalSettings:_,proprietaryConstraints:R,extendedRtpCapabilities:f}){this.assertNotClosed(),l.debug("run()"),this._direction=t,this._remoteSdp=new T.RemoteSdp({iceParameters:r,iceCandidates:c,dtlsParameters:a,sctpParameters:d}),this._sendingRtpParametersByKind={audio:i.getSendingRtpParameters("audio",f),video:i.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:i.getSendingRemoteRtpParameters("audio",f),video:i.getSendingRemoteRtpParameters("video",f)},a.role&&a.role!=="auto"&&(this._forcedLocalDtlsRole=a.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:h??[],iceTransportPolicy:g??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",..._},R),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",E=>{this.emit("@icecandidateerror",E)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(l.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}))}async updateIceServers(t){this.assertNotClosed(),l.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=t,this._pc.setConfiguration(r)}async restartIce(t){if(this.assertNotClosed(),l.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const c={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:t,encodings:r,codecOptions:c,codec:a,onRtpSender:d}){if(this.assertNotClosed(),this.assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),r&&r.length>1){let k=1;for(const I of r){const L=I.scalabilityMode?(0,v.parse)(I.scalabilityMode).temporalLayers:3;L>k&&(k=L)}r.forEach((I,L)=>{I.rid=`r${L}`,I.scalabilityMode=`L1T${k}`})}const h=s.clone(this._sendingRtpParametersByKind[t.kind]);h.codecs=i.reduceCodecs(h.codecs,a);const g=s.clone(this._sendingRemoteRtpParametersByKind[t.kind]);g.codecs=i.reduceCodecs(g.codecs,a);const _=this._remoteSdp.getNextMediaSectionIdx(),R=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r});d&&d(R.sender);const f=await this._pc.createOffer();let E=n.parse(f.sdp);E.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:E}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const P=R.mid;h.mid=P,E=n.parse(this._pc.localDescription.sdp);const x=E.media[_.idx];if(h.rtcp.cname=w.getCname({offerMediaObject:x}),!r)h.encodings=m.getRtpEncodings({offerMediaObject:x});else if(r.length===1){const k=m.getRtpEncodings({offerMediaObject:x});Object.assign(k[0],r[0]),h.encodings=k}else h.encodings=r;this._remoteSdp.send({offerMediaObject:x,reuseMid:_.reuseMid,offerRtpParameters:h,answerRtpParameters:g,codecOptions:c});const D={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",D),await this._pc.setRemoteDescription(D),this._mapMidTransceiver.set(P,R),{localId:P,rtpParameters:h,rtpSender:R.sender}}async stopSending(t){if(this.assertSendDirection(),l.debug("stopSending() [localId:%s]",t),this._closed)return;const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const a=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d),this._mapMidTransceiver.delete(t)}async pauseSending(t){this.assertNotClosed(),this.assertSendDirection(),l.debug("pauseSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(t);const c=await this._pc.createOffer();l.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async resumeSending(t){this.assertNotClosed(),this.assertSendDirection(),l.debug("resumeSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(this._remoteSdp.resumeSendingMediaSection(t),!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly";const c=await this._pc.createOffer();l.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(t,r){this.assertNotClosed(),this.assertSendDirection(),r?l.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):l.debug("replaceTrack() [localId:%s, no track]",t);const c=this._mapMidTransceiver.get(t);if(!c)throw new Error("associated RTCRtpTransceiver not found");await c.sender.replaceTrack(r)}async setMaxSpatialLayer(t,r){this.assertNotClosed(),this.assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r);const c=this._mapMidTransceiver.get(t);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((g,_)=>{_<=r?g.active=!0:g.active=!1}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const d=await this._pc.createOffer();l.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const h={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async setRtpEncodingParameters(t,r){this.assertNotClosed(),this.assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r);const c=this._mapMidTransceiver.get(t);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((g,_)=>{a.encodings[_]={...g,...r}}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const d=await this._pc.createOffer();l.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const h={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async getSenderStats(t){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:c,label:a,protocol:d}){this.assertNotClosed(),this.assertSendDirection();const h={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmits:c,protocol:d};l.debug("sendDataChannel() [options:%o]",h);const g=this._pc.createDataChannel(a,h);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%S.MIS,!this._hasDataChannelMediaSection){const R=await this._pc.createOffer(),f=n.parse(R.sdp),E=f.media.find(x=>x.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f}),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",R),await this._pc.setLocalDescription(R),this._remoteSdp.sendSctpAssociation({offerMediaObject:E});const P={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P),this._hasDataChannelMediaSection=!0}const _={streamId:h.id,ordered:h.ordered,maxPacketLifeTime:h.maxPacketLifeTime,maxRetransmits:h.maxRetransmits};return{dataChannel:g,sctpStreamParameters:_}}async receive(t){this.assertNotClosed(),this.assertRecvDirection();const r=[],c=new Map;for(const g of t){const{trackId:_,kind:R,rtpParameters:f,streamId:E}=g;l.debug("receive() [trackId:%s, kind:%s]",_,R);const P=f.mid??String(this._mapMidTransceiver.size);c.set(_,P),this._remoteSdp.receive({mid:P,kind:R,offerRtpParameters:f,streamId:E??f.rtcp.cname,trackId:_})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);for(const g of t){const{trackId:_,onRtpReceiver:R}=g;if(R){const f=c.get(_),E=this._pc.getTransceivers().find(P=>P.mid===f);if(!E)throw new Error("transceiver not found");R(E.receiver)}}let d=await this._pc.createAnswer();const h=n.parse(d.sdp);for(const g of t){const{trackId:_,rtpParameters:R}=g,f=c.get(_),E=h.media.find(P=>String(P.mid)===f);w.applyCodecParameters({offerRtpParameters:R,answerMediaObject:E})}d={type:"answer",sdp:n.write(h)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const g of t){const{trackId:_}=g,R=c.get(_),f=this._pc.getTransceivers().find(E=>E.mid===R);if(f)this._mapMidTransceiver.set(R,f),r.push({localId:R,track:f.receiver.track,rtpReceiver:f.receiver});else throw new Error("new RTCRtpTransceiver not found")}return r}async stopReceiving(t){if(this.assertRecvDirection(),this._closed)return;for(const a of t){l.debug("stopReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(d.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const a of t)this._mapMidTransceiver.delete(a)}async pauseReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){l.debug("pauseReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="inactive",this._remoteSdp.pauseMediaSection(a)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async resumeReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){l.debug("resumeReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(a)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async getReceiverStats(t){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:c}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:a,ordered:d,maxPacketLifeTime:h,maxRetransmits:g}=t,_={negotiated:!0,id:a,ordered:d,maxPacketLifeTime:h,maxRetransmits:g,protocol:c};l.debug("receiveDataChannel() [options:%o]",_);const R=this._pc.createDataChannel(r,_);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const f={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),await this._pc.setRemoteDescription(f);const E=await this._pc.createAnswer();if(!this._transportReady){const P=n.parse(E.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",E),await this._pc.setLocalDescription(E),this._hasDataChannelMediaSection=!0}return{dataChannel:R}}async setupTransport({localDtlsRole:t,localSdpObject:r}){r||(r=n.parse(this._pc.localDescription.sdp));const c=w.extractDtlsParameters({sdpObject:r});c.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((a,d)=>{this.safeEmit("@connect",{dtlsParameters:c},a,d)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new b.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return ut.Chrome111=p,ut}var _t={},ci;function la(){if(ci)return _t;ci=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.Chrome74=void 0;const n=se(),e=Q(),s=Y(),i=Z(),w=le(),m=je(),u=gr(),b=J(),C=ie(),T=he(),v=Ee(),l=new e.Logger("Chrome74"),y="Chrome74",S={OS:1024,MIS:1024};let p=class ln extends C.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new ln}constructor(){super()}get name(){return y}close(){if(l.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");const r=await t.createOffer();try{t.close()}catch{}const c=n.parse(r.sdp),a=w.extractRtpCapabilities({sdpObject:c});return u.addNackSupportForOpus(a),a}catch(r){try{t.close()}catch{}throw r}}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:S}}run({direction:t,iceParameters:r,iceCandidates:c,dtlsParameters:a,sctpParameters:d,iceServers:h,iceTransportPolicy:g,additionalSettings:_,proprietaryConstraints:R,extendedRtpCapabilities:f}){l.debug("run()"),this._direction=t,this._remoteSdp=new T.RemoteSdp({iceParameters:r,iceCandidates:c,dtlsParameters:a,sctpParameters:d}),this._sendingRtpParametersByKind={audio:i.getSendingRtpParameters("audio",f),video:i.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:i.getSendingRemoteRtpParameters("audio",f),video:i.getSendingRemoteRtpParameters("video",f)},a.role&&a.role!=="auto"&&(this._forcedLocalDtlsRole=a.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:h??[],iceTransportPolicy:g??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",..._},R),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",E=>{this.emit("@icecandidateerror",E)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(l.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}))}async updateIceServers(t){this.assertNotClosed(),l.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=t,this._pc.setConfiguration(r)}async restartIce(t){if(this.assertNotClosed(),l.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const c={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:t,encodings:r,codecOptions:c,codec:a}){this.assertNotClosed(),this.assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),r&&r.length>1&&r.forEach((I,L)=>{I.rid=`r${L}`});const d=s.clone(this._sendingRtpParametersByKind[t.kind]);d.codecs=i.reduceCodecs(d.codecs,a);const h=s.clone(this._sendingRemoteRtpParametersByKind[t.kind]);h.codecs=i.reduceCodecs(h.codecs,a);const g=this._remoteSdp.getNextMediaSectionIdx(),_=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r});let R=await this._pc.createOffer(),f=n.parse(R.sdp);f.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let E;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f});let P=!1;const x=(0,v.parse)((r??[{}])[0].scalabilityMode);r&&r.length===1&&x.spatialLayers>1&&d.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(l.debug("send() | enabling legacy simulcast for VP9 SVC"),P=!0,f=n.parse(R.sdp),E=f.media[g.idx],m.addLegacySimulcast({offerMediaObject:E,numStreams:x.spatialLayers}),R={type:"offer",sdp:n.write(f)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",R),await this._pc.setLocalDescription(R);const D=_.mid;if(d.mid=D,f=n.parse(this._pc.localDescription.sdp),E=f.media[g.idx],d.rtcp.cname=w.getCname({offerMediaObject:E}),!r)d.encodings=m.getRtpEncodings({offerMediaObject:E});else if(r.length===1){let I=m.getRtpEncodings({offerMediaObject:E});Object.assign(I[0],r[0]),P&&(I=[I[0]]),d.encodings=I}else d.encodings=r;if(d.encodings.length>1&&(d.codecs[0].mimeType.toLowerCase()==="video/vp8"||d.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const I of d.encodings)I.scalabilityMode?I.scalabilityMode=`L1T${x.temporalLayers}`:I.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:E,reuseMid:g.reuseMid,offerRtpParameters:d,answerRtpParameters:h,codecOptions:c});const k={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setRemoteDescription(k),this._mapMidTransceiver.set(D,_),{localId:D,rtpParameters:d,rtpSender:_.sender}}async stopSending(t){if(this.assertSendDirection(),l.debug("stopSending() [localId:%s]",t),this._closed)return;const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const a=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d),this._mapMidTransceiver.delete(t)}async pauseSending(t){this.assertNotClosed(),this.assertSendDirection(),l.debug("pauseSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(t);const c=await this._pc.createOffer();l.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async resumeSending(t){this.assertNotClosed(),this.assertSendDirection(),l.debug("resumeSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(this._remoteSdp.resumeSendingMediaSection(t),!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly";const c=await this._pc.createOffer();l.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(t,r){this.assertNotClosed(),this.assertSendDirection(),r?l.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):l.debug("replaceTrack() [localId:%s, no track]",t);const c=this._mapMidTransceiver.get(t);if(!c)throw new Error("associated RTCRtpTransceiver not found");await c.sender.replaceTrack(r)}async setMaxSpatialLayer(t,r){this.assertNotClosed(),this.assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r);const c=this._mapMidTransceiver.get(t);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((g,_)=>{_<=r?g.active=!0:g.active=!1}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const d=await this._pc.createOffer();l.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const h={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async setRtpEncodingParameters(t,r){this.assertNotClosed(),this.assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r);const c=this._mapMidTransceiver.get(t);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((g,_)=>{a.encodings[_]={...g,...r}}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const d=await this._pc.createOffer();l.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const h={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async getSenderStats(t){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:c,label:a,protocol:d}){this.assertNotClosed(),this.assertSendDirection();const h={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmits:c,protocol:d};l.debug("sendDataChannel() [options:%o]",h);const g=this._pc.createDataChannel(a,h);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%S.MIS,!this._hasDataChannelMediaSection){const R=await this._pc.createOffer(),f=n.parse(R.sdp),E=f.media.find(x=>x.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f}),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",R),await this._pc.setLocalDescription(R),this._remoteSdp.sendSctpAssociation({offerMediaObject:E});const P={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P),this._hasDataChannelMediaSection=!0}const _={streamId:h.id,ordered:h.ordered,maxPacketLifeTime:h.maxPacketLifeTime,maxRetransmits:h.maxRetransmits};return{dataChannel:g,sctpStreamParameters:_}}async receive(t){this.assertNotClosed(),this.assertRecvDirection();const r=[],c=new Map;for(const g of t){const{trackId:_,kind:R,rtpParameters:f,streamId:E}=g;l.debug("receive() [trackId:%s, kind:%s]",_,R);const P=f.mid??String(this._mapMidTransceiver.size);c.set(_,P),this._remoteSdp.receive({mid:P,kind:R,offerRtpParameters:f,streamId:E??f.rtcp.cname,trackId:_})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);let d=await this._pc.createAnswer();const h=n.parse(d.sdp);for(const g of t){const{trackId:_,rtpParameters:R}=g,f=c.get(_),E=h.media.find(P=>String(P.mid)===f);w.applyCodecParameters({offerRtpParameters:R,answerMediaObject:E})}d={type:"answer",sdp:n.write(h)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const g of t){const{trackId:_}=g,R=c.get(_),f=this._pc.getTransceivers().find(E=>E.mid===R);if(f)this._mapMidTransceiver.set(R,f),r.push({localId:R,track:f.receiver.track,rtpReceiver:f.receiver});else throw new Error("new RTCRtpTransceiver not found")}return r}async stopReceiving(t){if(this.assertRecvDirection(),this._closed)return;for(const a of t){l.debug("stopReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(d.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const a of t)this._mapMidTransceiver.delete(a)}async pauseReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){l.debug("pauseReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="inactive",this._remoteSdp.pauseMediaSection(a)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async resumeReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){l.debug("resumeReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(a)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async getReceiverStats(t){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:c}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:a,ordered:d,maxPacketLifeTime:h,maxRetransmits:g}=t,_={negotiated:!0,id:a,ordered:d,maxPacketLifeTime:h,maxRetransmits:g,protocol:c};l.debug("receiveDataChannel() [options:%o]",_);const R=this._pc.createDataChannel(r,_);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const f={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),await this._pc.setRemoteDescription(f);const E=await this._pc.createAnswer();if(!this._transportReady){const P=n.parse(E.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",E),await this._pc.setLocalDescription(E),this._hasDataChannelMediaSection=!0}return{dataChannel:R}}async setupTransport({localDtlsRole:t,localSdpObject:r}){r||(r=n.parse(this._pc.localDescription.sdp));const c=w.extractDtlsParameters({sdpObject:r});c.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((a,d)=>{this.safeEmit("@connect",{dtlsParameters:c},a,d)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new b.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return _t.Chrome74=p,_t}var wt={},di;function ha(){if(di)return wt;di=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.Chrome70=void 0;const n=se(),e=Q(),s=Y(),i=Z(),w=le(),m=je(),u=ie(),b=he(),C=Ee(),T=new e.Logger("Chrome70"),v="Chrome70",l={OS:1024,MIS:1024};let y=class hn extends u.HandlerInterface{_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new hn}constructor(){super()}get name(){return v}close(){if(T.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){T.debug("getNativeRtpCapabilities()");const p=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{p.addTransceiver("audio"),p.addTransceiver("video");const o=await p.createOffer();try{p.close()}catch{}const t=n.parse(o.sdp);return w.extractRtpCapabilities({sdpObject:t})}catch(o){try{p.close()}catch{}throw o}}async getNativeSctpCapabilities(){return T.debug("getNativeSctpCapabilities()"),{numStreams:l}}run({direction:p,iceParameters:o,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:a,iceTransportPolicy:d,additionalSettings:h,proprietaryConstraints:g,extendedRtpCapabilities:_}){T.debug("run()"),this._direction=p,this._remoteSdp=new b.RemoteSdp({iceParameters:o,iceCandidates:t,dtlsParameters:r,sctpParameters:c}),this._sendingRtpParametersByKind={audio:i.getSendingRtpParameters("audio",_),video:i.getSendingRtpParameters("video",_)},this._sendingRemoteRtpParametersByKind={audio:i.getSendingRemoteRtpParameters("audio",_),video:i.getSendingRemoteRtpParameters("video",_)},r.role&&r.role!=="auto"&&(this._forcedLocalDtlsRole=r.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...h},g),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",R=>{this.emit("@icecandidateerror",R)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(T.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(p){T.debug("updateIceServers()");const o=this._pc.getConfiguration();o.iceServers=p,this._pc.setConfiguration(o)}async restartIce(p){if(T.debug("restartIce()"),this._remoteSdp.updateIceParameters(p),!!this._transportReady)if(this._direction==="send"){const o=await this._pc.createOffer({iceRestart:!0});T.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const t={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const o={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);const t=await this._pc.createAnswer();T.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:p,encodings:o,codecOptions:t,codec:r}){this.assertSendDirection(),T.debug("send() [kind:%s, track.id:%s]",p.kind,p.id);const c=s.clone(this._sendingRtpParametersByKind[p.kind]);c.codecs=i.reduceCodecs(c.codecs,r);const a=s.clone(this._sendingRemoteRtpParametersByKind[p.kind]);a.codecs=i.reduceCodecs(a.codecs,r);const d=this._remoteSdp.getNextMediaSectionIdx(),h=this._pc.addTransceiver(p,{direction:"sendonly",streams:[this._sendStream]});let g=await this._pc.createOffer(),_=n.parse(g.sdp);_.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let R;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:_}),o&&o.length>1&&(T.debug("send() | enabling legacy simulcast"),_=n.parse(g.sdp),R=_.media[d.idx],m.addLegacySimulcast({offerMediaObject:R,numStreams:o.length}),g={type:"offer",sdp:n.write(_)});let f=!1;const E=(0,C.parse)((o??[{}])[0].scalabilityMode);if(o&&o.length===1&&E.spatialLayers>1&&c.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(T.debug("send() | enabling legacy simulcast for VP9 SVC"),f=!0,_=n.parse(g.sdp),R=_.media[d.idx],m.addLegacySimulcast({offerMediaObject:R,numStreams:E.spatialLayers}),g={type:"offer",sdp:n.write(_)}),T.debug("send() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g),o){T.debug("send() | applying given encodings");const D=h.sender.getParameters();for(let k=0;k<(D.encodings??[]).length;++k){const I=D.encodings[k],L=o[k];if(!L)break;D.encodings[k]=Object.assign(I,L)}await h.sender.setParameters(D)}const P=h.mid;if(c.mid=P,_=n.parse(this._pc.localDescription.sdp),R=_.media[d.idx],c.rtcp.cname=w.getCname({offerMediaObject:R}),c.encodings=m.getRtpEncodings({offerMediaObject:R}),o)for(let D=0;D<c.encodings.length;++D)o[D]&&Object.assign(c.encodings[D],o[D]);if(f&&(c.encodings=[c.encodings[0]]),c.encodings.length>1&&(c.codecs[0].mimeType.toLowerCase()==="video/vp8"||c.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const D of c.encodings)D.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:R,reuseMid:d.reuseMid,offerRtpParameters:c,answerRtpParameters:a,codecOptions:t});const x={type:"answer",sdp:this._remoteSdp.getSdp()};return T.debug("send() | calling pc.setRemoteDescription() [answer:%o]",x),await this._pc.setRemoteDescription(x),this._mapMidTransceiver.set(P,h),{localId:P,rtpParameters:c,rtpSender:h.sender}}async stopSending(p){this.assertSendDirection(),T.debug("stopSending() [localId:%s]",p);const o=this._mapMidTransceiver.get(p);if(!o)throw new Error("associated RTCRtpTransceiver not found");if(o.sender.replaceTrack(null),this._pc.removeTrack(o.sender),this._remoteSdp.closeMediaSection(o.mid))try{o.stop()}catch{}const r=await this._pc.createOffer();T.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const c={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c),this._mapMidTransceiver.delete(p)}async pauseSending(p){}async resumeSending(p){}async replaceTrack(p,o){this.assertSendDirection(),o?T.debug("replaceTrack() [localId:%s, track.id:%s]",p,o.id):T.debug("replaceTrack() [localId:%s, no track]",p);const t=this._mapMidTransceiver.get(p);if(!t)throw new Error("associated RTCRtpTransceiver not found");await t.sender.replaceTrack(o)}async setMaxSpatialLayer(p,o){this.assertSendDirection(),T.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",p,o);const t=this._mapMidTransceiver.get(p);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((d,h)=>{h<=o?d.active=!0:d.active=!1}),await t.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(p,r.encodings);const c=await this._pc.createOffer();T.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(p,o){this.assertSendDirection(),T.debug("setRtpEncodingParameters() [localId:%s, params:%o]",p,o);const t=this._mapMidTransceiver.get(p);if(!t)throw new Error("associated RTCRtpTransceiver not found");const r=t.sender.getParameters();r.encodings.forEach((d,h)=>{r.encodings[h]={...d,...o}}),await t.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(p,r.encodings);const c=await this._pc.createOffer();T.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(p){this.assertSendDirection();const o=this._mapMidTransceiver.get(p);if(!o)throw new Error("associated RTCRtpTransceiver not found");return o.sender.getStats()}async sendDataChannel({ordered:p,maxPacketLifeTime:o,maxRetransmits:t,label:r,protocol:c}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:p,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:t,protocol:c};T.debug("sendDataChannel() [options:%o]",a);const d=this._pc.createDataChannel(r,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%l.MIS,!this._hasDataChannelMediaSection){const g=await this._pc.createOffer(),_=n.parse(g.sdp),R=_.media.find(E=>E.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:_}),T.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g),this._remoteSdp.sendSctpAssociation({offerMediaObject:R});const f={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._hasDataChannelMediaSection=!0}const h={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:d,sctpStreamParameters:h}}async receive(p){this.assertRecvDirection();const o=[],t=new Map;for(const d of p){const{trackId:h,kind:g,rtpParameters:_,streamId:R}=d;T.debug("receive() [trackId:%s, kind:%s]",h,g);const f=_.mid??String(this._mapMidTransceiver.size);t.set(h,f),this._remoteSdp.receive({mid:f,kind:g,offerRtpParameters:_,streamId:R??_.rtcp.cname,trackId:h})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let c=await this._pc.createAnswer();const a=n.parse(c.sdp);for(const d of p){const{trackId:h,rtpParameters:g}=d,_=t.get(h),R=a.media.find(f=>String(f.mid)===_);w.applyCodecParameters({offerRtpParameters:g,answerMediaObject:R})}c={type:"answer",sdp:n.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),T.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const d of p){const{trackId:h}=d,g=t.get(h),_=this._pc.getTransceivers().find(R=>R.mid===g);if(!_)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(g,_),o.push({localId:g,track:_.receiver.track,rtpReceiver:_.receiver})}return o}async stopReceiving(p){this.assertRecvDirection();for(const r of p){T.debug("stopReceiving() [localId:%s]",r);const c=this._mapMidTransceiver.get(r);if(!c)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(c.mid)}const o={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);const t=await this._pc.createAnswer();T.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const r of p)this._mapMidTransceiver.delete(r)}async pauseReceiving(p){}async resumeReceiving(p){}async getReceiverStats(p){this.assertRecvDirection();const o=this._mapMidTransceiver.get(p);if(!o)throw new Error("associated RTCRtpTransceiver not found");return o.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:p,label:o,protocol:t}){this.assertRecvDirection();const{streamId:r,ordered:c,maxPacketLifeTime:a,maxRetransmits:d}=p,h={negotiated:!0,id:r,ordered:c,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:d,protocol:t};T.debug("receiveDataChannel() [options:%o]",h);const g=this._pc.createDataChannel(o,h);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const _={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const R=await this._pc.createAnswer();if(!this._transportReady){const f=n.parse(R.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f})}T.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",R),await this._pc.setLocalDescription(R),this._hasDataChannelMediaSection=!0}return{dataChannel:g}}async setupTransport({localDtlsRole:p,localSdpObject:o}){o||(o=n.parse(this._pc.localDescription.sdp));const t=w.extractDtlsParameters({sdpObject:o});t.role=p,this._remoteSdp.updateDtlsRole(p==="client"?"server":"client"),await new Promise((r,c)=>{this.safeEmit("@connect",{dtlsParameters:t},r,c)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return wt.Chrome70=y,wt}var vt={},yt={},pi;function _r(){if(pi)return yt;pi=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.getRtpEncodings=n,yt.addLegacySimulcast=e;function n({offerMediaObject:s,track:i}){const w=new Set;for(const b of s.ssrcs??[]){if(b.attribute!=="msid")continue;if(b.value.split(" ")[1]===i.id){const T=b.id;w.add(T)}}if(w.size===0)throw new Error(`a=ssrc line with msid information not found [track.id:${i.id}]`);const m=new Map;for(const b of s.ssrcGroups??[]){if(b.semantics!=="FID")continue;let[C,T]=b.ssrcs.split(/\s+/);C=Number(C),T=Number(T),w.has(C)&&(w.delete(C),w.delete(T),m.set(C,T))}for(const b of w)m.set(b,null);const u=[];for(const[b,C]of m){const T={ssrc:b};C&&(T.rtx={ssrc:C}),u.push(T)}return u}function e({offerMediaObject:s,track:i,numStreams:w}){if(w<=1)throw new TypeError("numStreams must be greater than 1");let m,u,b;if(!(s.ssrcs??[]).find(S=>S.attribute!=="msid"?!1:S.value.split(" ")[1]===i.id?(m=S.id,b=S.value.split(" ")[0],!0):!1))throw new Error(`a=ssrc line with msid information not found [track.id:${i.id}]`);(s.ssrcGroups??[]).some(S=>{if(S.semantics!=="FID")return!1;const p=S.ssrcs.split(/\s+/);return Number(p[0])===m?(u=Number(p[1]),!0):!1});const T=s.ssrcs.find(S=>S.attribute==="cname"&&S.id===m);if(!T)throw new Error(`a=ssrc line with cname information not found [track.id:${i.id}]`);const v=T.value,l=[],y=[];for(let S=0;S<w;++S)l.push(m+S),u&&y.push(u+S);s.ssrcGroups=s.ssrcGroups??[],s.ssrcs=s.ssrcs??[],s.ssrcGroups.push({semantics:"SIM",ssrcs:l.join(" ")});for(const S of l)s.ssrcs.push({id:S,attribute:"cname",value:v}),s.ssrcs.push({id:S,attribute:"msid",value:`${b} ${i.id}`});for(let S=0;S<y.length;++S){const p=l[S],o=y[S];s.ssrcs.push({id:o,attribute:"cname",value:v}),s.ssrcs.push({id:o,attribute:"msid",value:`${b} ${i.id}`}),s.ssrcGroups.push({semantics:"FID",ssrcs:`${p} ${o}`})}}return yt}var li;function ua(){if(li)return vt;li=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.Chrome67=void 0;const n=se(),e=Q(),s=Y(),i=Z(),w=le(),m=_r(),u=ie(),b=he(),C=new e.Logger("Chrome67"),T="Chrome67",v={OS:1024,MIS:1024};let l=class un extends u.HandlerInterface{_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_sendStream=new MediaStream;_mapSendLocalIdRtpSender=new Map;_nextSendLocalId=0;_mapRecvLocalIdInfo=new Map;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new un}constructor(){super()}get name(){return T}close(){if(C.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){C.debug("getNativeRtpCapabilities()");const S=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const p=await S.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{S.close()}catch{}const o=n.parse(p.sdp);return w.extractRtpCapabilities({sdpObject:o})}catch(p){try{S.close()}catch{}throw p}}async getNativeSctpCapabilities(){return C.debug("getNativeSctpCapabilities()"),{numStreams:v}}run({direction:S,iceParameters:p,iceCandidates:o,dtlsParameters:t,sctpParameters:r,iceServers:c,iceTransportPolicy:a,additionalSettings:d,proprietaryConstraints:h,extendedRtpCapabilities:g}){C.debug("run()"),this._direction=S,this._remoteSdp=new b.RemoteSdp({iceParameters:p,iceCandidates:o,dtlsParameters:t,sctpParameters:r,planB:!0}),this._sendingRtpParametersByKind={audio:i.getSendingRtpParameters("audio",g),video:i.getSendingRtpParameters("video",g)},this._sendingRemoteRtpParametersByKind={audio:i.getSendingRemoteRtpParameters("audio",g),video:i.getSendingRemoteRtpParameters("video",g)},t.role&&t.role!=="auto"&&(this._forcedLocalDtlsRole=t.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:c??[],iceTransportPolicy:a??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...d},h),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",_=>{this.emit("@icecandidateerror",_)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(C.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(S){C.debug("updateIceServers()");const p=this._pc.getConfiguration();p.iceServers=S,this._pc.setConfiguration(p)}async restartIce(S){if(C.debug("restartIce()"),this._remoteSdp.updateIceParameters(S),!!this._transportReady)if(this._direction==="send"){const p=await this._pc.createOffer({iceRestart:!0});C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const o={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}else{const p={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);const o=await this._pc.createAnswer();C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o)}}async getTransportStats(){return this._pc.getStats()}async send({track:S,encodings:p,codecOptions:o,codec:t}){this.assertSendDirection(),C.debug("send() [kind:%s, track.id:%s]",S.kind,S.id),t&&C.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(S),this._pc.addTrack(S,this._sendStream);let r=await this._pc.createOffer(),c=n.parse(r.sdp);c.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let a;const d=s.clone(this._sendingRtpParametersByKind[S.kind]);d.codecs=i.reduceCodecs(d.codecs);const h=s.clone(this._sendingRemoteRtpParametersByKind[S.kind]);if(h.codecs=i.reduceCodecs(h.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),S.kind==="video"&&p&&p.length>1&&(C.debug("send() | enabling simulcast"),c=n.parse(r.sdp),a=c.media.find(f=>f.type==="video"),m.addLegacySimulcast({offerMediaObject:a,track:S,numStreams:p.length}),r={type:"offer",sdp:n.write(c)}),C.debug("send() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),c=n.parse(this._pc.localDescription.sdp),a=c.media.find(f=>f.type===S.kind),d.rtcp.cname=w.getCname({offerMediaObject:a}),d.encodings=m.getRtpEncodings({offerMediaObject:a,track:S}),p)for(let f=0;f<d.encodings.length;++f)p[f]&&Object.assign(d.encodings[f],p[f]);if(d.encodings.length>1&&d.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const f of d.encodings)f.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:d,answerRtpParameters:h,codecOptions:o});const g={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g);const _=String(this._nextSendLocalId);this._nextSendLocalId++;const R=this._pc.getSenders().find(f=>f.track===S);return this._mapSendLocalIdRtpSender.set(_,R),{localId:_,rtpParameters:d,rtpSender:R}}async stopSending(S){this.assertSendDirection(),C.debug("stopSending() [localId:%s]",S);const p=this._mapSendLocalIdRtpSender.get(S);if(!p)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(p),p.track&&this._sendStream.removeTrack(p.track),this._mapSendLocalIdRtpSender.delete(S);const o=await this._pc.createOffer();C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",o);try{await this._pc.setLocalDescription(o)}catch(r){if(this._sendStream.getTracks().length===0){C.warn("stopSending() | ignoring expected error due no sending tracks: %s",r.toString());return}throw r}if(this._pc.signalingState==="stable")return;const t={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}async pauseSending(S){}async resumeSending(S){}async replaceTrack(S,p){this.assertSendDirection(),p?C.debug("replaceTrack() [localId:%s, track.id:%s]",S,p.id):C.debug("replaceTrack() [localId:%s, no track]",S);const o=this._mapSendLocalIdRtpSender.get(S);if(!o)throw new Error("associated RTCRtpSender not found");const t=o.track;await o.replaceTrack(p),t&&this._sendStream.removeTrack(t),p&&this._sendStream.addTrack(p)}async setMaxSpatialLayer(S,p){this.assertSendDirection(),C.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",S,p);const o=this._mapSendLocalIdRtpSender.get(S);if(!o)throw new Error("associated RTCRtpSender not found");const t=o.getParameters();t.encodings.forEach((r,c)=>{c<=p?r.active=!0:r.active=!1}),await o.setParameters(t)}async setRtpEncodingParameters(S,p){this.assertSendDirection(),C.debug("setRtpEncodingParameters() [localId:%s, params:%o]",S,p);const o=this._mapSendLocalIdRtpSender.get(S);if(!o)throw new Error("associated RTCRtpSender not found");const t=o.getParameters();t.encodings.forEach((r,c)=>{t.encodings[c]={...r,...p}}),await o.setParameters(t)}async getSenderStats(S){this.assertSendDirection();const p=this._mapSendLocalIdRtpSender.get(S);if(!p)throw new Error("associated RTCRtpSender not found");return p.getStats()}async sendDataChannel({ordered:S,maxPacketLifeTime:p,maxRetransmits:o,label:t,protocol:r}){this.assertSendDirection();const c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:S,maxPacketLifeTime:p,maxRetransmitTime:p,maxRetransmits:o,protocol:r};C.debug("sendDataChannel() [options:%o]",c);const a=this._pc.createDataChannel(t,c);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%v.MIS,!this._hasDataChannelMediaSection){const h=await this._pc.createOffer(),g=n.parse(h.sdp),_=g.media.find(f=>f.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:g}),C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",h),await this._pc.setLocalDescription(h),this._remoteSdp.sendSctpAssociation({offerMediaObject:_});const R={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",R),await this._pc.setRemoteDescription(R),this._hasDataChannelMediaSection=!0}const d={streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits};return{dataChannel:a,sctpStreamParameters:d}}async receive(S){this.assertRecvDirection();const p=[];for(const c of S){const{trackId:a,kind:d,rtpParameters:h,streamId:g}=c;C.debug("receive() [trackId:%s, kind:%s]",a,d);const _=d;this._remoteSdp.receive({mid:_,kind:d,offerRtpParameters:h,streamId:g??h.rtcp.cname,trackId:a})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let t=await this._pc.createAnswer();const r=n.parse(t.sdp);for(const c of S){const{kind:a,rtpParameters:d}=c,h=a,g=r.media.find(_=>String(_.mid)===h);w.applyCodecParameters({offerRtpParameters:d,answerMediaObject:g})}t={type:"answer",sdp:n.write(r)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:r}),C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const c of S){const{kind:a,trackId:d,rtpParameters:h}=c,g=d,_=a,R=this._pc.getReceivers().find(f=>f.track&&f.track.id===g);if(!R)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(g,{mid:_,rtpParameters:h,rtpReceiver:R}),p.push({localId:g,track:R.track,rtpReceiver:R})}return p}async stopReceiving(S){this.assertRecvDirection();for(const t of S){C.debug("stopReceiving() [localId:%s]",t);const{mid:r,rtpParameters:c}=this._mapRecvLocalIdInfo.get(t)??{};this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:r,offerRtpParameters:c})}const p={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);const o=await this._pc.createAnswer();C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o)}async pauseReceiving(S){}async resumeReceiving(S){}async getReceiverStats(S){this.assertRecvDirection();const{rtpReceiver:p}=this._mapRecvLocalIdInfo.get(S)??{};if(!p)throw new Error("associated RTCRtpReceiver not found");return p.getStats()}async receiveDataChannel({sctpStreamParameters:S,label:p,protocol:o}){this.assertRecvDirection();const{streamId:t,ordered:r,maxPacketLifeTime:c,maxRetransmits:a}=S,d={negotiated:!0,id:t,ordered:r,maxPacketLifeTime:c,maxRetransmitTime:c,maxRetransmits:a,protocol:o};C.debug("receiveDataChannel() [options:%o]",d);const h=this._pc.createDataChannel(p,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const g={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",g),await this._pc.setRemoteDescription(g);const _=await this._pc.createAnswer();if(!this._transportReady){const R=n.parse(_.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:R})}C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setLocalDescription(_),this._hasDataChannelMediaSection=!0}return{dataChannel:h}}async setupTransport({localDtlsRole:S,localSdpObject:p}){p||(p=n.parse(this._pc.localDescription.sdp));const o=w.extractDtlsParameters({sdpObject:p});o.role=S,this._remoteSdp.updateDtlsRole(S==="client"?"server":"client"),await new Promise((t,r)=>{this.safeEmit("@connect",{dtlsParameters:o},t,r)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return vt.Chrome67=l,vt}var bt={},hi;function fa(){if(hi)return bt;hi=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.Chrome55=void 0;const n=se(),e=Q(),s=J(),i=Y(),w=Z(),m=le(),u=_r(),b=ie(),C=he(),T=new e.Logger("Chrome55"),v="Chrome55",l={OS:1024,MIS:1024};let y=class fn extends b.HandlerInterface{_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_sendStream=new MediaStream;_mapSendLocalIdTrack=new Map;_nextSendLocalId=0;_mapRecvLocalIdInfo=new Map;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new fn}constructor(){super()}get name(){return v}close(){if(T.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){T.debug("getNativeRtpCapabilities()");const p=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const o=await p.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{p.close()}catch{}const t=n.parse(o.sdp);return m.extractRtpCapabilities({sdpObject:t})}catch(o){try{p.close()}catch{}throw o}}async getNativeSctpCapabilities(){return T.debug("getNativeSctpCapabilities()"),{numStreams:l}}run({direction:p,iceParameters:o,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:a,iceTransportPolicy:d,additionalSettings:h,proprietaryConstraints:g,extendedRtpCapabilities:_}){T.debug("run()"),this._direction=p,this._remoteSdp=new C.RemoteSdp({iceParameters:o,iceCandidates:t,dtlsParameters:r,sctpParameters:c,planB:!0}),this._sendingRtpParametersByKind={audio:w.getSendingRtpParameters("audio",_),video:w.getSendingRtpParameters("video",_)},this._sendingRemoteRtpParametersByKind={audio:w.getSendingRemoteRtpParameters("audio",_),video:w.getSendingRemoteRtpParameters("video",_)},r.role&&r.role!=="auto"&&(this._forcedLocalDtlsRole=r.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...h},g),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",R=>{this.emit("@icecandidateerror",R)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(T.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(p){T.debug("updateIceServers()");const o=this._pc.getConfiguration();o.iceServers=p,this._pc.setConfiguration(o)}async restartIce(p){if(T.debug("restartIce()"),this._remoteSdp.updateIceParameters(p),!!this._transportReady)if(this._direction==="send"){const o=await this._pc.createOffer({iceRestart:!0});T.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const t={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const o={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);const t=await this._pc.createAnswer();T.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:p,encodings:o,codecOptions:t,codec:r}){this.assertSendDirection(),T.debug("send() [kind:%s, track.id:%s]",p.kind,p.id),r&&T.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(p),this._pc.addStream(this._sendStream);let c=await this._pc.createOffer(),a=n.parse(c.sdp);a.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let d;const h=i.clone(this._sendingRtpParametersByKind[p.kind]);h.codecs=w.reduceCodecs(h.codecs);const g=i.clone(this._sendingRemoteRtpParametersByKind[p.kind]);if(g.codecs=w.reduceCodecs(g.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),p.kind==="video"&&o&&o.length>1&&(T.debug("send() | enabling simulcast"),a=n.parse(c.sdp),d=a.media.find(f=>f.type==="video"),u.addLegacySimulcast({offerMediaObject:d,track:p,numStreams:o.length}),c={type:"offer",sdp:n.write(a)}),T.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),a=n.parse(this._pc.localDescription.sdp),d=a.media.find(f=>f.type===p.kind),h.rtcp.cname=m.getCname({offerMediaObject:d}),h.encodings=u.getRtpEncodings({offerMediaObject:d,track:p}),o)for(let f=0;f<h.encodings.length;++f)o[f]&&Object.assign(h.encodings[f],o[f]);if(h.encodings.length>1&&h.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const f of h.encodings)f.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,offerRtpParameters:h,answerRtpParameters:g,codecOptions:t});const _={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_);const R=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(R,p),{localId:R,rtpParameters:h}}async stopSending(p){this.assertSendDirection(),T.debug("stopSending() [localId:%s]",p);const o=this._mapSendLocalIdTrack.get(p);if(!o)throw new Error("track not found");this._mapSendLocalIdTrack.delete(p),this._sendStream.removeTrack(o),this._pc.addStream(this._sendStream);const t=await this._pc.createOffer();T.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t);try{await this._pc.setLocalDescription(t)}catch(c){if(this._sendStream.getTracks().length===0){T.warn("stopSending() | ignoring expected error due no sending tracks: %s",c.toString());return}throw c}if(this._pc.signalingState==="stable")return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async pauseSending(p){}async resumeSending(p){}async replaceTrack(p,o){throw new s.UnsupportedError("not implemented")}async setMaxSpatialLayer(p,o){throw new s.UnsupportedError(" not implemented")}async setRtpEncodingParameters(p,o){throw new s.UnsupportedError("not supported")}async getSenderStats(p){throw new s.UnsupportedError("not implemented")}async sendDataChannel({ordered:p,maxPacketLifeTime:o,maxRetransmits:t,label:r,protocol:c}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:p,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:t,protocol:c};T.debug("sendDataChannel() [options:%o]",a);const d=this._pc.createDataChannel(r,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%l.MIS,!this._hasDataChannelMediaSection){const g=await this._pc.createOffer(),_=n.parse(g.sdp),R=_.media.find(E=>E.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:_}),T.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g),this._remoteSdp.sendSctpAssociation({offerMediaObject:R});const f={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._hasDataChannelMediaSection=!0}const h={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:d,sctpStreamParameters:h}}async receive(p){this.assertRecvDirection();const o=[];for(const a of p){const{trackId:d,kind:h,rtpParameters:g,streamId:_}=a;T.debug("receive() [trackId:%s, kind:%s]",d,h);const R=h;this._remoteSdp.receive({mid:R,kind:h,offerRtpParameters:g,streamId:_??g.rtcp.cname,trackId:d})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let r=await this._pc.createAnswer();const c=n.parse(r.sdp);for(const a of p){const{kind:d,rtpParameters:h}=a,g=d,_=c.media.find(R=>String(R.mid)===g);m.applyCodecParameters({offerRtpParameters:h,answerMediaObject:_})}r={type:"answer",sdp:n.write(c)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),T.debug("receive() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const a of p){const{kind:d,trackId:h,rtpParameters:g}=a,_=d,R=h,f=a.streamId??g.rtcp.cname,P=this._pc.getRemoteStreams().find(x=>x.id===f).getTrackById(R);if(!P)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(R,{mid:_,rtpParameters:g}),o.push({localId:R,track:P})}return o}async stopReceiving(p){this.assertRecvDirection();for(const r of p){T.debug("stopReceiving() [localId:%s]",r);const{mid:c,rtpParameters:a}=this._mapRecvLocalIdInfo.get(r)??{};this._mapRecvLocalIdInfo.delete(r),this._remoteSdp.planBStopReceiving({mid:c,offerRtpParameters:a})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);const t=await this._pc.createAnswer();T.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async pauseReceiving(p){}async resumeReceiving(p){}async getReceiverStats(p){throw new s.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:p,label:o,protocol:t}){this.assertRecvDirection();const{streamId:r,ordered:c,maxPacketLifeTime:a,maxRetransmits:d}=p,h={negotiated:!0,id:r,ordered:c,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:d,protocol:t};T.debug("receiveDataChannel() [options:%o]",h);const g=this._pc.createDataChannel(o,h);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const _={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const R=await this._pc.createAnswer();if(!this._transportReady){const f=n.parse(R.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f})}T.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",R),await this._pc.setLocalDescription(R),this._hasDataChannelMediaSection=!0}return{dataChannel:g}}async setupTransport({localDtlsRole:p,localSdpObject:o}){o||(o=n.parse(this._pc.localDescription.sdp));const t=m.extractDtlsParameters({sdpObject:o});t.role=p,this._remoteSdp.updateDtlsRole(p==="client"?"server":"client"),await new Promise((r,c)=>{this.safeEmit("@connect",{dtlsParameters:t},r,c)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return bt.Chrome55=y,bt}var St={},ui;function ma(){if(ui)return St;ui=1,Object.defineProperty(St,"__esModule",{value:!0}),St.Firefox120=void 0;const n=se(),e=Q(),s=J(),i=Y(),w=Z(),m=le(),u=je(),b=ie(),C=he(),T=Ee(),v=new e.Logger("Firefox120"),l="Firefox120",y={OS:16,MIS:2048};let S=class mn extends b.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new mn}constructor(){super()}get name(){return l}close(){if(v.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){v.debug("getNativeRtpCapabilities()");const o=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const c=t.captureStream().getVideoTracks()[0];try{o.addTransceiver("audio",{direction:"sendrecv"}),o.addTransceiver(c,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const a=await o.createOffer();try{t.remove()}catch{}try{c.stop()}catch{}try{o.close()}catch{}const d=n.parse(a.sdp);return m.extractRtpCapabilities({sdpObject:d})}catch(a){try{t.remove()}catch{}try{c.stop()}catch{}try{o.close()}catch{}throw a}}async getNativeSctpCapabilities(){return v.debug("getNativeSctpCapabilities()"),{numStreams:y}}run({direction:o,iceParameters:t,iceCandidates:r,dtlsParameters:c,sctpParameters:a,iceServers:d,iceTransportPolicy:h,additionalSettings:g,proprietaryConstraints:_,extendedRtpCapabilities:R}){this.assertNotClosed(),v.debug("run()"),this._direction=o,this._remoteSdp=new C.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:c,sctpParameters:a}),this._sendingRtpParametersByKind={audio:w.getSendingRtpParameters("audio",R),video:w.getSendingRtpParameters("video",R)},this._sendingRemoteRtpParametersByKind={audio:w.getSendingRemoteRtpParameters("audio",R),video:w.getSendingRemoteRtpParameters("video",R)},this._pc=new RTCPeerConnection({iceServers:d??[],iceTransportPolicy:h??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...g},_),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",f=>{this.emit("@icecandidateerror",f)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(v.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(o){throw this.assertNotClosed(),new s.UnsupportedError("not supported")}async restartIce(o){if(this.assertNotClosed(),v.debug("restartIce()"),this._remoteSdp.updateIceParameters(o),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});v.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const r={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();v.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:o,encodings:t,codecOptions:r,codec:c,onRtpSender:a}){this.assertNotClosed(),this.assertSendDirection(),v.debug("send() [kind:%s, track.id:%s]",o.kind,o.id),t&&t.length>1&&t.forEach((D,k)=>{D.rid=`r${k}`});const d=i.clone(this._sendingRtpParametersByKind[o.kind]);d.codecs=w.reduceCodecs(d.codecs,c);const h=i.clone(this._sendingRemoteRtpParametersByKind[o.kind]);h.codecs=w.reduceCodecs(h.codecs,c);const g=this._pc.addTransceiver(o,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});a&&a(g.sender);const _=await this._pc.createOffer();let R=n.parse(_.sdp);R.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:R});const f=(0,T.parse)((t??[{}])[0].scalabilityMode);v.debug("send() | calling pc.setLocalDescription() [offer:%o]",_),await this._pc.setLocalDescription(_);const E=g.mid;d.mid=E,R=n.parse(this._pc.localDescription.sdp);const P=R.media[R.media.length-1];if(d.rtcp.cname=m.getCname({offerMediaObject:P}),!t)d.encodings=u.getRtpEncodings({offerMediaObject:P});else if(t.length===1){const D=u.getRtpEncodings({offerMediaObject:P});Object.assign(D[0],t[0]),d.encodings=D}else d.encodings=t;if(d.encodings.length>1&&(d.codecs[0].mimeType.toLowerCase()==="video/vp8"||d.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const D of d.encodings)D.scalabilityMode?D.scalabilityMode=`L1T${f.temporalLayers}`:D.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:P,offerRtpParameters:d,answerRtpParameters:h,codecOptions:r});const x={type:"answer",sdp:this._remoteSdp.getSdp()};return v.debug("send() | calling pc.setRemoteDescription() [answer:%o]",x),await this._pc.setRemoteDescription(x),this._mapMidTransceiver.set(E,g),{localId:E,rtpParameters:d,rtpSender:g.sender}}async stopSending(o){if(this.assertSendDirection(),v.debug("stopSending() [localId:%s]",o),this._closed)return;const t=this._mapMidTransceiver.get(o);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const r=await this._pc.createOffer();v.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const c={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c),this._mapMidTransceiver.delete(o)}async pauseSending(o){this.assertNotClosed(),this.assertSendDirection(),v.debug("pauseSending() [localId:%s]",o);const t=this._mapMidTransceiver.get(o);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(o);const r=await this._pc.createOffer();v.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const c={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async resumeSending(o){this.assertNotClosed(),this.assertSendDirection(),v.debug("resumeSending() [localId:%s]",o);const t=this._mapMidTransceiver.get(o);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(o);const r=await this._pc.createOffer();v.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const c={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async replaceTrack(o,t){this.assertNotClosed(),this.assertSendDirection(),t?v.debug("replaceTrack() [localId:%s, track.id:%s]",o,t.id):v.debug("replaceTrack() [localId:%s, no track]",o);const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(o,t){this.assertNotClosed(),this.assertSendDirection(),v.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",o,t);const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated transceiver not found");const c=r.sender.getParameters();c.encodings.forEach((h,g)=>{g<=t?h.active=!0:h.active=!1}),await r.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(o,c.encodings);const a=await this._pc.createOffer();v.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async setRtpEncodingParameters(o,t){this.assertNotClosed(),this.assertSendDirection(),v.debug("setRtpEncodingParameters() [localId:%s, params:%o]",o,t);const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated RTCRtpTransceiver not found");const c=r.sender.getParameters();c.encodings.forEach((h,g)=>{c.encodings[g]={...h,...t}}),await r.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(o,c.encodings);const a=await this._pc.createOffer();v.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async getSenderStats(o){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(o);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:o,maxPacketLifeTime:t,maxRetransmits:r,label:c,protocol:a}){this.assertNotClosed(),this.assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:o,maxPacketLifeTime:t,maxRetransmits:r,protocol:a};v.debug("sendDataChannel() [options:%o]",d);const h=this._pc.createDataChannel(c,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%y.MIS,!this._hasDataChannelMediaSection){const _=await this._pc.createOffer(),R=n.parse(_.sdp),f=R.media.find(P=>P.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:R}),v.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",_),await this._pc.setLocalDescription(_),this._remoteSdp.sendSctpAssociation({offerMediaObject:f});const E={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",E),await this._pc.setRemoteDescription(E),this._hasDataChannelMediaSection=!0}const g={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits};return{dataChannel:h,sctpStreamParameters:g}}async receive(o){this.assertNotClosed(),this.assertRecvDirection();const t=[],r=new Map;for(const h of o){const{trackId:g,kind:_,rtpParameters:R,streamId:f}=h;v.debug("receive() [trackId:%s, kind:%s]",g,_);const E=R.mid??String(this._mapMidTransceiver.size);r.set(g,E),this._remoteSdp.receive({mid:E,kind:_,offerRtpParameters:R,streamId:f??R.rtcp.cname,trackId:g})}const c={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);for(const h of o){const{trackId:g,onRtpReceiver:_}=h;if(_){const R=r.get(g),f=this._pc.getTransceivers().find(E=>E.mid===R);if(!f)throw new Error("transceiver not found");_(f.receiver)}}let a=await this._pc.createAnswer();const d=n.parse(a.sdp);for(const h of o){const{trackId:g,rtpParameters:_}=h,R=r.get(g),f=d.media.find(E=>String(E.mid)===R);m.applyCodecParameters({offerRtpParameters:_,answerMediaObject:f}),a={type:"answer",sdp:n.write(d)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:d}),v.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const h of o){const{trackId:g}=h,_=r.get(g),R=this._pc.getTransceivers().find(f=>f.mid===_);if(!R)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(_,R),t.push({localId:_,track:R.receiver.track,rtpReceiver:R.receiver})}return t}async stopReceiving(o){if(this.assertRecvDirection(),this._closed)return;for(const c of o){v.debug("stopReceiving() [localId:%s]",c);const a=this._mapMidTransceiver.get(c);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();v.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const c of o)this._mapMidTransceiver.delete(c)}async pauseReceiving(o){this.assertNotClosed(),this.assertRecvDirection();for(const c of o){v.debug("pauseReceiving() [localId:%s]",c);const a=this._mapMidTransceiver.get(c);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(c)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();v.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(o){this.assertNotClosed(),this.assertRecvDirection();for(const c of o){v.debug("resumeReceiving() [localId:%s]",c);const a=this._mapMidTransceiver.get(c);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();v.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(o){this.assertRecvDirection();const t=this._mapMidTransceiver.get(o);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:o,label:t,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:c,ordered:a,maxPacketLifeTime:d,maxRetransmits:h}=o,g={negotiated:!0,id:c,ordered:a,maxPacketLifeTime:d,maxRetransmits:h,protocol:r};v.debug("receiveDataChannel() [options:%o]",g);const _=this._pc.createDataChannel(t,g);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const R={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",R),await this._pc.setRemoteDescription(R);const f=await this._pc.createAnswer();if(!this._transportReady){const E=n.parse(f.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:E})}v.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setLocalDescription(f),this._hasDataChannelMediaSection=!0}return{dataChannel:_}}async setupTransport({localDtlsRole:o,localSdpObject:t}){t||(t=n.parse(this._pc.localDescription.sdp));const r=m.extractDtlsParameters({sdpObject:t});r.role=o,this._remoteSdp.updateDtlsRole(o==="client"?"server":"client"),await new Promise((c,a)=>{this.safeEmit("@connect",{dtlsParameters:r},c,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new s.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return St.Firefox120=S,St}var Rt={},fi;function ga(){if(fi)return Rt;fi=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.Firefox60=void 0;const n=se(),e=Q(),s=J(),i=Y(),w=Z(),m=le(),u=je(),b=ie(),C=he(),T=Ee(),v=new e.Logger("Firefox60"),l="Firefox60",y={OS:16,MIS:2048};let S=class gn extends b.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new gn}constructor(){super()}get name(){return l}close(){if(v.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){v.debug("getNativeRtpCapabilities()");const o=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const c=t.captureStream().getVideoTracks()[0];try{o.addTransceiver("audio",{direction:"sendrecv"});const a=o.addTransceiver(c,{direction:"sendrecv"}),d=a.sender.getParameters(),h=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];d.encodings=h,await a.sender.setParameters(d);const g=await o.createOffer();try{t.remove()}catch{}try{c.stop()}catch{}try{o.close()}catch{}const _=n.parse(g.sdp);return m.extractRtpCapabilities({sdpObject:_})}catch(a){try{t.remove()}catch{}try{c.stop()}catch{}try{o.close()}catch{}throw a}}async getNativeSctpCapabilities(){return v.debug("getNativeSctpCapabilities()"),{numStreams:y}}run({direction:o,iceParameters:t,iceCandidates:r,dtlsParameters:c,sctpParameters:a,iceServers:d,iceTransportPolicy:h,additionalSettings:g,proprietaryConstraints:_,extendedRtpCapabilities:R}){this.assertNotClosed(),v.debug("run()"),this._direction=o,this._remoteSdp=new C.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:c,sctpParameters:a}),this._sendingRtpParametersByKind={audio:w.getSendingRtpParameters("audio",R),video:w.getSendingRtpParameters("video",R)},this._sendingRemoteRtpParametersByKind={audio:w.getSendingRemoteRtpParameters("audio",R),video:w.getSendingRemoteRtpParameters("video",R)},this._pc=new RTCPeerConnection({iceServers:d??[],iceTransportPolicy:h??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...g},_),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",f=>{this.emit("@icecandidateerror",f)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(v.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(o){throw this.assertNotClosed(),new s.UnsupportedError("not supported")}async restartIce(o){if(this.assertNotClosed(),v.debug("restartIce()"),this._remoteSdp.updateIceParameters(o),!!this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});v.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const r={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();v.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:o,encodings:t,codecOptions:r,codec:c}){this.assertNotClosed(),this.assertSendDirection(),v.debug("send() [kind:%s, track.id:%s]",o.kind,o.id),t&&(t=i.clone(t),t.forEach((x,D)=>{x.rid=`r${D}`}),t.reverse());const a=i.clone(this._sendingRtpParametersByKind[o.kind]);a.codecs=w.reduceCodecs(a.codecs,c);const d=i.clone(this._sendingRemoteRtpParametersByKind[o.kind]);d.codecs=w.reduceCodecs(d.codecs,c);const h=this._pc.addTransceiver(o,{direction:"sendonly",streams:[this._sendStream]});if(t){const x=h.sender.getParameters();x.encodings=t,await h.sender.setParameters(x)}const g=await this._pc.createOffer();let _=n.parse(g.sdp);_.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:_});const R=(0,T.parse)((t??[{}])[0].scalabilityMode);v.debug("send() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g);const f=h.mid;a.mid=f,_=n.parse(this._pc.localDescription.sdp);const E=_.media[_.media.length-1];if(a.rtcp.cname=m.getCname({offerMediaObject:E}),!t)a.encodings=u.getRtpEncodings({offerMediaObject:E});else if(t.length===1){const x=u.getRtpEncodings({offerMediaObject:E});Object.assign(x[0],t[0]),a.encodings=x}else a.encodings=t.reverse();if(a.encodings.length>1&&(a.codecs[0].mimeType.toLowerCase()==="video/vp8"||a.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const x of a.encodings)x.scalabilityMode?x.scalabilityMode=`L1T${R.temporalLayers}`:x.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:E,offerRtpParameters:a,answerRtpParameters:d,codecOptions:r});const P={type:"answer",sdp:this._remoteSdp.getSdp()};return v.debug("send() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P),this._mapMidTransceiver.set(f,h),{localId:f,rtpParameters:a,rtpSender:h.sender}}async stopSending(o){if(this.assertSendDirection(),v.debug("stopSending() [localId:%s]",o),this._closed)return;const t=this._mapMidTransceiver.get(o);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const r=await this._pc.createOffer();v.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const c={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c),this._mapMidTransceiver.delete(o)}async pauseSending(o){this.assertNotClosed(),this.assertSendDirection(),v.debug("pauseSending() [localId:%s]",o);const t=this._mapMidTransceiver.get(o);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(o);const r=await this._pc.createOffer();v.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const c={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async resumeSending(o){this.assertNotClosed(),this.assertSendDirection(),v.debug("resumeSending() [localId:%s]",o);const t=this._mapMidTransceiver.get(o);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(o);const r=await this._pc.createOffer();v.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const c={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async replaceTrack(o,t){this.assertNotClosed(),this.assertSendDirection(),t?v.debug("replaceTrack() [localId:%s, track.id:%s]",o,t.id):v.debug("replaceTrack() [localId:%s, no track]",o);const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(t)}async setMaxSpatialLayer(o,t){this.assertNotClosed(),this.assertSendDirection(),v.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",o,t);const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated transceiver not found");const c=r.sender.getParameters();t=c.encodings.length-1-t,c.encodings.forEach((h,g)=>{g>=t?h.active=!0:h.active=!1}),await r.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(o,c.encodings);const a=await this._pc.createOffer();v.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async setRtpEncodingParameters(o,t){this.assertNotClosed(),this.assertSendDirection(),v.debug("setRtpEncodingParameters() [localId:%s, params:%o]",o,t);const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated RTCRtpTransceiver not found");const c=r.sender.getParameters();c.encodings.forEach((h,g)=>{c.encodings[g]={...h,...t}}),await r.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(o,c.encodings);const a=await this._pc.createOffer();v.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async getSenderStats(o){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(o);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:o,maxPacketLifeTime:t,maxRetransmits:r,label:c,protocol:a}){this.assertNotClosed(),this.assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:o,maxPacketLifeTime:t,maxRetransmits:r,protocol:a};v.debug("sendDataChannel() [options:%o]",d);const h=this._pc.createDataChannel(c,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%y.MIS,!this._hasDataChannelMediaSection){const _=await this._pc.createOffer(),R=n.parse(_.sdp),f=R.media.find(P=>P.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:R}),v.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",_),await this._pc.setLocalDescription(_),this._remoteSdp.sendSctpAssociation({offerMediaObject:f});const E={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",E),await this._pc.setRemoteDescription(E),this._hasDataChannelMediaSection=!0}const g={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits};return{dataChannel:h,sctpStreamParameters:g}}async receive(o){this.assertNotClosed(),this.assertRecvDirection();const t=[],r=new Map;for(const h of o){const{trackId:g,kind:_,rtpParameters:R,streamId:f}=h;v.debug("receive() [trackId:%s, kind:%s]",g,_);const E=R.mid??String(this._mapMidTransceiver.size);r.set(g,E),this._remoteSdp.receive({mid:E,kind:_,offerRtpParameters:R,streamId:f??R.rtcp.cname,trackId:g})}const c={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let a=await this._pc.createAnswer();const d=n.parse(a.sdp);for(const h of o){const{trackId:g,rtpParameters:_}=h,R=r.get(g),f=d.media.find(E=>String(E.mid)===R);m.applyCodecParameters({offerRtpParameters:_,answerMediaObject:f}),a={type:"answer",sdp:n.write(d)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:d}),v.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const h of o){const{trackId:g}=h,_=r.get(g),R=this._pc.getTransceivers().find(f=>f.mid===_);if(!R)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(_,R),t.push({localId:_,track:R.receiver.track,rtpReceiver:R.receiver})}return t}async stopReceiving(o){if(this.assertRecvDirection(),this._closed)return;for(const c of o){v.debug("stopReceiving() [localId:%s]",c);const a=this._mapMidTransceiver.get(c);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();v.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const c of o)this._mapMidTransceiver.delete(c)}async pauseReceiving(o){this.assertNotClosed(),this.assertRecvDirection();for(const c of o){v.debug("pauseReceiving() [localId:%s]",c);const a=this._mapMidTransceiver.get(c);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(c)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();v.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(o){this.assertNotClosed(),this.assertRecvDirection();for(const c of o){v.debug("resumeReceiving() [localId:%s]",c);const a=this._mapMidTransceiver.get(c);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const r=await this._pc.createAnswer();v.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(o){this.assertRecvDirection();const t=this._mapMidTransceiver.get(o);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:o,label:t,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:c,ordered:a,maxPacketLifeTime:d,maxRetransmits:h}=o,g={negotiated:!0,id:c,ordered:a,maxPacketLifeTime:d,maxRetransmits:h,protocol:r};v.debug("receiveDataChannel() [options:%o]",g);const _=this._pc.createDataChannel(t,g);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const R={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",R),await this._pc.setRemoteDescription(R);const f=await this._pc.createAnswer();if(!this._transportReady){const E=n.parse(f.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:E})}v.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setLocalDescription(f),this._hasDataChannelMediaSection=!0}return{dataChannel:_}}async setupTransport({localDtlsRole:o,localSdpObject:t}){t||(t=n.parse(this._pc.localDescription.sdp));const r=m.extractDtlsParameters({sdpObject:t});r.role=o,this._remoteSdp.updateDtlsRole(o==="client"?"server":"client"),await new Promise((c,a)=>{this.safeEmit("@connect",{dtlsParameters:r},c,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new s.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Rt.Firefox60=S,Rt}var Ct={},mi;function _a(){if(mi)return Ct;mi=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.Safari12=void 0;const n=se(),e=Q(),s=Y(),i=Z(),w=le(),m=je(),u=gr(),b=J(),C=ie(),T=he(),v=Ee(),l=new e.Logger("Safari12"),y="Safari12",S={OS:1024,MIS:1024};let p=class _n extends C.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new _n}constructor(){super()}get name(){return y}close(){if(l.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{t.addTransceiver("audio"),t.addTransceiver("video");const r=await t.createOffer();try{t.close()}catch{}const c=n.parse(r.sdp),a=w.extractRtpCapabilities({sdpObject:c});return u.addNackSupportForOpus(a),a}catch(r){try{t.close()}catch{}throw r}}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:S}}run({direction:t,iceParameters:r,iceCandidates:c,dtlsParameters:a,sctpParameters:d,iceServers:h,iceTransportPolicy:g,additionalSettings:_,proprietaryConstraints:R,extendedRtpCapabilities:f}){this.assertNotClosed(),l.debug("run()"),this._direction=t,this._remoteSdp=new T.RemoteSdp({iceParameters:r,iceCandidates:c,dtlsParameters:a,sctpParameters:d}),this._sendingRtpParametersByKind={audio:i.getSendingRtpParameters("audio",f),video:i.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:i.getSendingRemoteRtpParameters("audio",f),video:i.getSendingRemoteRtpParameters("video",f)},a.role&&a.role!=="auto"&&(this._forcedLocalDtlsRole=a.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:h??[],iceTransportPolicy:g??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",..._},R),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",E=>{this.emit("@icecandidateerror",E)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(l.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(t){this.assertNotClosed(),l.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=t,this._pc.setConfiguration(r)}async restartIce(t){if(this.assertNotClosed(),l.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const c={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:t,encodings:r,codecOptions:c,codec:a,onRtpSender:d}){this.assertNotClosed(),this.assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",t.kind,t.id);const h=s.clone(this._sendingRtpParametersByKind[t.kind]);h.codecs=i.reduceCodecs(h.codecs,a);const g=s.clone(this._sendingRemoteRtpParametersByKind[t.kind]);g.codecs=i.reduceCodecs(g.codecs,a);const _=this._remoteSdp.getNextMediaSectionIdx(),R=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream]});d&&d(R.sender);let f=await this._pc.createOffer(),E=n.parse(f.sdp);E.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let P;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:E});const x=(0,v.parse)((r??[{}])[0].scalabilityMode);r&&r.length>1&&(l.debug("send() | enabling legacy simulcast"),E=n.parse(f.sdp),P=E.media[_.idx],m.addLegacySimulcast({offerMediaObject:P,numStreams:r.length}),f={type:"offer",sdp:n.write(E)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const D=R.mid;if(h.mid=D,E=n.parse(this._pc.localDescription.sdp),P=E.media[_.idx],h.rtcp.cname=w.getCname({offerMediaObject:P}),h.encodings=m.getRtpEncodings({offerMediaObject:P}),r)for(let I=0;I<h.encodings.length;++I)r[I]&&Object.assign(h.encodings[I],r[I]);if(h.encodings.length>1&&(h.codecs[0].mimeType.toLowerCase()==="video/vp8"||h.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const I of h.encodings)I.scalabilityMode?I.scalabilityMode=`L1T${x.temporalLayers}`:I.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:P,reuseMid:_.reuseMid,offerRtpParameters:h,answerRtpParameters:g,codecOptions:c});const k={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setRemoteDescription(k),this._mapMidTransceiver.set(D,R),{localId:D,rtpParameters:h,rtpSender:R.sender}}async stopSending(t){if(this.assertSendDirection(),this._closed)return;l.debug("stopSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const a=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d),this._mapMidTransceiver.delete(t)}async pauseSending(t){this.assertNotClosed(),this.assertSendDirection(),l.debug("pauseSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(t);const c=await this._pc.createOffer();l.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async resumeSending(t){this.assertNotClosed(),this.assertSendDirection(),l.debug("resumeSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(t);const c=await this._pc.createOffer();l.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(t,r){this.assertNotClosed(),this.assertSendDirection(),r?l.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):l.debug("replaceTrack() [localId:%s, no track]",t);const c=this._mapMidTransceiver.get(t);if(!c)throw new Error("associated RTCRtpTransceiver not found");await c.sender.replaceTrack(r)}async setMaxSpatialLayer(t,r){this.assertNotClosed(),this.assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r);const c=this._mapMidTransceiver.get(t);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((g,_)=>{_<=r?g.active=!0:g.active=!1}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const d=await this._pc.createOffer();l.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const h={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async setRtpEncodingParameters(t,r){this.assertNotClosed(),this.assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r);const c=this._mapMidTransceiver.get(t);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((g,_)=>{a.encodings[_]={...g,...r}}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const d=await this._pc.createOffer();l.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const h={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async getSenderStats(t){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:c,label:a,protocol:d}){this.assertNotClosed(),this.assertSendDirection();const h={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmits:c,protocol:d};l.debug("sendDataChannel() [options:%o]",h);const g=this._pc.createDataChannel(a,h);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%S.MIS,!this._hasDataChannelMediaSection){const R=await this._pc.createOffer(),f=n.parse(R.sdp),E=f.media.find(x=>x.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f}),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",R),await this._pc.setLocalDescription(R),this._remoteSdp.sendSctpAssociation({offerMediaObject:E});const P={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P),this._hasDataChannelMediaSection=!0}const _={streamId:h.id,ordered:h.ordered,maxPacketLifeTime:h.maxPacketLifeTime,maxRetransmits:h.maxRetransmits};return{dataChannel:g,sctpStreamParameters:_}}async receive(t){this.assertNotClosed(),this.assertRecvDirection();const r=[],c=new Map;for(const g of t){const{trackId:_,kind:R,rtpParameters:f,streamId:E}=g;l.debug("receive() [trackId:%s, kind:%s]",_,R);const P=f.mid??String(this._mapMidTransceiver.size);c.set(_,P),this._remoteSdp.receive({mid:P,kind:R,offerRtpParameters:f,streamId:E??f.rtcp.cname,trackId:_})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);for(const g of t){const{trackId:_,onRtpReceiver:R}=g;if(R){const f=c.get(_),E=this._pc.getTransceivers().find(P=>P.mid===f);if(!E)throw new Error("transceiver not found");R(E.receiver)}}let d=await this._pc.createAnswer();const h=n.parse(d.sdp);for(const g of t){const{trackId:_,rtpParameters:R}=g,f=c.get(_),E=h.media.find(P=>String(P.mid)===f);w.applyCodecParameters({offerRtpParameters:R,answerMediaObject:E})}d={type:"answer",sdp:n.write(h)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const g of t){const{trackId:_}=g,R=c.get(_),f=this._pc.getTransceivers().find(E=>E.mid===R);if(!f)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(R,f),r.push({localId:R,track:f.receiver.track,rtpReceiver:f.receiver})}return r}async stopReceiving(t){if(this.assertRecvDirection(),this._closed)return;for(const a of t){l.debug("stopReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(d.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const a of t)this._mapMidTransceiver.delete(a)}async pauseReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){l.debug("pauseReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="inactive",this._remoteSdp.pauseMediaSection(a)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async resumeReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){l.debug("resumeReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(a)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async getReceiverStats(t){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:c}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:a,ordered:d,maxPacketLifeTime:h,maxRetransmits:g}=t,_={negotiated:!0,id:a,ordered:d,maxPacketLifeTime:h,maxRetransmits:g,protocol:c};l.debug("receiveDataChannel() [options:%o]",_);const R=this._pc.createDataChannel(r,_);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const f={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),await this._pc.setRemoteDescription(f);const E=await this._pc.createAnswer();if(!this._transportReady){const P=n.parse(E.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",E),await this._pc.setLocalDescription(E),this._hasDataChannelMediaSection=!0}return{dataChannel:R}}async setupTransport({localDtlsRole:t,localSdpObject:r}){r||(r=n.parse(this._pc.localDescription.sdp));const c=w.extractDtlsParameters({sdpObject:r});c.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((a,d)=>{this.safeEmit("@connect",{dtlsParameters:c},a,d)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new b.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Ct.Safari12=p,Ct}var Tt={},gi;function wa(){if(gi)return Tt;gi=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.Safari11=void 0;const n=se(),e=Q(),s=Y(),i=Z(),w=le(),m=_r(),u=ie(),b=he(),C=new e.Logger("Safari11"),T="Safari11",v={OS:1024,MIS:1024};let l=class wn extends u.HandlerInterface{_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_sendStream=new MediaStream;_mapSendLocalIdRtpSender=new Map;_nextSendLocalId=0;_mapRecvLocalIdInfo=new Map;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new wn}constructor(){super()}get name(){return T}close(){if(C.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){C.debug("getNativeRtpCapabilities()");const S=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const p=await S.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{S.close()}catch{}const o=n.parse(p.sdp);return w.extractRtpCapabilities({sdpObject:o})}catch(p){try{S.close()}catch{}throw p}}async getNativeSctpCapabilities(){return C.debug("getNativeSctpCapabilities()"),{numStreams:v}}run({direction:S,iceParameters:p,iceCandidates:o,dtlsParameters:t,sctpParameters:r,iceServers:c,iceTransportPolicy:a,additionalSettings:d,proprietaryConstraints:h,extendedRtpCapabilities:g}){C.debug("run()"),this._direction=S,this._remoteSdp=new b.RemoteSdp({iceParameters:p,iceCandidates:o,dtlsParameters:t,sctpParameters:r,planB:!0}),this._sendingRtpParametersByKind={audio:i.getSendingRtpParameters("audio",g),video:i.getSendingRtpParameters("video",g)},this._sendingRemoteRtpParametersByKind={audio:i.getSendingRemoteRtpParameters("audio",g),video:i.getSendingRemoteRtpParameters("video",g)},t.role&&t.role!=="auto"&&(this._forcedLocalDtlsRole=t.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:c??[],iceTransportPolicy:a??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...d},h),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",_=>{this.emit("@icecandidateerror",_)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(C.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(S){C.debug("updateIceServers()");const p=this._pc.getConfiguration();p.iceServers=S,this._pc.setConfiguration(p)}async restartIce(S){if(C.debug("restartIce()"),this._remoteSdp.updateIceParameters(S),!!this._transportReady)if(this._direction==="send"){const p=await this._pc.createOffer({iceRestart:!0});C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const o={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}else{const p={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);const o=await this._pc.createAnswer();C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o)}}async getTransportStats(){return this._pc.getStats()}async send({track:S,encodings:p,codecOptions:o,codec:t}){this.assertSendDirection(),C.debug("send() [kind:%s, track.id:%s]",S.kind,S.id),t&&C.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(S),this._pc.addTrack(S,this._sendStream);let r=await this._pc.createOffer(),c=n.parse(r.sdp);c.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let a;const d=s.clone(this._sendingRtpParametersByKind[S.kind]);d.codecs=i.reduceCodecs(d.codecs);const h=s.clone(this._sendingRemoteRtpParametersByKind[S.kind]);if(h.codecs=i.reduceCodecs(h.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),S.kind==="video"&&p&&p.length>1&&(C.debug("send() | enabling simulcast"),c=n.parse(r.sdp),a=c.media.find(f=>f.type==="video"),m.addLegacySimulcast({offerMediaObject:a,track:S,numStreams:p.length}),r={type:"offer",sdp:n.write(c)}),C.debug("send() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),c=n.parse(this._pc.localDescription.sdp),a=c.media.find(f=>f.type===S.kind),d.rtcp.cname=w.getCname({offerMediaObject:a}),d.encodings=m.getRtpEncodings({offerMediaObject:a,track:S}),p)for(let f=0;f<d.encodings.length;++f)p[f]&&Object.assign(d.encodings[f],p[f]);if(d.encodings.length>1&&d.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const f of d.encodings)f.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:d,answerRtpParameters:h,codecOptions:o});const g={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g);const _=String(this._nextSendLocalId);this._nextSendLocalId++;const R=this._pc.getSenders().find(f=>f.track===S);return this._mapSendLocalIdRtpSender.set(_,R),{localId:_,rtpParameters:d,rtpSender:R}}async stopSending(S){this.assertSendDirection();const p=this._mapSendLocalIdRtpSender.get(S);if(!p)throw new Error("associated RTCRtpSender not found");p.track&&this._sendStream.removeTrack(p.track),this._mapSendLocalIdRtpSender.delete(S);const o=await this._pc.createOffer();C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",o);try{await this._pc.setLocalDescription(o)}catch(r){if(this._sendStream.getTracks().length===0){C.warn("stopSending() | ignoring expected error due no sending tracks: %s",r.toString());return}throw r}if(this._pc.signalingState==="stable")return;const t={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}async pauseSending(S){}async resumeSending(S){}async replaceTrack(S,p){this.assertSendDirection(),p?C.debug("replaceTrack() [localId:%s, track.id:%s]",S,p.id):C.debug("replaceTrack() [localId:%s, no track]",S);const o=this._mapSendLocalIdRtpSender.get(S);if(!o)throw new Error("associated RTCRtpSender not found");const t=o.track;await o.replaceTrack(p),t&&this._sendStream.removeTrack(t),p&&this._sendStream.addTrack(p)}async setMaxSpatialLayer(S,p){this.assertSendDirection(),C.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",S,p);const o=this._mapSendLocalIdRtpSender.get(S);if(!o)throw new Error("associated RTCRtpSender not found");const t=o.getParameters();t.encodings.forEach((r,c)=>{c<=p?r.active=!0:r.active=!1}),await o.setParameters(t)}async setRtpEncodingParameters(S,p){this.assertSendDirection(),C.debug("setRtpEncodingParameters() [localId:%s, params:%o]",S,p);const o=this._mapSendLocalIdRtpSender.get(S);if(!o)throw new Error("associated RTCRtpSender not found");const t=o.getParameters();t.encodings.forEach((r,c)=>{t.encodings[c]={...r,...p}}),await o.setParameters(t)}async getSenderStats(S){this.assertSendDirection();const p=this._mapSendLocalIdRtpSender.get(S);if(!p)throw new Error("associated RTCRtpSender not found");return p.getStats()}async sendDataChannel({ordered:S,maxPacketLifeTime:p,maxRetransmits:o,label:t,protocol:r}){this.assertSendDirection();const c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:S,maxPacketLifeTime:p,maxRetransmits:o,protocol:r};C.debug("sendDataChannel() [options:%o]",c);const a=this._pc.createDataChannel(t,c);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%v.MIS,!this._hasDataChannelMediaSection){const h=await this._pc.createOffer(),g=n.parse(h.sdp),_=g.media.find(f=>f.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:g}),C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",h),await this._pc.setLocalDescription(h),this._remoteSdp.sendSctpAssociation({offerMediaObject:_});const R={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",R),await this._pc.setRemoteDescription(R),this._hasDataChannelMediaSection=!0}const d={streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits};return{dataChannel:a,sctpStreamParameters:d}}async receive(S){this.assertRecvDirection();const p=[];for(const c of S){const{trackId:a,kind:d,rtpParameters:h,streamId:g}=c;C.debug("receive() [trackId:%s, kind:%s]",a,d);const _=d;this._remoteSdp.receive({mid:_,kind:d,offerRtpParameters:h,streamId:g??h.rtcp.cname,trackId:a})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let t=await this._pc.createAnswer();const r=n.parse(t.sdp);for(const c of S){const{kind:a,rtpParameters:d}=c,h=a,g=r.media.find(_=>String(_.mid)===h);w.applyCodecParameters({offerRtpParameters:d,answerMediaObject:g})}t={type:"answer",sdp:n.write(r)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:r}),C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const c of S){const{kind:a,trackId:d,rtpParameters:h}=c,g=a,_=d,R=this._pc.getReceivers().find(f=>f.track&&f.track.id===_);if(!R)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(_,{mid:g,rtpParameters:h,rtpReceiver:R}),p.push({localId:_,track:R.track,rtpReceiver:R})}return p}async stopReceiving(S){this.assertRecvDirection();for(const t of S){C.debug("stopReceiving() [localId:%s]",t);const{mid:r,rtpParameters:c}=this._mapRecvLocalIdInfo.get(t)??{};this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:r,offerRtpParameters:c})}const p={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);const o=await this._pc.createAnswer();C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o)}async getReceiverStats(S){this.assertRecvDirection();const{rtpReceiver:p}=this._mapRecvLocalIdInfo.get(S)??{};if(!p)throw new Error("associated RTCRtpReceiver not found");return p.getStats()}async pauseReceiving(S){}async resumeReceiving(S){}async receiveDataChannel({sctpStreamParameters:S,label:p,protocol:o}){this.assertRecvDirection();const{streamId:t,ordered:r,maxPacketLifeTime:c,maxRetransmits:a}=S,d={negotiated:!0,id:t,ordered:r,maxPacketLifeTime:c,maxRetransmits:a,protocol:o};C.debug("receiveDataChannel() [options:%o]",d);const h=this._pc.createDataChannel(p,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const g={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",g),await this._pc.setRemoteDescription(g);const _=await this._pc.createAnswer();if(!this._transportReady){const R=n.parse(_.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:R})}C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setLocalDescription(_),this._hasDataChannelMediaSection=!0}return{dataChannel:h}}async setupTransport({localDtlsRole:S,localSdpObject:p}){p||(p=n.parse(this._pc.localDescription.sdp));const o=w.extractDtlsParameters({sdpObject:p});o.role=S,this._remoteSdp.updateDtlsRole(S==="client"?"server":"client"),await new Promise((t,r)=>{this.safeEmit("@connect",{dtlsParameters:o},t,r)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Tt.Safari11=l,Tt}var Dt={},Et={},_i;function va(){if(_i)return Et;_i=1,Object.defineProperty(Et,"__esModule",{value:!0}),Et.getCapabilities=e,Et.mangleRtpParameters=s;const n=Y();function e(){const i=RTCRtpReceiver.getCapabilities(),w=n.clone(i);for(const m of w.codecs??[]){if(m.channels=m.numChannels,delete m.numChannels,m.mimeType=m.mimeType??`${m.kind}/${m.name}`,m.parameters){const u=m.parameters;u.apt&&(u.apt=Number(u.apt)),u["packetization-mode"]&&(u["packetization-mode"]=Number(u["packetization-mode"]))}for(const u of m.rtcpFeedback??[])u.parameter||(u.parameter="")}return w}function s(i){const w=n.clone(i);w.mid&&(w.muxId=w.mid,delete w.mid);for(const m of w.codecs)m.channels&&(m.numChannels=m.channels,delete m.channels),m.mimeType&&!m.name&&(m.name=m.mimeType.split("/")[1]),delete m.mimeType;return w}return Et}var wi;function ya(){if(wi)return Dt;wi=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.Edge11=void 0;const n=Q(),e=J(),s=Y(),i=Z(),w=va(),m=ie(),u=new n.Logger("Edge11"),b="Edge11";let C=class vn extends m.HandlerInterface{_sendingRtpParametersByKind;_remoteIceParameters;_remoteIceCandidates;_remoteDtlsParameters;_iceGatherer;_iceTransport;_dtlsTransport;_rtpSenders=new Map;_rtpReceivers=new Map;_nextSendLocalId=0;_cname;_transportReady=!1;static createFactory(){return()=>new vn}constructor(){super()}get name(){return b}close(){u.debug("close()");try{this._iceGatherer.close()}catch{}try{this._iceTransport.stop()}catch{}try{this._dtlsTransport.stop()}catch{}for(const v of this._rtpSenders.values())try{v.stop()}catch{}for(const v of this._rtpReceivers.values())try{v.stop()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){return u.debug("getNativeRtpCapabilities()"),w.getCapabilities()}async getNativeSctpCapabilities(){return u.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:v,iceParameters:l,iceCandidates:y,dtlsParameters:S,sctpParameters:p,iceServers:o,iceTransportPolicy:t,additionalSettings:r,proprietaryConstraints:c,extendedRtpCapabilities:a}){u.debug("run()"),this._sendingRtpParametersByKind={audio:i.getSendingRtpParameters("audio",a),video:i.getSendingRtpParameters("video",a)},this._remoteIceParameters=l,this._remoteIceCandidates=y,this._remoteDtlsParameters=S,this._cname=`CNAME-${s.generateRandomNumber()}`,this.setIceGatherer({iceServers:o,iceTransportPolicy:t}),this.setIceTransport(),this.setDtlsTransport()}async updateIceServers(v){throw new e.UnsupportedError("not supported")}async restartIce(v){if(u.debug("restartIce()"),this._remoteIceParameters=v,!!this._transportReady){u.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,v,"controlling");for(const l of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(l);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:v,encodings:l,codecOptions:y,codec:S}){u.debug("send() [kind:%s, track.id:%s]",v.kind,v.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),u.debug("send() | calling new RTCRtpSender()");const p=new RTCRtpSender(v,this._dtlsTransport),o=s.clone(this._sendingRtpParametersByKind[v.kind]);o.codecs=i.reduceCodecs(o.codecs,S);const t=o.codecs.some(a=>/.+\/rtx$/i.test(a.mimeType));l||(l=[{}]);for(const a of l)a.ssrc=s.generateRandomNumber(),t&&(a.rtx={ssrc:s.generateRandomNumber()});o.encodings=l,o.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const r=w.mangleRtpParameters(o);u.debug("send() | calling rtpSender.send() [params:%o]",r),await p.send(r);const c=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(c,p),{localId:c,rtpParameters:o,rtpSender:p}}async stopSending(v){u.debug("stopSending() [localId:%s]",v);const l=this._rtpSenders.get(v);if(!l)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(v);try{u.debug("stopSending() | calling rtpSender.stop()"),l.stop()}catch(y){throw u.warn("stopSending() | rtpSender.stop() failed:%o",y),y}}async pauseSending(v){}async resumeSending(v){}async replaceTrack(v,l){l?u.debug("replaceTrack() [localId:%s, track.id:%s]",v,l.id):u.debug("replaceTrack() [localId:%s, no track]",v);const y=this._rtpSenders.get(v);if(!y)throw new Error("RTCRtpSender not found");y.setTrack(l)}async setMaxSpatialLayer(v,l){u.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,l);const y=this._rtpSenders.get(v);if(!y)throw new Error("RTCRtpSender not found");const S=y.getParameters();S.encodings.forEach((p,o)=>{o<=l?p.active=!0:p.active=!1}),await y.setParameters(S)}async setRtpEncodingParameters(v,l){u.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,l);const y=this._rtpSenders.get(v);if(!y)throw new Error("RTCRtpSender not found");const S=y.getParameters();S.encodings.forEach((p,o)=>{S.encodings[o]={...p,...l}}),await y.setParameters(S)}async getSenderStats(v){const l=this._rtpSenders.get(v);if(!l)throw new Error("RTCRtpSender not found");return l.getStats()}async sendDataChannel(v){throw new e.UnsupportedError("not implemented")}async receive(v){const l=[];for(const y of v){const{trackId:S,kind:p}=y;u.debug("receive() [trackId:%s, kind:%s]",S,p)}this._transportReady||await this.setupTransport({localDtlsRole:"server"});for(const y of v){const{trackId:S,kind:p,rtpParameters:o}=y;u.debug("receive() | calling new RTCRtpReceiver()");const t=new RTCRtpReceiver(this._dtlsTransport,p);t.addEventListener("error",a=>{u.error('rtpReceiver "error" event [event:%o]',a)});const r=w.mangleRtpParameters(o);u.debug("receive() | calling rtpReceiver.receive() [params:%o]",r),await t.receive(r);const c=S;this._rtpReceivers.set(c,t),l.push({localId:c,track:t.track,rtpReceiver:t})}return l}async stopReceiving(v){for(const l of v){u.debug("stopReceiving() [localId:%s]",l);const y=this._rtpReceivers.get(l);if(!y)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(l);try{u.debug("stopReceiving() | calling rtpReceiver.stop()"),y.stop()}catch(S){u.warn("stopReceiving() | rtpReceiver.stop() failed:%o",S)}}}async pauseReceiving(v){}async resumeReceiving(v){}async getReceiverStats(v){const l=this._rtpReceivers.get(v);if(!l)throw new Error("RTCRtpReceiver not found");return l.getStats()}async receiveDataChannel(v){throw new e.UnsupportedError("not implemented")}setIceGatherer({iceServers:v,iceTransportPolicy:l}){const y=new RTCIceGatherer({iceServers:v??[],gatherPolicy:l??"all"});y.addEventListener("error",S=>{u.error('iceGatherer "error" event [event:%o]',S)});try{y.gather()}catch(S){u.debug("setIceGatherer() | iceGatherer.gather() failed: %s",S.toString())}this._iceGatherer=y}setIceTransport(){const v=new RTCIceTransport(this._iceGatherer);v.addEventListener("statechange",()=>{switch(v.state){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),v.addEventListener("icestatechange",()=>{switch(v.state){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),v.addEventListener("candidatepairchange",l=>{u.debug('iceTransport "candidatepairchange" event [pair:%o]',l.pair)}),this._iceTransport=v}setDtlsTransport(){const v=new RTCDtlsTransport(this._iceTransport);v.addEventListener("statechange",()=>{u.debug('dtlsTransport "statechange" event [state:%s]',v.state)}),v.addEventListener("dtlsstatechange",()=>{u.debug('dtlsTransport "dtlsstatechange" event [state:%s]',v.state),v.state==="closed"&&this.emit("@connectionstatechange","closed")}),v.addEventListener("error",l=>{u.error('dtlsTransport "error" event [event:%o]',l)}),this._dtlsTransport=v}async setupTransport({localDtlsRole:v}){u.debug("setupTransport()");const l=this._dtlsTransport.getLocalParameters();l.role=v,await new Promise((y,S)=>{this.safeEmit("@connect",{dtlsParameters:l},y,S)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const y of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(y);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(y=>y.algorithm==="sha-256"||y.algorithm==="sha-384"||y.algorithm==="sha-512"),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}};return Dt.Edge11=C,Dt}var Pt={},vi;function ba(){if(vi)return Pt;vi=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.ReactNativeUnifiedPlan=void 0;const n=se(),e=Q(),s=Y(),i=Z(),w=le(),m=je(),u=gr(),b=J(),C=ie(),T=he(),v=Ee(),l=new e.Logger("ReactNativeUnifiedPlan"),y="ReactNativeUnifiedPlan",S={OS:1024,MIS:1024};let p=class yn extends C.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new yn}constructor(){super()}get name(){return y}close(){if(l.debug("close()"),!this._closed){if(this._closed=!0,this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");const r=await t.createOffer();try{t.close()}catch{}const c=n.parse(r.sdp),a=w.extractRtpCapabilities({sdpObject:c});return u.addNackSupportForOpus(a),a}catch(r){try{t.close()}catch{}throw r}}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:S}}run({direction:t,iceParameters:r,iceCandidates:c,dtlsParameters:a,sctpParameters:d,iceServers:h,iceTransportPolicy:g,additionalSettings:_,proprietaryConstraints:R,extendedRtpCapabilities:f}){this.assertNotClosed(),l.debug("run()"),this._direction=t,this._remoteSdp=new T.RemoteSdp({iceParameters:r,iceCandidates:c,dtlsParameters:a,sctpParameters:d}),this._sendingRtpParametersByKind={audio:i.getSendingRtpParameters("audio",f),video:i.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:i.getSendingRemoteRtpParameters("audio",f),video:i.getSendingRemoteRtpParameters("video",f)},a.role&&a.role!=="auto"&&(this._forcedLocalDtlsRole=a.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:h??[],iceTransportPolicy:g??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",..._},R),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",E=>{this.emit("@icecandidateerror",E)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(l.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(t){this.assertNotClosed(),l.debug("updateIceServers()");const r=this._pc.getConfiguration();r.iceServers=t,this._pc.setConfiguration(r)}async restartIce(t){if(this.assertNotClosed(),l.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const c={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:t,encodings:r,codecOptions:c,codec:a,onRtpSender:d}){this.assertNotClosed(),this.assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),r&&r.length>1&&r.forEach((L,O)=>{L.rid=`r${O}`});const h=s.clone(this._sendingRtpParametersByKind[t.kind]);h.codecs=i.reduceCodecs(h.codecs,a);const g=s.clone(this._sendingRemoteRtpParametersByKind[t.kind]);g.codecs=i.reduceCodecs(g.codecs,a);const _=this._remoteSdp.getNextMediaSectionIdx(),R=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r});d&&d(R.sender);let f=await this._pc.createOffer(),E=n.parse(f.sdp);E.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let P;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:E});let x=!1;const D=(0,v.parse)((r??[{}])[0].scalabilityMode);r&&r.length===1&&D.spatialLayers>1&&h.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(l.debug("send() | enabling legacy simulcast for VP9 SVC"),x=!0,E=n.parse(f.sdp),P=E.media[_.idx],m.addLegacySimulcast({offerMediaObject:P,numStreams:D.spatialLayers}),f={type:"offer",sdp:n.write(E)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);let k=R.mid??void 0;if(k||l.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),h.mid=k,E=n.parse(this._pc.localDescription.sdp),P=E.media[_.idx],h.rtcp.cname=w.getCname({offerMediaObject:P}),!r)h.encodings=m.getRtpEncodings({offerMediaObject:P});else if(r.length===1){let L=m.getRtpEncodings({offerMediaObject:P});Object.assign(L[0],r[0]),x&&(L=[L[0]]),h.encodings=L}else h.encodings=r;if(h.encodings.length>1&&(h.codecs[0].mimeType.toLowerCase()==="video/vp8"||h.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const L of h.encodings)L.scalabilityMode?L.scalabilityMode=`L1T${D.temporalLayers}`:L.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:P,reuseMid:_.reuseMid,offerRtpParameters:h,answerRtpParameters:g,codecOptions:c});const I={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",I),await this._pc.setRemoteDescription(I),k||(k=R.mid,h.mid=k),this._mapMidTransceiver.set(k,R),{localId:k,rtpParameters:h,rtpSender:R.sender}}async stopSending(t){if(this.assertSendDirection(),this._closed)return;l.debug("stopSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch{}const a=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d),this._mapMidTransceiver.delete(t)}async pauseSending(t){this.assertNotClosed(),this.assertSendDirection(),l.debug("pauseSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(t);const c=await this._pc.createOffer();l.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async resumeSending(t){this.assertNotClosed(),this.assertSendDirection(),l.debug("resumeSending() [localId:%s]",t);const r=this._mapMidTransceiver.get(t);if(this._remoteSdp.resumeSendingMediaSection(t),!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly";const c=await this._pc.createOffer();l.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(t,r){this.assertNotClosed(),this.assertSendDirection(),r?l.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):l.debug("replaceTrack() [localId:%s, no track]",t);const c=this._mapMidTransceiver.get(t);if(!c)throw new Error("associated RTCRtpTransceiver not found");await c.sender.replaceTrack(r)}async setMaxSpatialLayer(t,r){this.assertNotClosed(),this.assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r);const c=this._mapMidTransceiver.get(t);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((g,_)=>{_<=r?g.active=!0:g.active=!1}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const d=await this._pc.createOffer();l.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const h={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async setRtpEncodingParameters(t,r){this.assertNotClosed(),this.assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r);const c=this._mapMidTransceiver.get(t);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((g,_)=>{a.encodings[_]={...g,...r}}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const d=await this._pc.createOffer();l.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const h={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h)}async getSenderStats(t){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:r,maxRetransmits:c,label:a,protocol:d}){this.assertNotClosed(),this.assertSendDirection();const h={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:r,maxRetransmits:c,protocol:d};l.debug("sendDataChannel() [options:%o]",h);const g=this._pc.createDataChannel(a,h);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%S.MIS,!this._hasDataChannelMediaSection){const R=await this._pc.createOffer(),f=n.parse(R.sdp),E=f.media.find(x=>x.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f}),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",R),await this._pc.setLocalDescription(R),this._remoteSdp.sendSctpAssociation({offerMediaObject:E});const P={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P),this._hasDataChannelMediaSection=!0}const _={streamId:h.id,ordered:h.ordered,maxPacketLifeTime:h.maxPacketLifeTime,maxRetransmits:h.maxRetransmits};return{dataChannel:g,sctpStreamParameters:_}}async receive(t){this.assertNotClosed(),this.assertRecvDirection();const r=[],c=new Map;for(const g of t){const{trackId:_,kind:R,rtpParameters:f,streamId:E}=g;l.debug("receive() [trackId:%s, kind:%s]",_,R);const P=f.mid??String(this._mapMidTransceiver.size);c.set(_,P),this._remoteSdp.receive({mid:P,kind:R,offerRtpParameters:f,streamId:E??f.rtcp.cname,trackId:_})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);for(const g of t){const{trackId:_,onRtpReceiver:R}=g;if(R){const f=c.get(_),E=this._pc.getTransceivers().find(P=>P.mid===f);if(!E)throw new Error("transceiver not found");R(E.receiver)}}let d=await this._pc.createAnswer();const h=n.parse(d.sdp);for(const g of t){const{trackId:_,rtpParameters:R}=g,f=c.get(_),E=h.media.find(P=>String(P.mid)===f);w.applyCodecParameters({offerRtpParameters:R,answerMediaObject:E})}d={type:"answer",sdp:n.write(h)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const g of t){const{trackId:_}=g,R=c.get(_),f=this._pc.getTransceivers().find(E=>E.mid===R);if(f)this._mapMidTransceiver.set(R,f),r.push({localId:R,track:f.receiver.track,rtpReceiver:f.receiver});else throw new Error("new RTCRtpTransceiver not found")}return r}async stopReceiving(t){if(this.assertRecvDirection(),this._closed)return;for(const a of t){l.debug("stopReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(d.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const a of t)this._mapMidTransceiver.delete(a)}async pauseReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){l.debug("pauseReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="inactive",this._remoteSdp.pauseMediaSection(a)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async resumeReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){l.debug("resumeReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(a)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const c=await this._pc.createAnswer();l.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async getReceiverStats(t){this.assertNotClosed(),this.assertRecvDirection();const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:r,protocol:c}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:a,ordered:d,maxPacketLifeTime:h,maxRetransmits:g}=t,_={negotiated:!0,id:a,ordered:d,maxPacketLifeTime:h,maxRetransmits:g,protocol:c};l.debug("receiveDataChannel() [options:%o]",_);const R=this._pc.createDataChannel(r,_);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const f={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),await this._pc.setRemoteDescription(f);const E=await this._pc.createAnswer();if(!this._transportReady){const P=n.parse(E.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",E),await this._pc.setLocalDescription(E),this._hasDataChannelMediaSection=!0}return{dataChannel:R}}async setupTransport({localDtlsRole:t,localSdpObject:r}){r||(r=n.parse(this._pc.localDescription.sdp));const c=w.extractDtlsParameters({sdpObject:r});c.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((a,d)=>{this.safeEmit("@connect",{dtlsParameters:c},a,d)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new b.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Pt.ReactNativeUnifiedPlan=p,Pt}var kt={},yi;function Sa(){if(yi)return kt;yi=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.ReactNative=void 0;const n=se(),e=Q(),s=J(),i=Y(),w=Z(),m=le(),u=_r(),b=ie(),C=he(),T=new e.Logger("ReactNative"),v="ReactNative",l={OS:1024,MIS:1024};let y=class bn extends b.HandlerInterface{_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_sendStream=new MediaStream;_mapSendLocalIdTrack=new Map;_nextSendLocalId=0;_mapRecvLocalIdInfo=new Map;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new bn}constructor(){super()}get name(){return v}close(){if(T.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){T.debug("getNativeRtpCapabilities()");const p=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const o=await p.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{p.close()}catch{}const t=n.parse(o.sdp);return m.extractRtpCapabilities({sdpObject:t})}catch(o){try{p.close()}catch{}throw o}}async getNativeSctpCapabilities(){return T.debug("getNativeSctpCapabilities()"),{numStreams:l}}run({direction:p,iceParameters:o,iceCandidates:t,dtlsParameters:r,sctpParameters:c,iceServers:a,iceTransportPolicy:d,additionalSettings:h,proprietaryConstraints:g,extendedRtpCapabilities:_}){T.debug("run()"),this._direction=p,this._remoteSdp=new C.RemoteSdp({iceParameters:o,iceCandidates:t,dtlsParameters:r,sctpParameters:c,planB:!0}),this._sendingRtpParametersByKind={audio:w.getSendingRtpParameters("audio",_),video:w.getSendingRtpParameters("video",_)},this._sendingRemoteRtpParametersByKind={audio:w.getSendingRemoteRtpParameters("audio",_),video:w.getSendingRemoteRtpParameters("video",_)},r.role&&r.role!=="auto"&&(this._forcedLocalDtlsRole=r.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...h},g),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",R=>{this.emit("@icecandidateerror",R)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(T.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(p){T.debug("updateIceServers()");const o=this._pc.getConfiguration();o.iceServers=p,this._pc.setConfiguration(o)}async restartIce(p){if(T.debug("restartIce()"),this._remoteSdp.updateIceParameters(p),!!this._transportReady)if(this._direction==="send"){const o=await this._pc.createOffer({iceRestart:!0});T.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const t={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const o={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);const t=await this._pc.createAnswer();T.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:p,encodings:o,codecOptions:t,codec:r}){this.assertSendDirection(),T.debug("send() [kind:%s, track.id:%s]",p.kind,p.id),r&&T.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(p),this._pc.addStream(this._sendStream);let c=await this._pc.createOffer(),a=n.parse(c.sdp);a.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let d;const h=i.clone(this._sendingRtpParametersByKind[p.kind]);h.codecs=w.reduceCodecs(h.codecs);const g=i.clone(this._sendingRemoteRtpParametersByKind[p.kind]);if(g.codecs=w.reduceCodecs(g.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),p.kind==="video"&&o&&o.length>1&&(T.debug("send() | enabling simulcast"),a=n.parse(c.sdp),d=a.media.find(f=>f.type==="video"),u.addLegacySimulcast({offerMediaObject:d,track:p,numStreams:o.length}),c={type:"offer",sdp:n.write(a)}),T.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),a=n.parse(this._pc.localDescription.sdp),d=a.media.find(f=>f.type===p.kind),h.rtcp.cname=m.getCname({offerMediaObject:d}),h.encodings=u.getRtpEncodings({offerMediaObject:d,track:p}),o)for(let f=0;f<h.encodings.length;++f)o[f]&&Object.assign(h.encodings[f],o[f]);if(h.encodings.length>1&&(h.codecs[0].mimeType.toLowerCase()==="video/vp8"||h.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const f of h.encodings)f.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,offerRtpParameters:h,answerRtpParameters:g,codecOptions:t});const _={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("send() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_);const R=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(R,p),{localId:R,rtpParameters:h}}async stopSending(p){this.assertSendDirection(),T.debug("stopSending() [localId:%s]",p);const o=this._mapSendLocalIdTrack.get(p);if(!o)throw new Error("track not found");this._mapSendLocalIdTrack.delete(p),this._sendStream.removeTrack(o),this._pc.addStream(this._sendStream);const t=await this._pc.createOffer();T.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t);try{await this._pc.setLocalDescription(t)}catch(c){if(this._sendStream.getTracks().length===0){T.warn("stopSending() | ignoring expected error due no sending tracks: %s",c.toString());return}throw c}if(this._pc.signalingState==="stable")return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async pauseSending(p){}async resumeSending(p){}async replaceTrack(p,o){throw new s.UnsupportedError("not implemented")}async setMaxSpatialLayer(p,o){throw new s.UnsupportedError("not implemented")}async setRtpEncodingParameters(p,o){throw new s.UnsupportedError("not implemented")}async getSenderStats(p){throw new s.UnsupportedError("not implemented")}async sendDataChannel({ordered:p,maxPacketLifeTime:o,maxRetransmits:t,label:r,protocol:c}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:p,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:t,protocol:c};T.debug("sendDataChannel() [options:%o]",a);const d=this._pc.createDataChannel(r,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%l.MIS,!this._hasDataChannelMediaSection){const g=await this._pc.createOffer(),_=n.parse(g.sdp),R=_.media.find(E=>E.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:_}),T.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g),this._remoteSdp.sendSctpAssociation({offerMediaObject:R});const f={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f),this._hasDataChannelMediaSection=!0}const h={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:d,sctpStreamParameters:h}}async receive(p){this.assertRecvDirection();const o=[],t=new Map;for(const d of p){const{trackId:h,kind:g,rtpParameters:_}=d;T.debug("receive() [trackId:%s, kind:%s]",h,g);const R=g;let f=d.streamId??_.rtcp.cname;T.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),f+=`-hack-${i.generateRandomNumber()}`,t.set(h,f),this._remoteSdp.receive({mid:R,kind:g,offerRtpParameters:_,streamId:f,trackId:h})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let c=await this._pc.createAnswer();const a=n.parse(c.sdp);for(const d of p){const{kind:h,rtpParameters:g}=d,_=h,R=a.media.find(f=>String(f.mid)===_);m.applyCodecParameters({offerRtpParameters:g,answerMediaObject:R})}c={type:"answer",sdp:n.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),T.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const d of p){const{kind:h,trackId:g,rtpParameters:_}=d,R=g,f=h,E=t.get(g),x=this._pc.getRemoteStreams().find(D=>D.id===E).getTrackById(R);if(!x)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(R,{mid:f,rtpParameters:_}),o.push({localId:R,track:x})}return o}async stopReceiving(p){this.assertRecvDirection();for(const r of p){T.debug("stopReceiving() [localId:%s]",r);const{mid:c,rtpParameters:a}=this._mapRecvLocalIdInfo.get(r)??{};this._mapRecvLocalIdInfo.delete(r),this._remoteSdp.planBStopReceiving({mid:c,offerRtpParameters:a})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);const t=await this._pc.createAnswer();T.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async pauseReceiving(p){}async resumeReceiving(p){}async getReceiverStats(p){throw new s.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:p,label:o,protocol:t}){this.assertRecvDirection();const{streamId:r,ordered:c,maxPacketLifeTime:a,maxRetransmits:d}=p,h={negotiated:!0,id:r,ordered:c,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:d,protocol:t};T.debug("receiveDataChannel() [options:%o]",h);const g=this._pc.createDataChannel(o,h);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const _={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const R=await this._pc.createAnswer();if(!this._transportReady){const f=n.parse(R.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f})}T.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",R),await this._pc.setLocalDescription(R),this._hasDataChannelMediaSection=!0}return{dataChannel:g}}async setupTransport({localDtlsRole:p,localSdpObject:o}){o||(o=n.parse(this._pc.localDescription.sdp));const t=m.extractDtlsParameters({sdpObject:o});t.role=p,this._remoteSdp.updateDtlsRole(p==="client"?"server":"client"),await new Promise((r,c)=>{this.safeEmit("@connect",{dtlsParameters:t},r,c)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return kt.ReactNative=y,kt}var bi;function Rn(){if(bi)return Ie;bi=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.Device=void 0,Ie.detectDeviceAsync=d,Ie.detectDevice=h;const n=ea(),e=Q(),s=De(),i=J(),w=Y(),m=Z(),u=dn(),b=pa(),C=la(),T=ha(),v=ua(),l=fa(),y=ma(),S=ga(),p=_a(),o=wa(),t=ya(),r=ba(),c=Sa(),a=new e.Logger("Device");async function d(R){a.debug("detectDeviceAsync() [userAgent:%s]",R),!R&&typeof navigator=="object"&&(R=navigator.userAgent);const f=await(0,n.UAParser)(R).withFeatureCheck();return _(f)}function h(R){a.debug("detectDevice() [userAgent:%s]",R),!R&&typeof navigator=="object"&&(R=navigator.userAgent);const f=(0,n.UAParser)(R);return _(f)}let g=class Sn{_handlerFactory;_handlerName;_loaded=!1;_extendedRtpCapabilities;_recvRtpCapabilities;_canProduceByKind;_sctpCapabilities;_observer=new s.EnhancedEventEmitter;static async factory({handlerName:f,handlerFactory:E}={}){if(a.debug("factory()"),f&&E)throw new TypeError("just one of handlerName or handlerInterface can be given");if(!f&&!E&&(f=await d(),!f))throw new i.UnsupportedError("device not supported");return new Sn({handlerName:f,handlerFactory:E})}constructor({handlerName:f,handlerFactory:E}={}){if(a.debug("constructor()"),f&&E)throw new TypeError("just one of handlerName or handlerInterface can be given");if(E)this._handlerFactory=E;else{if(f)a.debug("constructor() | handler given: %s",f);else if(f=h(),f)a.debug("constructor() | detected handler: %s",f);else throw new i.UnsupportedError("device not supported");switch(f){case"Chrome111":{this._handlerFactory=b.Chrome111.createFactory();break}case"Chrome74":{this._handlerFactory=C.Chrome74.createFactory();break}case"Chrome70":{this._handlerFactory=T.Chrome70.createFactory();break}case"Chrome67":{this._handlerFactory=v.Chrome67.createFactory();break}case"Chrome55":{this._handlerFactory=l.Chrome55.createFactory();break}case"Firefox120":{this._handlerFactory=y.Firefox120.createFactory();break}case"Firefox60":{this._handlerFactory=S.Firefox60.createFactory();break}case"Safari12":{this._handlerFactory=p.Safari12.createFactory();break}case"Safari11":{this._handlerFactory=o.Safari11.createFactory();break}case"Edge11":{this._handlerFactory=t.Edge11.createFactory();break}case"ReactNativeUnifiedPlan":{this._handlerFactory=r.ReactNativeUnifiedPlan.createFactory();break}case"ReactNative":{this._handlerFactory=c.ReactNative.createFactory();break}default:throw new TypeError(`unknown handlerName "${f}"`)}}const P=this._handlerFactory();this._handlerName=P.name,P.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new i.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new i.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:f,preferLocalCodecsOrder:E=!1}){a.debug("load() [routerRtpCapabilities:%o]",f);let P;try{if(this._loaded)throw new i.InvalidStateError("already loaded");const x=w.clone(f);m.validateRtpCapabilities(x),P=this._handlerFactory();const D=await P.getNativeRtpCapabilities();a.debug("load() | got native RTP capabilities:%o",D);const k=w.clone(D);m.validateRtpCapabilities(k),this._extendedRtpCapabilities=m.getExtendedRtpCapabilities(k,x,E),a.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=m.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=m.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=m.getRecvRtpCapabilities(this._extendedRtpCapabilities),m.validateRtpCapabilities(this._recvRtpCapabilities),a.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await P.getNativeSctpCapabilities(),a.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),m.validateSctpCapabilities(this._sctpCapabilities),a.debug("load() succeeded"),this._loaded=!0,P.close()}catch(x){throw P&&P.close(),x}}canProduce(f){if(this._loaded){if(f!=="audio"&&f!=="video")throw new TypeError(`invalid kind "${f}"`)}else throw new i.InvalidStateError("not loaded");return this._canProduceByKind[f]}createSendTransport({id:f,iceParameters:E,iceCandidates:P,dtlsParameters:x,sctpParameters:D,iceServers:k,iceTransportPolicy:I,additionalSettings:L,proprietaryConstraints:O,appData:F}){return a.debug("createSendTransport()"),this.createTransport({direction:"send",id:f,iceParameters:E,iceCandidates:P,dtlsParameters:x,sctpParameters:D,iceServers:k,iceTransportPolicy:I,additionalSettings:L,proprietaryConstraints:O,appData:F})}createRecvTransport({id:f,iceParameters:E,iceCandidates:P,dtlsParameters:x,sctpParameters:D,iceServers:k,iceTransportPolicy:I,additionalSettings:L,proprietaryConstraints:O,appData:F}){return a.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:f,iceParameters:E,iceCandidates:P,dtlsParameters:x,sctpParameters:D,iceServers:k,iceTransportPolicy:I,additionalSettings:L,proprietaryConstraints:O,appData:F})}createTransport({direction:f,id:E,iceParameters:P,iceCandidates:x,dtlsParameters:D,sctpParameters:k,iceServers:I,iceTransportPolicy:L,additionalSettings:O,proprietaryConstraints:F,appData:q}){if(this._loaded){if(typeof E!="string")throw new TypeError("missing id");if(typeof P!="object")throw new TypeError("missing iceParameters");if(Array.isArray(x)){if(typeof D!="object")throw new TypeError("missing dtlsParameters");if(k&&typeof k!="object")throw new TypeError("wrong sctpParameters");if(q&&typeof q!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new i.InvalidStateError("not loaded");const V=new u.Transport({direction:f,id:E,iceParameters:P,iceCandidates:x,dtlsParameters:D,sctpParameters:k,iceServers:I,iceTransportPolicy:L,additionalSettings:O,proprietaryConstraints:F,appData:q,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",V),V}};Ie.Device=g;function _(R){if(typeof navigator=="object"&&navigator.product==="ReactNative"){if(a.debug("detectDeviceImpl() | React-Native detected"),typeof RTCPeerConnection>"u"){a.warn("detectDeviceImpl() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?");return}return typeof RTCRtpTransceiver<"u"?(a.debug("detectDeviceImpl() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(a.debug("detectDeviceImpl() | ReactNative PlanB handler chosen"),"ReactNative")}else{a.debug("detectDeviceImpl() | browser detected [userAgent:%s, parsed:%o]",R.ua,R);const f=R.browser,E=f.name?.toLowerCase(),P=parseInt(f.major??"0"),D=R.engine.name?.toLowerCase(),k=R.os,I=k.name?.toLowerCase(),L=parseFloat(k.version??"0"),F=R.device.model?.toLowerCase(),q=I==="ios"||F==="ipad",V=E&&["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(E),ee=E&&["firefox","mobile firefox","mobile focus"].includes(E),ke=E&&["safari","mobile safari"].includes(E),ye=E&&["edge"].includes(E);if((V||ye)&&!q&&P>=111)return"Chrome111";if(V&&!q&&P>=74||ye&&!q&&P>=88)return"Chrome74";if(V&&!q&&P>=70)return"Chrome70";if(V&&!q&&P>=67)return"Chrome67";if(V&&!q&&P>=55)return"Chrome55";if(ee&&!q&&P>=120)return"Firefox120";if(ee&&!q&&P>=60)return"Firefox60";if(ee&&q&&L>=14.3)return"Safari12";if(ke&&P>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(ke&&P>=11)return"Safari11";if(ye&&!q&&P>=11&&P<=18)return"Edge11";if(D==="webkit"&&q&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(D==="blink"){const oe=R.ua.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(oe){const Fe=Number(oe[1]);return Fe>=111?"Chrome111":Fe>=74?"Chrome74":Fe>=70?"Chrome70":Fe>=67?"Chrome67":"Chrome55"}else return"Chrome111"}else{a.warn("detectDeviceImpl() | browser not supported [name:%s, version:%s]",E,P);return}}}return Ie}var zr={},Si;function Ra(){return Si||(Si=1,Object.defineProperty(zr,"__esModule",{value:!0})),zr}var Hr={},Ri;function Ca(){return Ri||(Ri=1,Object.defineProperty(Hr,"__esModule",{value:!0})),Hr}var Ci;function Ta(){return Ci||(Ci=1,function(n){var e=Le&&Le.__createBinding||(Object.create?function(i,w,m,u){u===void 0&&(u=m);var b=Object.getOwnPropertyDescriptor(w,m);(!b||("get"in b?!w.__esModule:b.writable||b.configurable))&&(b={enumerable:!0,get:function(){return w[m]}}),Object.defineProperty(i,u,b)}:function(i,w,m,u){u===void 0&&(u=m),i[u]=w[m]}),s=Le&&Le.__exportStar||function(i,w){for(var m in i)m!=="default"&&!Object.prototype.hasOwnProperty.call(w,m)&&e(w,i,m)};Object.defineProperty(n,"__esModule",{value:!0}),s(Rn(),n),s(dn(),n),s(nn(),n),s(an(),n),s(on(),n),s(cn(),n),s(Ra(),n),s(Ca(),n),s(ie(),n),s(J(),n)}(Le)),Le}var xt={},Lt={},Vr={},Gt={},Ti;function Da(){return Ti||(Ti=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.default="ffffffff-ffff-ffff-ffff-ffffffffffff"),Gt}var Qt={},Di;function Ea(){return Di||(Di=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.default="00000000-0000-0000-0000-000000000000"),Qt}var Wt={},Yt={},Xt={},Ei;function Pa(){return Ei||(Ei=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i),Xt}var Pi;function wr(){if(Pi)return Yt;Pi=1,Object.defineProperty(Yt,"__esModule",{value:!0});const n=Pa();function e(s){return typeof s=="string"&&n.default.test(s)}return Yt.default=e,Yt}var ki;function vr(){if(ki)return Wt;ki=1,Object.defineProperty(Wt,"__esModule",{value:!0});const n=wr();function e(s){if(!(0,n.default)(s))throw TypeError("Invalid UUID");let i;return Uint8Array.of((i=parseInt(s.slice(0,8),16))>>>24,i>>>16&255,i>>>8&255,i&255,(i=parseInt(s.slice(9,13),16))>>>8,i&255,(i=parseInt(s.slice(14,18),16))>>>8,i&255,(i=parseInt(s.slice(19,23),16))>>>8,i&255,(i=parseInt(s.slice(24,36),16))/1099511627776&255,i/4294967296&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255)}return Wt.default=e,Wt}var Ve={},xi;function Pe(){if(xi)return Ve;xi=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.unsafeStringify=void 0;const n=wr(),e=[];for(let w=0;w<256;++w)e.push((w+256).toString(16).slice(1));function s(w,m=0){return(e[w[m+0]]+e[w[m+1]]+e[w[m+2]]+e[w[m+3]]+"-"+e[w[m+4]]+e[w[m+5]]+"-"+e[w[m+6]]+e[w[m+7]]+"-"+e[w[m+8]]+e[w[m+9]]+"-"+e[w[m+10]]+e[w[m+11]]+e[w[m+12]]+e[w[m+13]]+e[w[m+14]]+e[w[m+15]]).toLowerCase()}Ve.unsafeStringify=s;function i(w,m=0){const u=s(w,m);if(!(0,n.default)(u))throw TypeError("Stringified UUID is invalid");return u}return Ve.default=i,Ve}var Ke={},Jt={},Li;function is(){if(Li)return Jt;Li=1,Object.defineProperty(Jt,"__esModule",{value:!0});let n;const e=new Uint8Array(16);function s(){if(!n){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(e)}return Jt.default=s,Jt}var Ii;function Cn(){if(Ii)return Ke;Ii=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.updateV1State=void 0;const n=is(),e=Pe(),s={};function i(u,b,C){let T;const v=u?._v6??!1;if(u){const l=Object.keys(u);l.length===1&&l[0]==="_v6"&&(u=void 0)}if(u)T=m(u.random??u.rng?.()??(0,n.default)(),u.msecs,u.nsecs,u.clockseq,u.node,b,C);else{const l=Date.now(),y=(0,n.default)();w(s,l,y),T=m(y,s.msecs,s.nsecs,v?void 0:s.clockseq,v?void 0:s.node,b,C)}return b??(0,e.unsafeStringify)(T)}function w(u,b,C){return u.msecs??=-1/0,u.nsecs??=0,b===u.msecs?(u.nsecs++,u.nsecs>=1e4&&(u.node=void 0,u.nsecs=0)):b>u.msecs?u.nsecs=0:b<u.msecs&&(u.node=void 0),u.node||(u.node=C.slice(10,16),u.node[0]|=1,u.clockseq=(C[8]<<8|C[9])&16383),u.msecs=b,u}Ke.updateV1State=w;function m(u,b,C,T,v,l,y=0){if(u.length<16)throw new Error("Random bytes length must be >= 16");if(!l)l=new Uint8Array(16),y=0;else if(y<0||y+16>l.length)throw new RangeError(`UUID byte range ${y}:${y+15} is out of buffer bounds`);b??=Date.now(),C??=0,T??=(u[8]<<8|u[9])&16383,v??=u.slice(10,16),b+=122192928e5;const S=((b&268435455)*1e4+C)%4294967296;l[y++]=S>>>24&255,l[y++]=S>>>16&255,l[y++]=S>>>8&255,l[y++]=S&255;const p=b/4294967296*1e4&268435455;l[y++]=p>>>8&255,l[y++]=p&255,l[y++]=p>>>24&15|16,l[y++]=p>>>16&255,l[y++]=T>>>8|128,l[y++]=T&255;for(let o=0;o<6;++o)l[y++]=v[o];return l}return Ke.default=i,Ke}var Zt={},Mi;function Tn(){if(Mi)return Zt;Mi=1,Object.defineProperty(Zt,"__esModule",{value:!0});const n=vr(),e=Pe();function s(w){const m=typeof w=="string"?(0,n.default)(w):w,u=i(m);return typeof w=="string"?(0,e.unsafeStringify)(u):u}Zt.default=s;function i(w){return Uint8Array.of((w[6]&15)<<4|w[7]>>4&15,(w[7]&15)<<4|(w[4]&240)>>4,(w[4]&15)<<4|(w[5]&240)>>4,(w[5]&15)<<4|(w[0]&240)>>4,(w[0]&15)<<4|(w[1]&240)>>4,(w[1]&15)<<4|(w[2]&240)>>4,96|w[2]&15,w[3],w[8],w[9],w[10],w[11],w[12],w[13],w[14],w[15])}return Zt}var Kr={},er={},Oi;function ka(){if(Oi)return er;Oi=1,Object.defineProperty(er,"__esModule",{value:!0});function n(y){const S=w(y),p=i(S,y.length*8);return e(p)}function e(y){const S=new Uint8Array(y.length*4);for(let p=0;p<y.length*4;p++)S[p]=y[p>>2]>>>p%4*8&255;return S}function s(y){return(y+64>>>9<<4)+14+1}function i(y,S){const p=new Uint32Array(s(S)).fill(0);p.set(y),p[S>>5]|=128<<S%32,p[p.length-1]=S,y=p;let o=1732584193,t=-271733879,r=-1732584194,c=271733878;for(let a=0;a<y.length;a+=16){const d=o,h=t,g=r,_=c;o=C(o,t,r,c,y[a],7,-680876936),c=C(c,o,t,r,y[a+1],12,-389564586),r=C(r,c,o,t,y[a+2],17,606105819),t=C(t,r,c,o,y[a+3],22,-1044525330),o=C(o,t,r,c,y[a+4],7,-176418897),c=C(c,o,t,r,y[a+5],12,1200080426),r=C(r,c,o,t,y[a+6],17,-1473231341),t=C(t,r,c,o,y[a+7],22,-45705983),o=C(o,t,r,c,y[a+8],7,1770035416),c=C(c,o,t,r,y[a+9],12,-1958414417),r=C(r,c,o,t,y[a+10],17,-42063),t=C(t,r,c,o,y[a+11],22,-1990404162),o=C(o,t,r,c,y[a+12],7,1804603682),c=C(c,o,t,r,y[a+13],12,-40341101),r=C(r,c,o,t,y[a+14],17,-1502002290),t=C(t,r,c,o,y[a+15],22,1236535329),o=T(o,t,r,c,y[a+1],5,-165796510),c=T(c,o,t,r,y[a+6],9,-1069501632),r=T(r,c,o,t,y[a+11],14,643717713),t=T(t,r,c,o,y[a],20,-373897302),o=T(o,t,r,c,y[a+5],5,-701558691),c=T(c,o,t,r,y[a+10],9,38016083),r=T(r,c,o,t,y[a+15],14,-660478335),t=T(t,r,c,o,y[a+4],20,-405537848),o=T(o,t,r,c,y[a+9],5,568446438),c=T(c,o,t,r,y[a+14],9,-1019803690),r=T(r,c,o,t,y[a+3],14,-187363961),t=T(t,r,c,o,y[a+8],20,1163531501),o=T(o,t,r,c,y[a+13],5,-1444681467),c=T(c,o,t,r,y[a+2],9,-51403784),r=T(r,c,o,t,y[a+7],14,1735328473),t=T(t,r,c,o,y[a+12],20,-1926607734),o=v(o,t,r,c,y[a+5],4,-378558),c=v(c,o,t,r,y[a+8],11,-2022574463),r=v(r,c,o,t,y[a+11],16,1839030562),t=v(t,r,c,o,y[a+14],23,-35309556),o=v(o,t,r,c,y[a+1],4,-1530992060),c=v(c,o,t,r,y[a+4],11,1272893353),r=v(r,c,o,t,y[a+7],16,-155497632),t=v(t,r,c,o,y[a+10],23,-1094730640),o=v(o,t,r,c,y[a+13],4,681279174),c=v(c,o,t,r,y[a],11,-358537222),r=v(r,c,o,t,y[a+3],16,-722521979),t=v(t,r,c,o,y[a+6],23,76029189),o=v(o,t,r,c,y[a+9],4,-640364487),c=v(c,o,t,r,y[a+12],11,-421815835),r=v(r,c,o,t,y[a+15],16,530742520),t=v(t,r,c,o,y[a+2],23,-995338651),o=l(o,t,r,c,y[a],6,-198630844),c=l(c,o,t,r,y[a+7],10,1126891415),r=l(r,c,o,t,y[a+14],15,-1416354905),t=l(t,r,c,o,y[a+5],21,-57434055),o=l(o,t,r,c,y[a+12],6,1700485571),c=l(c,o,t,r,y[a+3],10,-1894986606),r=l(r,c,o,t,y[a+10],15,-1051523),t=l(t,r,c,o,y[a+1],21,-2054922799),o=l(o,t,r,c,y[a+8],6,1873313359),c=l(c,o,t,r,y[a+15],10,-30611744),r=l(r,c,o,t,y[a+6],15,-1560198380),t=l(t,r,c,o,y[a+13],21,1309151649),o=l(o,t,r,c,y[a+4],6,-145523070),c=l(c,o,t,r,y[a+11],10,-1120210379),r=l(r,c,o,t,y[a+2],15,718787259),t=l(t,r,c,o,y[a+9],21,-343485551),o=m(o,d),t=m(t,h),r=m(r,g),c=m(c,_)}return Uint32Array.of(o,t,r,c)}function w(y){if(y.length===0)return new Uint32Array;const S=new Uint32Array(s(y.length*8)).fill(0);for(let p=0;p<y.length;p++)S[p>>2]|=(y[p]&255)<<p%4*8;return S}function m(y,S){const p=(y&65535)+(S&65535);return(y>>16)+(S>>16)+(p>>16)<<16|p&65535}function u(y,S){return y<<S|y>>>32-S}function b(y,S,p,o,t,r){return m(u(m(m(S,y),m(o,r)),t),p)}function C(y,S,p,o,t,r,c){return b(S&p|~S&o,y,S,t,r,c)}function T(y,S,p,o,t,r,c){return b(S&o|p&~o,y,S,t,r,c)}function v(y,S,p,o,t,r,c){return b(S^p^o,y,S,t,r,c)}function l(y,S,p,o,t,r,c){return b(p^(S|~o),y,S,t,r,c)}return er.default=n,er}var ue={},Ai;function fr(){if(Ai)return ue;Ai=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.URL=ue.DNS=ue.stringToBytes=void 0;const n=vr(),e=Pe();function s(w){w=unescape(encodeURIComponent(w));const m=new Uint8Array(w.length);for(let u=0;u<w.length;++u)m[u]=w.charCodeAt(u);return m}ue.stringToBytes=s,ue.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",ue.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function i(w,m,u,b,C,T){const v=typeof u=="string"?s(u):u,l=typeof b=="string"?(0,n.default)(b):b;if(typeof b=="string"&&(b=(0,n.default)(b)),b?.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let y=new Uint8Array(16+v.length);if(y.set(l),y.set(v,l.length),y=m(y),y[6]=y[6]&15|w,y[8]=y[8]&63|128,C){T=T||0;for(let S=0;S<16;++S)C[T+S]=y[S];return C}return(0,e.unsafeStringify)(y)}return ue.default=i,ue}var Ni;function xa(){return Ni||(Ni=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.URL=n.DNS=void 0;const e=ka(),s=fr();var i=fr();Object.defineProperty(n,"DNS",{enumerable:!0,get:function(){return i.DNS}}),Object.defineProperty(n,"URL",{enumerable:!0,get:function(){return i.URL}});function w(m,u,b,C){return(0,s.default)(48,e.default,m,u,b,C)}w.DNS=s.DNS,w.URL=s.URL,n.default=w}(Kr)),Kr}var tr={},rr={},ji;function La(){if(ji)return rr;ji=1,Object.defineProperty(rr,"__esModule",{value:!0});const n=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);return rr.default={randomUUID:n},rr}var Fi;function Ia(){if(Fi)return tr;Fi=1,Object.defineProperty(tr,"__esModule",{value:!0});const n=La(),e=is(),s=Pe();function i(w,m,u){if(n.default.randomUUID&&!m&&!w)return n.default.randomUUID();w=w||{};const b=w.random??w.rng?.()??(0,e.default)();if(b.length<16)throw new Error("Random bytes length must be >= 16");if(b[6]=b[6]&15|64,b[8]=b[8]&63|128,m){if(u=u||0,u<0||u+16>m.length)throw new RangeError(`UUID byte range ${u}:${u+15} is out of buffer bounds`);for(let C=0;C<16;++C)m[u+C]=b[C];return m}return(0,s.unsafeStringify)(b)}return tr.default=i,tr}var Gr={},sr={},Bi;function Ma(){if(Bi)return sr;Bi=1,Object.defineProperty(sr,"__esModule",{value:!0});function n(i,w,m,u){switch(i){case 0:return w&m^~w&u;case 1:return w^m^u;case 2:return w&m^w&u^m&u;case 3:return w^m^u}}function e(i,w){return i<<w|i>>>32-w}function s(i){const w=[1518500249,1859775393,2400959708,3395469782],m=[1732584193,4023233417,2562383102,271733878,3285377520],u=new Uint8Array(i.length+1);u.set(i),u[i.length]=128,i=u;const b=i.length/4+2,C=Math.ceil(b/16),T=new Array(C);for(let v=0;v<C;++v){const l=new Uint32Array(16);for(let y=0;y<16;++y)l[y]=i[v*64+y*4]<<24|i[v*64+y*4+1]<<16|i[v*64+y*4+2]<<8|i[v*64+y*4+3];T[v]=l}T[C-1][14]=(i.length-1)*8/Math.pow(2,32),T[C-1][14]=Math.floor(T[C-1][14]),T[C-1][15]=(i.length-1)*8&4294967295;for(let v=0;v<C;++v){const l=new Uint32Array(80);for(let r=0;r<16;++r)l[r]=T[v][r];for(let r=16;r<80;++r)l[r]=e(l[r-3]^l[r-8]^l[r-14]^l[r-16],1);let y=m[0],S=m[1],p=m[2],o=m[3],t=m[4];for(let r=0;r<80;++r){const c=Math.floor(r/20),a=e(y,5)+n(c,S,p,o)+t+w[c]+l[r]>>>0;t=o,o=p,p=e(S,30)>>>0,S=y,y=a}m[0]=m[0]+y>>>0,m[1]=m[1]+S>>>0,m[2]=m[2]+p>>>0,m[3]=m[3]+o>>>0,m[4]=m[4]+t>>>0}return Uint8Array.of(m[0]>>24,m[0]>>16,m[0]>>8,m[0],m[1]>>24,m[1]>>16,m[1]>>8,m[1],m[2]>>24,m[2]>>16,m[2]>>8,m[2],m[3]>>24,m[3]>>16,m[3]>>8,m[3],m[4]>>24,m[4]>>16,m[4]>>8,m[4])}return sr.default=s,sr}var qi;function Oa(){return qi||(qi=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.URL=n.DNS=void 0;const e=Ma(),s=fr();var i=fr();Object.defineProperty(n,"DNS",{enumerable:!0,get:function(){return i.DNS}}),Object.defineProperty(n,"URL",{enumerable:!0,get:function(){return i.URL}});function w(m,u,b,C){return(0,s.default)(80,e.default,m,u,b,C)}w.DNS=s.DNS,w.URL=s.URL,n.default=w}(Gr)),Gr}var ir={},Ui;function Aa(){if(Ui)return ir;Ui=1,Object.defineProperty(ir,"__esModule",{value:!0});const n=Pe(),e=Cn(),s=Tn();function i(w,m,u){w??={},u??=0;let b=(0,e.default)({...w,_v6:!0},new Uint8Array(16));if(b=(0,s.default)(b),m){for(let C=0;C<16;C++)m[u+C]=b[C];return m}return(0,n.unsafeStringify)(b)}return ir.default=i,ir}var nr={},$i;function Na(){if($i)return nr;$i=1,Object.defineProperty(nr,"__esModule",{value:!0});const n=vr(),e=Pe();function s(w){const m=typeof w=="string"?(0,n.default)(w):w,u=i(m);return typeof w=="string"?(0,e.unsafeStringify)(u):u}nr.default=s;function i(w){return Uint8Array.of((w[3]&15)<<4|w[4]>>4&15,(w[4]&15)<<4|(w[5]&240)>>4,(w[5]&15)<<4|w[6]&15,w[7],(w[1]&15)<<4|(w[2]&240)>>4,(w[2]&15)<<4|(w[3]&240)>>4,16|(w[0]&240)>>4,(w[0]&15)<<4|(w[1]&240)>>4,w[8],w[9],w[10],w[11],w[12],w[13],w[14],w[15])}return nr}var Ge={},zi;function ja(){if(zi)return Ge;zi=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.updateV7State=void 0;const n=is(),e=Pe(),s={};function i(u,b,C){let T;if(u)T=m(u.random??u.rng?.()??(0,n.default)(),u.msecs,u.seq,b,C);else{const v=Date.now(),l=(0,n.default)();w(s,v,l),T=m(l,s.msecs,s.seq,b,C)}return b??(0,e.unsafeStringify)(T)}function w(u,b,C){return u.msecs??=-1/0,u.seq??=0,b>u.msecs?(u.seq=C[6]<<23|C[7]<<16|C[8]<<8|C[9],u.msecs=b):(u.seq=u.seq+1|0,u.seq===0&&u.msecs++),u}Ge.updateV7State=w;function m(u,b,C,T,v=0){if(u.length<16)throw new Error("Random bytes length must be >= 16");if(!T)T=new Uint8Array(16),v=0;else if(v<0||v+16>T.length)throw new RangeError(`UUID byte range ${v}:${v+15} is out of buffer bounds`);return b??=Date.now(),C??=u[6]*127<<24|u[7]<<16|u[8]<<8|u[9],T[v++]=b/1099511627776&255,T[v++]=b/4294967296&255,T[v++]=b/16777216&255,T[v++]=b/65536&255,T[v++]=b/256&255,T[v++]=b&255,T[v++]=112|C>>>28&15,T[v++]=C>>>20&255,T[v++]=128|C>>>14&63,T[v++]=C>>>6&255,T[v++]=C<<2&255|u[10]&3,T[v++]=u[11],T[v++]=u[12],T[v++]=u[13],T[v++]=u[14],T[v++]=u[15],T}return Ge.default=i,Ge}var ar={},Hi;function Fa(){if(Hi)return ar;Hi=1,Object.defineProperty(ar,"__esModule",{value:!0});const n=wr();function e(s){if(!(0,n.default)(s))throw TypeError("Invalid UUID");return parseInt(s.slice(14,15),16)}return ar.default=e,ar}var Vi;function Ba(){return Vi||(Vi=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.version=n.validate=n.v7=n.v6ToV1=n.v6=n.v5=n.v4=n.v3=n.v1ToV6=n.v1=n.stringify=n.parse=n.NIL=n.MAX=void 0;var e=Da();Object.defineProperty(n,"MAX",{enumerable:!0,get:function(){return e.default}});var s=Ea();Object.defineProperty(n,"NIL",{enumerable:!0,get:function(){return s.default}});var i=vr();Object.defineProperty(n,"parse",{enumerable:!0,get:function(){return i.default}});var w=Pe();Object.defineProperty(n,"stringify",{enumerable:!0,get:function(){return w.default}});var m=Cn();Object.defineProperty(n,"v1",{enumerable:!0,get:function(){return m.default}});var u=Tn();Object.defineProperty(n,"v1ToV6",{enumerable:!0,get:function(){return u.default}});var b=xa();Object.defineProperty(n,"v3",{enumerable:!0,get:function(){return b.default}});var C=Ia();Object.defineProperty(n,"v4",{enumerable:!0,get:function(){return C.default}});var T=Oa();Object.defineProperty(n,"v5",{enumerable:!0,get:function(){return T.default}});var v=Aa();Object.defineProperty(n,"v6",{enumerable:!0,get:function(){return v.default}});var l=Na();Object.defineProperty(n,"v6ToV1",{enumerable:!0,get:function(){return l.default}});var y=ja();Object.defineProperty(n,"v7",{enumerable:!0,get:function(){return y.default}});var S=wr();Object.defineProperty(n,"validate",{enumerable:!0,get:function(){return S.default}});var p=Fa();Object.defineProperty(n,"version",{enumerable:!0,get:function(){return p.default}})}(Vr)),Vr}var It={},Ki;function qa(){if(Ki)return It;Ki=1,Object.defineProperty(It,"__esModule",{value:!0}),It.FakeEventTarget=void 0;let n=class{listeners={};addEventListener(s,i,w={}){i&&(this.listeners[s]??=[],this.listeners[s].push({callback:i,once:w.once===!0}))}removeEventListener(s,i){this.listeners[s]&&(this.listeners[s]=this.listeners[s].filter(w=>w.callback!==i))}dispatchEvent(s){if(!s||typeof s.type!="string")throw new Error("invalid event object");const i=this.listeners[s.type];if(!i)return!0;for(const w of[...i]){try{w.callback.call(this,s)}catch(m){setTimeout(()=>{throw m},0)}w.once&&this.removeEventListener(s.type,w.callback)}return!s.defaultPrevented}};return It.FakeEventTarget=n,It}var or={},Gi;function Ua(){if(Gi)return or;Gi=1,Object.defineProperty(or,"__esModule",{value:!0}),or.clone=n;function n(e){if(e!==void 0)return Number.isNaN(e)?NaN:typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}return or}var Qi;function $a(){if(Qi)return Lt;Qi=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.FakeMediaStreamTrack=void 0;const n=Ba(),e=qa(),s=Ua();class i extends e.FakeEventTarget{#m;#l;#h;#e;#r;#t;#s;#u;#i;#f;#n;#a=null;#o=null;#c=null;#d=null;#p=null;constructor({kind:m,id:u,label:b,contentHint:C,enabled:T,muted:v,readyState:l,capabilities:y,constraints:S,settings:p,data:o}){super(),this.#m=u??(0,n.v4)(),this.#l=m,this.#h=b??"",this.#s=C??"",this.#r=T??!0,this.#t=v??!1,this.#e=l??"live",this.#u=y??{},this.#i=S??{},this.#f=p??{},this.#n=o??{}}get id(){return this.#m}get kind(){return this.#l}get label(){return this.#h}get contentHint(){return this.#s}set contentHint(m){this.#s=m}get enabled(){return this.#r}set enabled(m){const u=this.#r!==m;this.#r=m,u&&this.dispatchEvent(new Event("enabledchange"))}get muted(){return this.#t}get readyState(){return this.#e}get data(){return this.#n}set data(m){this.#n=m}get onmute(){return this.#a}set onmute(m){this.#a&&this.removeEventListener("mute",this.#a),this.#a=m,m&&this.addEventListener("mute",m)}get onunmute(){return this.#o}set onunmute(m){this.#o&&this.removeEventListener("unmute",this.#o),this.#o=m,m&&this.addEventListener("unmute",m)}get onended(){return this.#c}set onended(m){this.#c&&this.removeEventListener("ended",this.#c),this.#c=m,m&&this.addEventListener("ended",m)}get onenabledchange(){return this.#d}set onenabledchange(m){this.#d&&this.removeEventListener("enabledchange",this.#d),this.#d=m,m&&this.addEventListener("enabledchange",m)}get onstopped(){return this.#p}set onstopped(m){this.#p&&this.removeEventListener("stopped",this.#p),this.#p=m,m&&this.addEventListener("stopped",m)}addEventListener(m,u,b){super.addEventListener(m,u,b)}removeEventListener(m,u){super.removeEventListener(m,u)}stop(){this.#e!=="ended"&&(this.#e="ended",this.dispatchEvent(new Event("stopped")))}clone({id:m,data:u}={}){return new i({id:m??(0,n.v4)(),kind:this.#l,label:this.#h,contentHint:this.#s,enabled:this.#r,muted:this.#t,readyState:this.#e,capabilities:(0,s.clone)(this.#u),constraints:(0,s.clone)(this.#i),settings:(0,s.clone)(this.#f),data:u??(0,s.clone)(this.#n)})}getCapabilities(){return this.#u}getConstraints(){return this.#i}async applyConstraints(m={}){return this.#i=m,Promise.resolve()}getSettings(){return this.#f}remoteStop(){this.#e!=="ended"&&(this.#e="ended",this.dispatchEvent(new Event("stopped")),this.dispatchEvent(new Event("ended")))}remoteMute(){this.#t||(this.#t=!0,this.dispatchEvent(new Event("mute")))}remoteUnmute(){this.#t&&(this.#t=!1,this.dispatchEvent(new Event("unmute")))}}return Lt.FakeMediaStreamTrack=i,Lt}var Wi;function za(){if(Wi)return xt;Wi=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.FakeHandler=void 0;const n=$a(),e=De(),s=Q(),i=Y(),w=Z(),m=J(),u=ie(),b=new s.Logger("FakeHandler"),C="FakeHandler";class T extends e.EnhancedEventEmitter{id;ordered;maxPacketLifeTime;maxRetransmits;label;protocol;constructor({id:y,ordered:S,maxPacketLifeTime:p,maxRetransmits:o,label:t,protocol:r}){super(),this.id=y,this.ordered=S,this.maxPacketLifeTime=p,this.maxRetransmits=o,this.label=t,this.protocol=r}close(){this.safeEmit("close"),this.emit("@close")}send(y){this.safeEmit("message",y)}addEventListener(y,S){this.on(y,S)}}let v=class Dn extends u.HandlerInterface{_closed=!1;fakeParameters;_rtpParametersByKind;_cname=`CNAME-${i.generateRandomNumber()}`;_transportReady=!1;_nextLocalId=1;_tracks=new Map;_nextSctpStreamId=0;static createFactory(y){return()=>new Dn(y)}constructor(y){super(),this.fakeParameters=y}get name(){return C}close(){b.debug("close()"),!this._closed&&(this._closed=!0)}setIceGatheringState(y){this.emit("@icegatheringstatechange",y)}setConnectionState(y){this.emit("@connectionstatechange",y)}async getNativeRtpCapabilities(){return b.debug("getNativeRtpCapabilities()"),this.fakeParameters.generateNativeRtpCapabilities()}async getNativeSctpCapabilities(){return b.debug("getNativeSctpCapabilities()"),this.fakeParameters.generateNativeSctpCapabilities()}run({direction:y,iceParameters:S,iceCandidates:p,dtlsParameters:o,sctpParameters:t,iceServers:r,iceTransportPolicy:c,proprietaryConstraints:a,extendedRtpCapabilities:d}){this.assertNotClosed(),b.debug("run()"),this._rtpParametersByKind={audio:w.getSendingRtpParameters("audio",d),video:w.getSendingRtpParameters("video",d)}}async updateIceServers(y){this.assertNotClosed(),b.debug("updateIceServers()")}async restartIce(y){this.assertNotClosed(),b.debug("restartIce()")}async getTransportStats(){return this.assertNotClosed(),new Map}async send({track:y,encodings:S,codecOptions:p,codec:o}){this.assertNotClosed(),b.debug("send() [kind:%s, track.id:%s]",y.kind,y.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"});const t=i.clone(this._rtpParametersByKind[y.kind]),r=t.codecs.some(a=>/.+\/rtx$/i.test(a.mimeType));t.mid=`mid-${i.generateRandomNumber()}`,S||(S=[{}]);for(const a of S)a.ssrc=i.generateRandomNumber(),r&&(a.rtx={ssrc:i.generateRandomNumber()});t.encodings=S,t.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const c=this._nextLocalId++;return this._tracks.set(c,y),{localId:String(c),rtpParameters:t}}async stopSending(y){if(b.debug("stopSending() [localId:%s]",y),!this._closed){if(!this._tracks.has(Number(y)))throw new Error("local track not found");this._tracks.delete(Number(y))}}async pauseSending(y){this.assertNotClosed()}async resumeSending(y){this.assertNotClosed()}async replaceTrack(y,S){this.assertNotClosed(),S?b.debug("replaceTrack() [localId:%s, track.id:%s]",y,S.id):b.debug("replaceTrack() [localId:%s, no track]",y),this._tracks.delete(Number(y)),this._tracks.set(Number(y),S)}async setMaxSpatialLayer(y,S){this.assertNotClosed(),b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",y,S)}async setRtpEncodingParameters(y,S){this.assertNotClosed(),b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",y,S)}async getSenderStats(y){return this.assertNotClosed(),new Map}async sendDataChannel({ordered:y,maxPacketLifeTime:S,maxRetransmits:p,label:o,protocol:t}){this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),b.debug("sendDataChannel()");const r=new T({id:this._nextSctpStreamId++,ordered:y,maxPacketLifeTime:S,maxRetransmits:p,label:o,protocol:t}),c={streamId:this._nextSctpStreamId,ordered:y,maxPacketLifeTime:S,maxRetransmits:p};return{dataChannel:r,sctpStreamParameters:c}}async receive(y){this.assertNotClosed();const S=[];for(const p of y){const{trackId:o,kind:t}=p;this._transportReady||await this.setupTransport({localDtlsRole:"client"}),b.debug("receive() [trackId:%s, kind:%s]",o,t);const r=this._nextLocalId++,c=new n.FakeMediaStreamTrack({kind:t});this._tracks.set(r,c),S.push({localId:String(r),track:c})}return S}async stopReceiving(y){if(!this._closed)for(const S of y)b.debug("stopReceiving() [localId:%s]",S),this._tracks.delete(Number(S))}async pauseReceiving(y){this.assertNotClosed()}async resumeReceiving(y){this.assertNotClosed()}async getReceiverStats(y){return this.assertNotClosed(),new Map}async receiveDataChannel({sctpStreamParameters:y,label:S,protocol:p}){return this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"client"}),b.debug("receiveDataChannel()"),{dataChannel:new T({id:y.streamId,ordered:y.ordered,maxPacketLifeTime:y.maxPacketLifeTime,maxRetransmits:y.maxRetransmits,label:S,protocol:p})}}async setupTransport({localDtlsRole:y,localSdpObject:S}){const p=i.clone(this.fakeParameters.generateLocalDtlsParameters());y&&(p.role=y),this.emit("@connectionstatechange","connecting"),await new Promise((o,t)=>this.emit("@connect",{dtlsParameters:p},o,t)),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new m.InvalidStateError("method called in a closed handler")}};return xt.FakeHandler=v,xt}var ne={},Yi;function Ha(){if(Yi)return ne;Yi=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.generateRouterRtpCapabilities=s,ne.generateNativeRtpCapabilities=i,ne.generateNativeSctpCapabilities=w,ne.generateLocalDtlsParameters=m,ne.generateTransportRemoteParameters=u,ne.generateProducerRemoteParameters=b,ne.generateConsumerRemoteParameters=C,ne.generateDataProducerRemoteParameters=T,ne.generateDataConsumerRemoteParameters=v;const n=Y();function e(){return String(n.generateRandomNumber())}function s(){return n.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:105,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"profile-id":0,"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:106,clockRate:9e4,rtcpFeedback:[],parameters:{apt:105}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://tools.ietf.org/html/draft-ietf-avtext-framemarking-07",preferredId:6,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:framemarking",preferredId:7,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function i(){return n.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:98,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{"profile-id":0}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:99,clockRate:9e4,rtcpFeedback:[],parameters:{apt:98}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]})}function w(){return n.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function m(){return n.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function u(){return{id:e(),iceParameters:n.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:n.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:n.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:n.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function b(){return n.deepFreeze({id:e()})}function C({id:l,codecMimeType:y}={}){switch(y){case"audio/opus":return{id:l??e(),producerId:e(),kind:"audio",rtpParameters:n.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:l??e(),producerId:e(),kind:"audio",rtpParameters:n.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:l??e(),producerId:e(),kind:"video",rtpParameters:n.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:l??e(),producerId:e(),kind:"video",rtpParameters:n.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError(`unknown codecMimeType '${y}'`)}}function T(){return n.deepFreeze({id:e()})}function v({id:l}={}){return{id:l??e(),dataProducerId:e(),sctpStreamParameters:n.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}return ne}var Xi;function Va(){return Xi||(Xi=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.debug=n.testFakeParameters=n.FakeHandler=n.ortc=n.parseScalabilityMode=n.detectDeviceAsync=n.detectDevice=n.Device=n.version=n.types=void 0;const e=mr();n.debug=e.default,n.types=Ta(),n.version="3.11.0";var s=Rn();Object.defineProperty(n,"Device",{enumerable:!0,get:function(){return s.Device}}),Object.defineProperty(n,"detectDevice",{enumerable:!0,get:function(){return s.detectDevice}}),Object.defineProperty(n,"detectDeviceAsync",{enumerable:!0,get:function(){return s.detectDeviceAsync}});var i=Ee();Object.defineProperty(n,"parseScalabilityMode",{enumerable:!0,get:function(){return i.parse}}),n.ortc=Z();var w=za();Object.defineProperty(n,"FakeHandler",{enumerable:!0,get:function(){return w.FakeHandler}}),n.testFakeParameters=Ha()}(Nr)),Nr}var Ka=Va();const me=Object.create(null);me.open="0";me.close="1";me.ping="2";me.pong="3";me.message="4";me.upgrade="5";me.noop="6";const pr=Object.create(null);Object.keys(me).forEach(n=>{pr[me[n]]=n});const Xr={type:"error",data:"parser error"},En=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Pn=typeof ArrayBuffer=="function",kn=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,ns=({type:n,data:e},s,i)=>En&&e instanceof Blob?s?i(e):Ji(e,i):Pn&&(e instanceof ArrayBuffer||kn(e))?s?i(e):Ji(new Blob([e]),i):i(me[n]+(e||"")),Ji=(n,e)=>{const s=new FileReader;return s.onload=function(){const i=s.result.split(",")[1];e("b"+(i||""))},s.readAsDataURL(n)};function Zi(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let Qr;function Ga(n,e){if(En&&n.data instanceof Blob)return n.data.arrayBuffer().then(Zi).then(e);if(Pn&&(n.data instanceof ArrayBuffer||kn(n.data)))return e(Zi(n.data));ns(n,!1,s=>{Qr||(Qr=new TextEncoder),e(Qr.encode(s))})}const en="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",At=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<en.length;n++)At[en.charCodeAt(n)]=n;const Qa=n=>{let e=n.length*.75,s=n.length,i,w=0,m,u,b,C;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const T=new ArrayBuffer(e),v=new Uint8Array(T);for(i=0;i<s;i+=4)m=At[n.charCodeAt(i)],u=At[n.charCodeAt(i+1)],b=At[n.charCodeAt(i+2)],C=At[n.charCodeAt(i+3)],v[w++]=m<<2|u>>4,v[w++]=(u&15)<<4|b>>2,v[w++]=(b&3)<<6|C&63;return T},Wa=typeof ArrayBuffer=="function",as=(n,e)=>{if(typeof n!="string")return{type:"message",data:xn(n,e)};const s=n.charAt(0);return s==="b"?{type:"message",data:Ya(n.substring(1),e)}:pr[s]?n.length>1?{type:pr[s],data:n.substring(1)}:{type:pr[s]}:Xr},Ya=(n,e)=>{if(Wa){const s=Qa(n);return xn(s,e)}else return{base64:!0,data:n}},xn=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},Ln="",Xa=(n,e)=>{const s=n.length,i=new Array(s);let w=0;n.forEach((m,u)=>{ns(m,!1,b=>{i[u]=b,++w===s&&e(i.join(Ln))})})},Ja=(n,e)=>{const s=n.split(Ln),i=[];for(let w=0;w<s.length;w++){const m=as(s[w],e);if(i.push(m),m.type==="error")break}return i};function Za(){return new TransformStream({transform(n,e){Ga(n,s=>{const i=s.length;let w;if(i<126)w=new Uint8Array(1),new DataView(w.buffer).setUint8(0,i);else if(i<65536){w=new Uint8Array(3);const m=new DataView(w.buffer);m.setUint8(0,126),m.setUint16(1,i)}else{w=new Uint8Array(9);const m=new DataView(w.buffer);m.setUint8(0,127),m.setBigUint64(1,BigInt(i))}n.data&&typeof n.data!="string"&&(w[0]|=128),e.enqueue(w),e.enqueue(s)})}})}let Wr;function cr(n){return n.reduce((e,s)=>e+s.length,0)}function dr(n,e){if(n[0].length===e)return n.shift();const s=new Uint8Array(e);let i=0;for(let w=0;w<e;w++)s[w]=n[0][i++],i===n[0].length&&(n.shift(),i=0);return n.length&&i<n[0].length&&(n[0]=n[0].slice(i)),s}function eo(n,e){Wr||(Wr=new TextDecoder);const s=[];let i=0,w=-1,m=!1;return new TransformStream({transform(u,b){for(s.push(u);;){if(i===0){if(cr(s)<1)break;const C=dr(s,1);m=(C[0]&128)===128,w=C[0]&127,w<126?i=3:w===126?i=1:i=2}else if(i===1){if(cr(s)<2)break;const C=dr(s,2);w=new DataView(C.buffer,C.byteOffset,C.length).getUint16(0),i=3}else if(i===2){if(cr(s)<8)break;const C=dr(s,8),T=new DataView(C.buffer,C.byteOffset,C.length),v=T.getUint32(0);if(v>Math.pow(2,21)-1){b.enqueue(Xr);break}w=v*Math.pow(2,32)+T.getUint32(4),i=3}else{if(cr(s)<w)break;const C=dr(s,w);b.enqueue(as(m?C:Wr.decode(C),e)),i=0}if(w===0||w>n){b.enqueue(Xr);break}}}})}const In=4;function W(n){if(n)return to(n)}function to(n){for(var e in W.prototype)n[e]=W.prototype[e];return n}W.prototype.on=W.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};W.prototype.once=function(n,e){function s(){this.off(n,s),e.apply(this,arguments)}return s.fn=e,this.on(n,s),this};W.prototype.off=W.prototype.removeListener=W.prototype.removeAllListeners=W.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var s=this._callbacks["$"+n];if(!s)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var i,w=0;w<s.length;w++)if(i=s[w],i===e||i.fn===e){s.splice(w,1);break}return s.length===0&&delete this._callbacks["$"+n],this};W.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),s=this._callbacks["$"+n],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(s){s=s.slice(0);for(var i=0,w=s.length;i<w;++i)s[i].apply(this,e)}return this};W.prototype.emitReserved=W.prototype.emit;W.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};W.prototype.hasListeners=function(n){return!!this.listeners(n).length};const yr=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,s)=>s(e,0),ae=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),ro="arraybuffer";function Mn(n,...e){return e.reduce((s,i)=>(n.hasOwnProperty(i)&&(s[i]=n[i]),s),{})}const so=ae.setTimeout,io=ae.clearTimeout;function br(n,e){e.useNativeTimers?(n.setTimeoutFn=so.bind(ae),n.clearTimeoutFn=io.bind(ae)):(n.setTimeoutFn=ae.setTimeout.bind(ae),n.clearTimeoutFn=ae.clearTimeout.bind(ae))}const no=1.33;function ao(n){return typeof n=="string"?oo(n):Math.ceil((n.byteLength||n.size)*no)}function oo(n){let e=0,s=0;for(let i=0,w=n.length;i<w;i++)e=n.charCodeAt(i),e<128?s+=1:e<2048?s+=2:e<55296||e>=57344?s+=3:(i++,s+=4);return s}function On(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function co(n){let e="";for(let s in n)n.hasOwnProperty(s)&&(e.length&&(e+="&"),e+=encodeURIComponent(s)+"="+encodeURIComponent(n[s]));return e}function po(n){let e={},s=n.split("&");for(let i=0,w=s.length;i<w;i++){let m=s[i].split("=");e[decodeURIComponent(m[0])]=decodeURIComponent(m[1])}return e}class lo extends Error{constructor(e,s,i){super(e),this.description=s,this.context=i,this.type="TransportError"}}class os extends W{constructor(e){super(),this.writable=!1,br(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,s,i){return super.emitReserved("error",new lo(e,s,i)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const s=as(e,this.socket.binaryType);this.onPacket(s)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,s={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(s)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const s=co(e);return s.length?"?"+s:""}}class ho extends os{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const s=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let i=0;this._polling&&(i++,this.once("pollComplete",function(){--i||s()})),this.writable||(i++,this.once("drain",function(){--i||s()}))}else s()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const s=i=>{if(this.readyState==="opening"&&i.type==="open"&&this.onOpen(),i.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(i)};Ja(e,this.socket.binaryType).forEach(s),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Xa(e,s=>{this.doWrite(s,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",s=this.query||{};return this.opts.timestampRequests!==!1&&(s[this.opts.timestampParam]=On()),!this.supportsBinary&&!s.sid&&(s.b64=1),this.createUri(e,s)}}let An=!1;try{An=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const uo=An;function fo(){}class mo extends ho{constructor(e){if(super(e),typeof location<"u"){const s=location.protocol==="https:";let i=location.port;i||(i=s?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}}doWrite(e,s){const i=this.request({method:"POST",data:e});i.on("success",s),i.on("error",(w,m)=>{this.onError("xhr post error",w,m)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(s,i)=>{this.onError("xhr poll error",s,i)}),this.pollXhr=e}}class fe extends W{constructor(e,s,i){super(),this.createRequest=e,br(this,i),this._opts=i,this._method=i.method||"GET",this._uri=s,this._data=i.data!==void 0?i.data:null,this._create()}_create(){var e;const s=Mn(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");s.xdomain=!!this._opts.xd;const i=this._xhr=this.createRequest(s);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let w in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(w)&&i.setRequestHeader(w,this._opts.extraHeaders[w])}}catch{}if(this._method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var w;i.readyState===3&&((w=this._opts.cookieJar)===null||w===void 0||w.parseCookies(i.getResponseHeader("set-cookie"))),i.readyState===4&&(i.status===200||i.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof i.status=="number"?i.status:0)},0))},i.send(this._data)}catch(w){this.setTimeoutFn(()=>{this._onError(w)},0);return}typeof document<"u"&&(this._index=fe.requestsCount++,fe.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=fo,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete fe.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}fe.requestsCount=0;fe.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",tn);else if(typeof addEventListener=="function"){const n="onpagehide"in ae?"pagehide":"unload";addEventListener(n,tn,!1)}}function tn(){for(let n in fe.requests)fe.requests.hasOwnProperty(n)&&fe.requests[n].abort()}const go=function(){const n=Nn({xdomain:!1});return n&&n.responseType!==null}();class _o extends mo{constructor(e){super(e);const s=e&&e.forceBase64;this.supportsBinary=go&&!s}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new fe(Nn,this.uri(),e)}}function Nn(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||uo))return new XMLHttpRequest}catch{}if(!e)try{return new ae[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const jn=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class wo extends os{get name(){return"websocket"}doOpen(){const e=this.uri(),s=this.opts.protocols,i=jn?{}:Mn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,s,i)}catch(w){return this.emitReserved("error",w)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let s=0;s<e.length;s++){const i=e[s],w=s===e.length-1;ns(i,this.supportsBinary,m=>{try{this.doWrite(i,m)}catch{}w&&yr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",s=this.query||{};return this.opts.timestampRequests&&(s[this.opts.timestampParam]=On()),this.supportsBinary||(s.b64=1),this.createUri(e,s)}}const Yr=ae.WebSocket||ae.MozWebSocket;class vo extends wo{createSocket(e,s,i){return jn?new Yr(e,s,i):s?new Yr(e,s):new Yr(e)}doWrite(e,s){this.ws.send(s)}}class yo extends os{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const s=eo(Number.MAX_SAFE_INTEGER,this.socket.binaryType),i=e.readable.pipeThrough(s).getReader(),w=Za();w.readable.pipeTo(e.writable),this._writer=w.writable.getWriter();const m=()=>{i.read().then(({done:b,value:C})=>{b||(this.onPacket(C),m())}).catch(b=>{})};m();const u={type:"open"};this.query.sid&&(u.data=`{"sid":"${this.query.sid}"}`),this._writer.write(u).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let s=0;s<e.length;s++){const i=e[s],w=s===e.length-1;this._writer.write(i).then(()=>{w&&yr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const bo={websocket:vo,webtransport:yo,polling:_o},So=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ro=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Jr(n){if(n.length>8e3)throw"URI too long";const e=n,s=n.indexOf("["),i=n.indexOf("]");s!=-1&&i!=-1&&(n=n.substring(0,s)+n.substring(s,i).replace(/:/g,";")+n.substring(i,n.length));let w=So.exec(n||""),m={},u=14;for(;u--;)m[Ro[u]]=w[u]||"";return s!=-1&&i!=-1&&(m.source=e,m.host=m.host.substring(1,m.host.length-1).replace(/;/g,":"),m.authority=m.authority.replace("[","").replace("]","").replace(/;/g,":"),m.ipv6uri=!0),m.pathNames=Co(m,m.path),m.queryKey=To(m,m.query),m}function Co(n,e){const s=/\/{2,9}/g,i=e.replace(s,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&i.splice(0,1),e.slice(-1)=="/"&&i.splice(i.length-1,1),i}function To(n,e){const s={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,w,m){w&&(s[w]=m)}),s}const Zr=typeof addEventListener=="function"&&typeof removeEventListener=="function",lr=[];Zr&&addEventListener("offline",()=>{lr.forEach(n=>n())},!1);class Te extends W{constructor(e,s){if(super(),this.binaryType=ro,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(s=e,e=null),e){const i=Jr(e);s.hostname=i.host,s.secure=i.protocol==="https"||i.protocol==="wss",s.port=i.port,i.query&&(s.query=i.query)}else s.host&&(s.hostname=Jr(s.host).host);br(this,s),this.secure=s.secure!=null?s.secure:typeof location<"u"&&location.protocol==="https:",s.hostname&&!s.port&&(s.port=this.secure?"443":"80"),this.hostname=s.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=s.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},s.transports.forEach(i=>{const w=i.prototype.name;this.transports.push(w),this._transportsByName[w]=i}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},s),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=po(this.opts.query)),Zr&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},lr.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const s=Object.assign({},this.opts.query);s.EIO=In,s.transport=e,this.id&&(s.sid=this.id);const i=Object.assign({},this.opts,{query:s,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](i)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Te.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const s=this.createTransport(e);s.open(),this.setTransport(s)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",s=>this._onClose("transport close",s))}onOpen(){this.readyState="open",Te.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const s=new Error("server error");s.code=e.data,this._onError(s);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let s=1;for(let i=0;i<this.writeBuffer.length;i++){const w=this.writeBuffer[i].data;if(w&&(s+=ao(w)),i>0&&s>this._maxPayload)return this.writeBuffer.slice(0,i);s+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,yr(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,s,i){return this._sendPacket("message",e,s,i),this}send(e,s,i){return this._sendPacket("message",e,s,i),this}_sendPacket(e,s,i,w){if(typeof s=="function"&&(w=s,s=void 0),typeof i=="function"&&(w=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;const m={type:e,data:s,options:i};this.emitReserved("packetCreate",m),this.writeBuffer.push(m),w&&this.once("flush",w),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},s=()=>{this.off("upgrade",s),this.off("upgradeError",s),e()},i=()=>{this.once("upgrade",s),this.once("upgradeError",s)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}_onError(e){if(Te.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,s){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Zr&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const i=lr.indexOf(this._offlineEventListener);i!==-1&&lr.splice(i,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,s),this.writeBuffer=[],this._prevBufferLen=0}}}Te.protocol=In;class Do extends Te{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let s=this.createTransport(e),i=!1;Te.priorWebsocketSuccess=!1;const w=()=>{i||(s.send([{type:"ping",data:"probe"}]),s.once("packet",l=>{if(!i)if(l.type==="pong"&&l.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",s),!s)return;Te.priorWebsocketSuccess=s.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(v(),this.setTransport(s),s.send([{type:"upgrade"}]),this.emitReserved("upgrade",s),s=null,this.upgrading=!1,this.flush())})}else{const y=new Error("probe error");y.transport=s.name,this.emitReserved("upgradeError",y)}}))};function m(){i||(i=!0,v(),s.close(),s=null)}const u=l=>{const y=new Error("probe error: "+l);y.transport=s.name,m(),this.emitReserved("upgradeError",y)};function b(){u("transport closed")}function C(){u("socket closed")}function T(l){s&&l.name!==s.name&&m()}const v=()=>{s.removeListener("open",w),s.removeListener("error",u),s.removeListener("close",b),this.off("close",C),this.off("upgrading",T)};s.once("open",w),s.once("error",u),s.once("close",b),this.once("close",C),this.once("upgrading",T),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{i||s.open()},200):s.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const s=[];for(let i=0;i<e.length;i++)~this.transports.indexOf(e[i])&&s.push(e[i]);return s}}let Eo=class extends Do{constructor(e,s={}){const i=typeof e=="object"?e:s;(!i.transports||i.transports&&typeof i.transports[0]=="string")&&(i.transports=(i.transports||["polling","websocket","webtransport"]).map(w=>bo[w]).filter(w=>!!w)),super(e,i)}};function Po(n,e="",s){let i=n;s=s||typeof location<"u"&&location,n==null&&(n=s.protocol+"//"+s.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=s.protocol+n:n=s.host+n),/^(https?|wss?):\/\//.test(n)||(typeof s<"u"?n=s.protocol+"//"+n:n="https://"+n),i=Jr(n)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const m=i.host.indexOf(":")!==-1?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+m+":"+i.port+e,i.href=i.protocol+"://"+m+(s&&s.port===i.port?"":":"+i.port),i}const ko=typeof ArrayBuffer=="function",xo=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,Fn=Object.prototype.toString,Lo=typeof Blob=="function"||typeof Blob<"u"&&Fn.call(Blob)==="[object BlobConstructor]",Io=typeof File=="function"||typeof File<"u"&&Fn.call(File)==="[object FileConstructor]";function cs(n){return ko&&(n instanceof ArrayBuffer||xo(n))||Lo&&n instanceof Blob||Io&&n instanceof File}function hr(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let s=0,i=n.length;s<i;s++)if(hr(n[s]))return!0;return!1}if(cs(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return hr(n.toJSON(),!0);for(const s in n)if(Object.prototype.hasOwnProperty.call(n,s)&&hr(n[s]))return!0;return!1}function Mo(n){const e=[],s=n.data,i=n;return i.data=es(s,e),i.attachments=e.length,{packet:i,buffers:e}}function es(n,e){if(!n)return n;if(cs(n)){const s={_placeholder:!0,num:e.length};return e.push(n),s}else if(Array.isArray(n)){const s=new Array(n.length);for(let i=0;i<n.length;i++)s[i]=es(n[i],e);return s}else if(typeof n=="object"&&!(n instanceof Date)){const s={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(s[i]=es(n[i],e));return s}return n}function Oo(n,e){return n.data=ts(n.data,e),delete n.attachments,n}function ts(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let s=0;s<n.length;s++)n[s]=ts(n[s],e);else if(typeof n=="object")for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(n[s]=ts(n[s],e));return n}const Ao=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],No=5;var $;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})($||($={}));class jo{constructor(e){this.replacer=e}encode(e){return(e.type===$.EVENT||e.type===$.ACK)&&hr(e)?this.encodeAsBinary({type:e.type===$.EVENT?$.BINARY_EVENT:$.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let s=""+e.type;return(e.type===$.BINARY_EVENT||e.type===$.BINARY_ACK)&&(s+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(s+=e.nsp+","),e.id!=null&&(s+=e.id),e.data!=null&&(s+=JSON.stringify(e.data,this.replacer)),s}encodeAsBinary(e){const s=Mo(e),i=this.encodeAsString(s.packet),w=s.buffers;return w.unshift(i),w}}function rn(n){return Object.prototype.toString.call(n)==="[object Object]"}class ds extends W{constructor(e){super(),this.reviver=e}add(e){let s;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");s=this.decodeString(e);const i=s.type===$.BINARY_EVENT;i||s.type===$.BINARY_ACK?(s.type=i?$.EVENT:$.ACK,this.reconstructor=new Fo(s),s.attachments===0&&super.emitReserved("decoded",s)):super.emitReserved("decoded",s)}else if(cs(e)||e.base64)if(this.reconstructor)s=this.reconstructor.takeBinaryData(e),s&&(this.reconstructor=null,super.emitReserved("decoded",s));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let s=0;const i={type:Number(e.charAt(0))};if($[i.type]===void 0)throw new Error("unknown packet type "+i.type);if(i.type===$.BINARY_EVENT||i.type===$.BINARY_ACK){const m=s+1;for(;e.charAt(++s)!=="-"&&s!=e.length;);const u=e.substring(m,s);if(u!=Number(u)||e.charAt(s)!=="-")throw new Error("Illegal attachments");i.attachments=Number(u)}if(e.charAt(s+1)==="/"){const m=s+1;for(;++s&&!(e.charAt(s)===","||s===e.length););i.nsp=e.substring(m,s)}else i.nsp="/";const w=e.charAt(s+1);if(w!==""&&Number(w)==w){const m=s+1;for(;++s;){const u=e.charAt(s);if(u==null||Number(u)!=u){--s;break}if(s===e.length)break}i.id=Number(e.substring(m,s+1))}if(e.charAt(++s)){const m=this.tryParse(e.substr(s));if(ds.isPayloadValid(i.type,m))i.data=m;else throw new Error("invalid payload")}return i}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,s){switch(e){case $.CONNECT:return rn(s);case $.DISCONNECT:return s===void 0;case $.CONNECT_ERROR:return typeof s=="string"||rn(s);case $.EVENT:case $.BINARY_EVENT:return Array.isArray(s)&&(typeof s[0]=="number"||typeof s[0]=="string"&&Ao.indexOf(s[0])===-1);case $.ACK:case $.BINARY_ACK:return Array.isArray(s)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Fo{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const s=Oo(this.reconPack,this.buffers);return this.finishedReconstruction(),s}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Bo=Object.freeze(Object.defineProperty({__proto__:null,Decoder:ds,Encoder:jo,get PacketType(){return $},protocol:No},Symbol.toStringTag,{value:"Module"}));function pe(n,e,s){return n.on(e,s),function(){n.off(e,s)}}const qo=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Bn extends W{constructor(e,s,i){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=s,i&&i.auth&&(this.auth=i.auth),this._opts=Object.assign({},i),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[pe(e,"open",this.onopen.bind(this)),pe(e,"packet",this.onpacket.bind(this)),pe(e,"error",this.onerror.bind(this)),pe(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...s){var i,w,m;if(qo.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(s.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(s),this;const u={type:$.EVENT,data:s};if(u.options={},u.options.compress=this.flags.compress!==!1,typeof s[s.length-1]=="function"){const v=this.ids++,l=s.pop();this._registerAckCallback(v,l),u.id=v}const b=(w=(i=this.io.engine)===null||i===void 0?void 0:i.transport)===null||w===void 0?void 0:w.writable,C=this.connected&&!(!((m=this.io.engine)===null||m===void 0)&&m._hasPingExpired());return this.flags.volatile&&!b||(C?(this.notifyOutgoingListeners(u),this.packet(u)):this.sendBuffer.push(u)),this.flags={},this}_registerAckCallback(e,s){var i;const w=(i=this.flags.timeout)!==null&&i!==void 0?i:this._opts.ackTimeout;if(w===void 0){this.acks[e]=s;return}const m=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let b=0;b<this.sendBuffer.length;b++)this.sendBuffer[b].id===e&&this.sendBuffer.splice(b,1);s.call(this,new Error("operation has timed out"))},w),u=(...b)=>{this.io.clearTimeoutFn(m),s.apply(this,b)};u.withError=!0,this.acks[e]=u}emitWithAck(e,...s){return new Promise((i,w)=>{const m=(u,b)=>u?w(u):i(b);m.withError=!0,s.push(m),this.emit(e,...s)})}_addToQueue(e){let s;typeof e[e.length-1]=="function"&&(s=e.pop());const i={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((w,...m)=>i!==this._queue[0]?void 0:(w!==null?i.tryCount>this._opts.retries&&(this._queue.shift(),s&&s(w)):(this._queue.shift(),s&&s(null,...m)),i.pending=!1,this._drainQueue())),this._queue.push(i),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const s=this._queue[0];s.pending&&!e||(s.pending=!0,s.tryCount++,this.flags=s.flags,this.emit.apply(this,s.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:$.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,s){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,s),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(i=>String(i.id)===e)){const i=this.acks[e];delete this.acks[e],i.withError&&i.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case $.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case $.EVENT:case $.BINARY_EVENT:this.onevent(e);break;case $.ACK:case $.BINARY_ACK:this.onack(e);break;case $.DISCONNECT:this.ondisconnect();break;case $.CONNECT_ERROR:this.destroy();const i=new Error(e.data.message);i.data=e.data.data,this.emitReserved("connect_error",i);break}}onevent(e){const s=e.data||[];e.id!=null&&s.push(this.ack(e.id)),this.connected?this.emitEvent(s):this.receiveBuffer.push(Object.freeze(s))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const s=this._anyListeners.slice();for(const i of s)i.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const s=this;let i=!1;return function(...w){i||(i=!0,s.packet({type:$.ACK,id:e,data:w}))}}onack(e){const s=this.acks[e.id];typeof s=="function"&&(delete this.acks[e.id],s.withError&&e.data.unshift(null),s.apply(this,e.data))}onconnect(e,s){this.id=e,this.recovered=s&&this._pid===s,this._pid=s,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:$.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const s=this._anyListeners;for(let i=0;i<s.length;i++)if(e===s[i])return s.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const s=this._anyOutgoingListeners;for(let i=0;i<s.length;i++)if(e===s[i])return s.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const s=this._anyOutgoingListeners.slice();for(const i of s)i.apply(this,e.data)}}}function Qe(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}Qe.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),s=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-s:n+s}return Math.min(n,this.max)|0};Qe.prototype.reset=function(){this.attempts=0};Qe.prototype.setMin=function(n){this.ms=n};Qe.prototype.setMax=function(n){this.max=n};Qe.prototype.setJitter=function(n){this.jitter=n};class rs extends W{constructor(e,s){var i;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(s=e,e=void 0),s=s||{},s.path=s.path||"/socket.io",this.opts=s,br(this,s),this.reconnection(s.reconnection!==!1),this.reconnectionAttempts(s.reconnectionAttempts||1/0),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor((i=s.randomizationFactor)!==null&&i!==void 0?i:.5),this.backoff=new Qe({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(s.timeout==null?2e4:s.timeout),this._readyState="closed",this.uri=e;const w=s.parser||Bo;this.encoder=new w.Encoder,this.decoder=new w.Decoder,this._autoConnect=s.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var s;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(s=this.backoff)===null||s===void 0||s.setMin(e),this)}randomizationFactor(e){var s;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(s=this.backoff)===null||s===void 0||s.setJitter(e),this)}reconnectionDelayMax(e){var s;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(s=this.backoff)===null||s===void 0||s.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Eo(this.uri,this.opts);const s=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const w=pe(s,"open",function(){i.onopen(),e&&e()}),m=b=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",b),e?e(b):this.maybeReconnectOnOpen()},u=pe(s,"error",m);if(this._timeout!==!1){const b=this._timeout,C=this.setTimeoutFn(()=>{w(),m(new Error("timeout")),s.close()},b);this.opts.autoUnref&&C.unref(),this.subs.push(()=>{this.clearTimeoutFn(C)})}return this.subs.push(w),this.subs.push(u),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(pe(e,"ping",this.onping.bind(this)),pe(e,"data",this.ondata.bind(this)),pe(e,"error",this.onerror.bind(this)),pe(e,"close",this.onclose.bind(this)),pe(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(s){this.onclose("parse error",s)}}ondecoded(e){yr(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,s){let i=this.nsps[e];return i?this._autoConnect&&!i.active&&i.connect():(i=new Bn(this,e,s),this.nsps[e]=i),i}_destroy(e){const s=Object.keys(this.nsps);for(const i of s)if(this.nsps[i].active)return;this._close()}_packet(e){const s=this.encoder.encode(e);for(let i=0;i<s.length;i++)this.engine.write(s[i],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,s){var i;this.cleanup(),(i=this.engine)===null||i===void 0||i.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,s),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const s=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(w=>{w?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",w)):e.onreconnect()}))},s);this.opts.autoUnref&&i.unref(),this.subs.push(()=>{this.clearTimeoutFn(i)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Mt={};function ur(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const s=Po(n,e.path||"/socket.io"),i=s.source,w=s.id,m=s.path,u=Mt[w]&&m in Mt[w].nsps,b=e.forceNew||e["force new connection"]||e.multiplex===!1||u;let C;return b?C=new rs(i,e):(Mt[w]||(Mt[w]=new rs(i,e)),C=Mt[w]),s.query&&!e.query&&(e.query=s.queryKey),C.socket(s.path,e)}Object.assign(ur,{Manager:rs,Socket:Bn,io:ur,connect:ur});const Uo=ur("http://localhost:3000");document.getElementById("join-button").addEventListener("click",async()=>{const n=document.getElementById("username").value,e=document.getElementById("room-id").value;if(!n||!e){alert("Vui lng nhp y  thng tin!");return}Uo.emit("joinRoom",{username:n,roomId:e},async s=>{await new Ka.Device().load({routerRtpCapabilities:s.rtpCapabilities}),console.log(" load device vi rtpCapabilities:",s.rtpCapabilities)})});
